{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/errors.ts"],"sourcesContent":["export class AppError extends Error {\r\n  public code: string;\r\n  public status: number;\r\n  public details?: any;\r\n\r\n  constructor(code: string, message: string, status: number = 400, details?: any) {\r\n    super(message);\r\n    this.name = 'AppError';\r\n    this.code = code;\r\n    this.status = status;\r\n    this.details = details;\r\n  }\r\n}\r\n\r\nexport function createErrorResponse(error: any) {\r\n  if (error instanceof AppError || (error?.name === 'AppError' && error?.code && error?.message)) {\r\n    return Response.json(\r\n      { success: false, error: { code: error.code, message: error.message, details: error.details } },\r\n      { status: error.status || 400 }\r\n    );\r\n  }\r\n\r\n  if (error?.name === 'ZodError') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'VALIDATION_ERROR',\r\n          message: 'Invalid request payload',\r\n          details: error.issues ?? error.errors,\r\n        },\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  if (error?.code === 'P2002') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'CONFLICT',\r\n          message: 'A record with the same unique value already exists',\r\n          details: error.meta,\r\n        },\r\n      },\r\n      { status: 409 }\r\n    );\r\n  }\r\n\r\n  if (error?.code === 'P2003') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'RELATION_ERROR',\r\n          message: 'Related record is missing or invalid',\r\n          details: error.meta,\r\n        },\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  console.error('[Unhandled Error]:', error);\r\n\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: error?.code || 'INTERNAL_ERROR',\r\n          message: error?.message || 'Unknown server error',\r\n          details: error?.stack || error,\r\n        },\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n\r\n  return Response.json(\r\n    { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\r\n    { status: 500 }\r\n  );\r\n}\r\n"],"names":["AppError","Error","code","status","details","message","name","createErrorResponse","error","Response","json","success","issues","errors","meta","console","stack"],"mappings":";;;;;;AAAO,MAAMA,iBAAiBC;IACrBC,KAAa;IACbC,OAAe;IACfC,QAAc;IAErBJ,YAAYE,IAAY,EAAEG,OAAe,EAAEF,SAAiB,GAAG,EAAEC,OAAa,CAAE;QAC9E,KAAK,CAACC;QACN,IAAI,CAACC,IAAI,GAAG;QACZ,IAAI,CAACJ,IAAI,GAAGA;QACZ,IAAI,CAACC,MAAM,GAAGA;QACd,IAAI,CAACC,OAAO,GAAGA;IACjB;AACF;AAEO,SAASG,oBAAoBC,KAAU;IAC5C,IAAIA,iBAAiBR,YAAaQ,OAAOF,SAAS,cAAcE,OAAON,QAAQM,OAAOH,SAAU;QAC9F,OAAOI,SAASC,IAAI,CAClB;YAAEC,SAAS;YAAOH,OAAO;gBAAEN,MAAMM,MAAMN,IAAI;gBAAEG,SAASG,MAAMH,OAAO;gBAAED,SAASI,MAAMJ,OAAO;YAAC;QAAE,GAC9F;YAAED,QAAQK,MAAML,MAAM,IAAI;QAAI;IAElC;IAEA,IAAIK,OAAOF,SAAS,YAAY;QAC9B,OAAOG,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMI,MAAM,IAAIJ,MAAMK,MAAM;YACvC;QACF,GACA;YAAEV,QAAQ;QAAI;IAElB;IAEA,IAAIK,OAAON,SAAS,SAAS;QAC3B,OAAOO,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMM,IAAI;YACrB;QACF,GACA;YAAEX,QAAQ;QAAI;IAElB;IAEA,IAAIK,OAAON,SAAS,SAAS;QAC3B,OAAOO,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMM,IAAI;YACrB;QACF,GACA;YAAEX,QAAQ;QAAI;IAElB;IAEAY,QAAQP,KAAK,CAAC,sBAAsBA;IAEpC,wCAA2C;QACzC,OAAOC,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAMM,OAAON,QAAQ;gBACrBG,SAASG,OAAOH,WAAW;gBAC3BD,SAASI,OAAOQ,SAASR;YAC3B;QACF,GACA;YAAEL,QAAQ;QAAI;IAElB;;;AAMF"}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/permissions.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\r\nimport { AppError } from './errors';\r\n\r\nexport type FarmPermission =\r\n  | 'updates:read'\r\n  | 'updates:write'\r\n  | 'digest:read'\r\n  | 'monitoring:read'\r\n  | 'monitoring:write'\r\n  | 'incident:read'\r\n  | 'incident:write'\r\n  | 'vendor:read'\r\n  | 'vendor:write'\r\n  | 'procurement:read'\r\n  | 'procurement:write'\r\n  | 'payroll:read'\r\n  | 'payroll:write'\r\n  | 'payroll:approve'\r\n  | 'payroll:pay';\r\n\r\ntype FarmRole = 'OWNER' | 'MANAGER' | 'WORKER';\r\n\r\nconst roleMatrix: Record<FarmRole, FarmPermission[]> = {\r\n  OWNER: [\r\n    'updates:read',\r\n    'updates:write',\r\n    'digest:read',\r\n    'monitoring:read',\r\n    'monitoring:write',\r\n    'incident:read',\r\n    'incident:write',\r\n    'vendor:read',\r\n    'vendor:write',\r\n    'procurement:read',\r\n    'procurement:write',\r\n    'payroll:read',\r\n    'payroll:write',\r\n    'payroll:approve',\r\n    'payroll:pay',\r\n  ],\r\n  MANAGER: [\r\n    'updates:read',\r\n    'updates:write',\r\n    'digest:read',\r\n    'monitoring:read',\r\n    'monitoring:write',\r\n    'incident:read',\r\n    'incident:write',\r\n    'vendor:read',\r\n    'vendor:write',\r\n    'procurement:read',\r\n    'procurement:write',\r\n    'payroll:read',\r\n    'payroll:write',\r\n  ],\r\n  WORKER: ['updates:read', 'updates:write', 'incident:read', 'incident:write', 'procurement:read'],\r\n};\r\n\r\nexport function getRequestRole(request: NextRequest): FarmRole {\r\n  const headerRole = request.headers.get('x-farm-role');\r\n  if (headerRole === 'OWNER' || headerRole === 'MANAGER' || headerRole === 'WORKER') {\r\n    return headerRole;\r\n  }\r\n\r\n  return 'MANAGER';\r\n}\r\n\r\nexport function getRequestUserId(request: NextRequest): string {\r\n  return request.headers.get('x-user-id') || 'user_id_from_session';\r\n}\r\n\r\nexport function requirePermission(request: NextRequest, permission: FarmPermission) {\r\n  const role = getRequestRole(request);\r\n  if (!roleMatrix[role].includes(permission)) {\r\n    throw new AppError('FORBIDDEN', 'You do not have permission for this action', 403);\r\n  }\r\n}\r\n"],"names":["roleMatrix","OWNER","MANAGER","WORKER","getRequestRole","request","headerRole","headers","get","getRequestUserId","requirePermission","permission","role","includes"],"mappings":";;;;;;;;AACA;;AAqBA,MAAMA,aAAiD;IACrDC,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACDC,SAAS;QACP;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACDC,QAAQ;QAAC;QAAgB;QAAiB;QAAiB;QAAkB;KAAmB;AAClG;AAEO,SAASC,eAAeC,OAAoB;IACjD,MAAMC,aAAaD,QAAQE,OAAO,CAACC,GAAG,CAAC;IACvC,IAAIF,eAAe,WAAWA,eAAe,aAAaA,eAAe,UAAU;QACjF,OAAOA;IACT;IAEA,OAAO;AACT;AAEO,SAASG,iBAAiBJ,OAAoB;IACnD,OAAOA,QAAQE,OAAO,CAACC,GAAG,CAAC,gBAAgB;AAC7C;AAEO,SAASE,kBAAkBL,OAAoB,EAAEM,UAA0B;IAChF,MAAMC,OAAOR,eAAeC;IAC5B,IAAI,CAACL,UAAU,CAACY,KAAK,CAACC,QAAQ,CAACF,aAAa;QAC1C,MAAM,IAAI,kIAAQ,CAAC,aAAa,8CAA8C;IAChF;AACF"}},
    {"offset": {"line": 198, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/dev-invite-store.ts"],"sourcesContent":["type InviteRole = 'MANAGER' | 'WORKER';\r\ntype InviteStatus = 'PENDING' | 'ACCEPTED' | 'EXPIRED';\r\n\r\ntype DevInvite = {\r\n  id: string;\r\n  token: string;\r\n  farmId: string;\r\n  email: string;\r\n  role: InviteRole;\r\n  status: InviteStatus;\r\n  inviteUrl: string;\r\n  expiresAt: string;\r\n  createdAt: string;\r\n};\r\n\r\ntype DevUser = {\r\n  id: string;\r\n  email: string;\r\n  name?: string;\r\n  password: string;\r\n};\r\n\r\ntype DevMembership = {\r\n  farmId: string;\r\n  userId: string;\r\n  role: InviteRole;\r\n};\r\n\r\ntype DevSession = {\r\n  token: string;\r\n  userId: string;\r\n  expiresAt: string;\r\n};\r\n\r\ntype DevStore = {\r\n  invites: DevInvite[];\r\n  users: DevUser[];\r\n  memberships: DevMembership[];\r\n  sessions: DevSession[];\r\n};\r\n\r\nconst globalStore = globalThis as unknown as { __farmOpsDevInviteStore?: DevStore };\r\n\r\nconst store: DevStore = globalStore.__farmOpsDevInviteStore ?? {\r\n  invites: [],\r\n  users: [],\r\n  memberships: [],\r\n  sessions: [],\r\n};\r\n\r\nglobalStore.__farmOpsDevInviteStore = store;\r\n\r\nexport function listInvitesByFarm(farmId: string) {\r\n  return store.invites\r\n    .filter((invite) => invite.farmId === farmId)\r\n    .sort((a, b) => (a.createdAt < b.createdAt ? 1 : -1));\r\n}\r\n\r\nexport function createInvite(input: {\r\n  farmId: string;\r\n  email: string;\r\n  role: InviteRole;\r\n  origin: string;\r\n}) {\r\n  const token = crypto.randomUUID();\r\n  const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString();\r\n  const invite: DevInvite = {\r\n    id: crypto.randomUUID(),\r\n    token,\r\n    farmId: input.farmId,\r\n    email: input.email.toLowerCase(),\r\n    role: input.role,\r\n    status: 'PENDING',\r\n    inviteUrl: `${input.origin}/auth/invite/${token}`,\r\n    expiresAt,\r\n    createdAt: new Date().toISOString(),\r\n  };\r\n\r\n  store.invites.push(invite);\r\n  return invite;\r\n}\r\n\r\nexport function getInviteByToken(token: string) {\r\n  const invite = store.invites.find((entry) => entry.token === token);\r\n  if (!invite) return null;\r\n\r\n  if (invite.status === 'PENDING' && new Date(invite.expiresAt).getTime() < Date.now()) {\r\n    invite.status = 'EXPIRED';\r\n  }\r\n\r\n  return invite;\r\n}\r\n\r\nexport function acceptInvite(input: {\r\n  token: string;\r\n  mode: 'LOGIN' | 'SIGNUP';\r\n  email: string;\r\n  password: string;\r\n  name?: string;\r\n}) {\r\n  const invite = getInviteByToken(input.token);\r\n  if (!invite) {\r\n    return { ok: false as const, code: 'INVITE_NOT_FOUND', message: 'Invite link is invalid' };\r\n  }\r\n\r\n  if (invite.status !== 'PENDING') {\r\n    return { ok: false as const, code: 'INVITE_NOT_ACTIVE', message: 'Invite is not active' };\r\n  }\r\n\r\n  if (invite.email !== input.email.toLowerCase()) {\r\n    return { ok: false as const, code: 'INVITE_EMAIL_MISMATCH', message: 'Use the invited email address' };\r\n  }\r\n\r\n  let user = store.users.find((entry) => entry.email === input.email.toLowerCase());\r\n\r\n  if (input.mode === 'SIGNUP') {\r\n    if (user) {\r\n      return { ok: false as const, code: 'EMAIL_EXISTS', message: 'Account already exists, login instead' };\r\n    }\r\n\r\n    user = {\r\n      id: crypto.randomUUID(),\r\n      email: input.email.toLowerCase(),\r\n      name: input.name,\r\n      password: input.password,\r\n    };\r\n    store.users.push(user);\r\n  } else {\r\n    if (!user || user.password !== input.password) {\r\n      return { ok: false as const, code: 'INVALID_CREDENTIALS', message: 'Invalid email or password' };\r\n    }\r\n  }\r\n\r\n  const membershipExists = store.memberships.some(\r\n    (entry) => entry.farmId === invite.farmId && entry.userId === user.id\r\n  );\r\n\r\n  if (!membershipExists) {\r\n    store.memberships.push({\r\n      farmId: invite.farmId,\r\n      userId: user.id,\r\n      role: invite.role,\r\n    });\r\n  }\r\n\r\n  invite.status = 'ACCEPTED';\r\n\r\n  const sessionToken = crypto.randomUUID();\r\n  const sessionExpires = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString();\r\n  store.sessions.push({ token: sessionToken, userId: user.id, expiresAt: sessionExpires });\r\n\r\n  return {\r\n    ok: true as const,\r\n    user,\r\n    invite,\r\n    sessionToken,\r\n    sessionExpires,\r\n  };\r\n}\r\n"],"names":["globalStore","globalThis","store","__farmOpsDevInviteStore","invites","users","memberships","sessions","listInvitesByFarm","farmId","filter","invite","sort","a","b","createdAt","createInvite","input","token","crypto","randomUUID","expiresAt","Date","now","toISOString","id","email","toLowerCase","role","status","inviteUrl","origin","push","getInviteByToken","find","entry","getTime","acceptInvite","ok","code","message","user","mode","name","password","membershipExists","some","userId","sessionToken","sessionExpires"],"mappings":"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"}},
    {"offset": {"line": 320, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/invite-email.ts"],"sourcesContent":["import { AppError } from '@/lib/errors';\r\n\r\nexport async function sendInviteEmail(input: {\r\n  to: string;\r\n  inviteUrl: string;\r\n  role: 'MANAGER' | 'WORKER';\r\n  farmId: string;\r\n}) {\r\n  const apiKey = process.env.RESEND_API_KEY;\r\n  if (!apiKey) {\r\n    throw new AppError('EMAIL_NOT_CONFIGURED', 'RESEND_API_KEY is missing. Configure email delivery first.', 500);\r\n  }\r\n\r\n  const fromEmail = process.env.INVITE_FROM_EMAIL || 'onboarding@resend.dev';\r\n\r\n  const subject = `FarmOps Invite: Join as ${input.role}`;\r\n  const html = `\r\n    <div style=\"font-family:Arial,sans-serif;line-height:1.5;color:#111827;max-width:560px;margin:0 auto;\">\r\n      <h2 style=\"margin-bottom:8px;\">You are invited to FarmOps</h2>\r\n      <p style=\"margin:0 0 12px;\">You have been invited to join farm <strong>${input.farmId}</strong> as <strong>${input.role}</strong>.</p>\r\n      <p style=\"margin:0 0 16px;\">Use this link to accept the invite and login or sign up with your email:</p>\r\n      <p style=\"margin:0 0 20px;\">\r\n        <a href=\"${input.inviteUrl}\" style=\"display:inline-block;background:#111827;color:#ffffff;text-decoration:none;padding:10px 14px;border-radius:8px;\">Accept Invite</a>\r\n      </p>\r\n      <p style=\"font-size:12px;color:#6b7280;word-break:break-all;\">If the button does not work, copy and open:<br/>${input.inviteUrl}</p>\r\n    </div>\r\n  `;\r\n\r\n  const response = await fetch('https://api.resend.com/emails', {\r\n    method: 'POST',\r\n    headers: {\r\n      Authorization: `Bearer ${apiKey}`,\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify({\r\n      from: fromEmail,\r\n      to: [input.to],\r\n      subject,\r\n      html,\r\n    }),\r\n  });\r\n\r\n  const result = await response.json();\r\n\r\n  if (!response.ok) {\r\n    throw new AppError(\r\n      'EMAIL_SEND_FAILED',\r\n      result?.message || 'Failed to send invite email',\r\n      502,\r\n      result\r\n    );\r\n  }\r\n\r\n  return {\r\n    provider: 'resend',\r\n    id: result?.id,\r\n  };\r\n}\r\n"],"names":["sendInviteEmail","input","apiKey","process","env","RESEND_API_KEY","fromEmail","INVITE_FROM_EMAIL","subject","role","html","farmId","inviteUrl","response","fetch","method","headers","Authorization","body","JSON","stringify","from","to","result","json","ok","message","provider","id"],"mappings":";;;;AAAA;;AAEO,eAAeA,gBAAgBC,KAKrC;IACC,MAAMC,SAASC,QAAQC,GAAG,CAACC,cAAc;IACzC,IAAI,CAACH,QAAQ;QACX,MAAM,IAAI,kIAAQ,CAAC,wBAAwB,8DAA8D;IAC3G;IAEA,MAAMI,YAAYH,QAAQC,GAAG,CAACG,iBAAiB,IAAI;IAEnD,MAAMC,UAAU,CAAC,wBAAwB,EAAEP,MAAMQ,IAAI,EAAE;IACvD,MAAMC,OAAO,CAAC;;;6EAG6D,EAAET,MAAMU,MAAM,CAAC,qBAAqB,EAAEV,MAAMQ,IAAI,CAAC;;;iBAG7G,EAAER,MAAMW,SAAS,CAAC;;oHAEiF,EAAEX,MAAMW,SAAS,CAAC;;EAEpI,CAAC;IAED,MAAMC,WAAW,MAAMC,MAAM,iCAAiC;QAC5DC,QAAQ;QACRC,SAAS;YACPC,eAAe,CAAC,OAAO,EAAEf,QAAQ;YACjC,gBAAgB;QAClB;QACAgB,MAAMC,KAAKC,SAAS,CAAC;YACnBC,MAAMf;YACNgB,IAAI;gBAACrB,MAAMqB,EAAE;aAAC;YACdd;YACAE;QACF;IACF;IAEA,MAAMa,SAAS,MAAMV,SAASW,IAAI;IAElC,IAAI,CAACX,SAASY,EAAE,EAAE;QAChB,MAAM,IAAI,kIAAQ,CAChB,qBACAF,QAAQG,WAAW,+BACnB,KACAH;IAEJ;IAEA,OAAO;QACLI,UAAU;QACVC,IAAIL,QAAQK;IACd;AACF"}},
    {"offset": {"line": 372, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/app/api/farms/%5BfarmId%5D/invites/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\r\nimport { z } from 'zod';\r\nimport { createErrorResponse, AppError } from '@/lib/errors';\r\nimport { getRequestRole } from '@/lib/permissions';\r\nimport { createInvite, listInvitesByFarm } from '@/lib/dev-invite-store';\r\nimport { sendInviteEmail } from '@/lib/invite-email';\r\n\r\nconst createInviteSchema = z.object({\r\n  email: z.string().email(),\r\n  role: z.enum(['MANAGER', 'WORKER']),\r\n});\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  context: { params: Promise<{ farmId: string }> }\r\n) {\r\n  try {\r\n    const { farmId } = await context.params;\r\n    const data = listInvitesByFarm(farmId);\r\n\r\n    return Response.json({ success: true, data });\r\n  } catch (error) {\r\n    return createErrorResponse(error);\r\n  }\r\n}\r\n\r\nexport async function POST(\r\n  request: NextRequest,\r\n  context: { params: Promise<{ farmId: string }> }\r\n) {\r\n  try {\r\n    const role = getRequestRole(request);\r\n    if (role !== 'OWNER') {\r\n      throw new AppError('FORBIDDEN', 'Only owners can invite users', 403);\r\n    }\r\n\r\n    const { farmId } = await context.params;\r\n    if (!farmId || farmId.trim().length < 2) {\r\n      throw new AppError('FARM_NOT_FOUND', 'Farm not found. Select a valid farm before sending invites.', 404);\r\n    }\r\n\r\n    const body = await request.json();\r\n    const input = createInviteSchema.parse(body);\r\n\r\n    const created = createInvite({\r\n      farmId,\r\n      email: input.email,\r\n      role: input.role,\r\n      origin: request.nextUrl.origin,\r\n    });\r\n\r\n    const delivery = await sendInviteEmail({\r\n      to: created.email,\r\n      inviteUrl: created.inviteUrl,\r\n      role: created.role,\r\n      farmId,\r\n    });\r\n\r\n    return Response.json({\r\n      success: true,\r\n      data: {\r\n        id: created.id,\r\n        email: created.email,\r\n        role: created.role,\r\n        inviteUrl: created.inviteUrl,\r\n        token: created.token,\r\n        expiresAt: created.expiresAt,\r\n        delivery,\r\n      },\r\n    });\r\n  } catch (error) {\r\n    return createErrorResponse(error);\r\n  }\r\n}\r\n"],"names":["createInviteSchema","object","email","string","role","enum","GET","request","context","farmId","params","data","Response","json","success","error","POST","trim","length","body","input","parse","created","origin","nextUrl","delivery","to","inviteUrl","id","token","expiresAt"],"mappings":";;;;;;AACA;AACA;AACA;AACA;AACA;;;;;;AAEA,MAAMA,qBAAqB,yKAAC,CAACC,MAAM,CAAC;IAClCC,OAAO,yKAAC,CAACC,MAAM,GAAGD,KAAK;IACvBE,MAAM,yKAAC,CAACC,IAAI,CAAC;QAAC;QAAW;KAAS;AACpC;AAEO,eAAeC,IACpBC,OAAoB,EACpBC,OAAgD;IAEhD,IAAI;QACF,MAAM,EAAEC,MAAM,EAAE,GAAG,MAAMD,QAAQE,MAAM;QACvC,MAAMC,OAAO,IAAA,2JAAiB,EAACF;QAE/B,OAAOG,SAASC,IAAI,CAAC;YAAEC,SAAS;YAAMH;QAAK;IAC7C,EAAE,OAAOI,OAAO;QACd,OAAO,IAAA,6IAAmB,EAACA;IAC7B;AACF;AAEO,eAAeC,KACpBT,OAAoB,EACpBC,OAAgD;IAEhD,IAAI;QACF,MAAMJ,OAAO,IAAA,6IAAc,EAACG;QAC5B,IAAIH,SAAS,SAAS;YACpB,MAAM,IAAI,kIAAQ,CAAC,aAAa,gCAAgC;QAClE;QAEA,MAAM,EAAEK,MAAM,EAAE,GAAG,MAAMD,QAAQE,MAAM;QACvC,IAAI,CAACD,UAAUA,OAAOQ,IAAI,GAAGC,MAAM,GAAG,GAAG;YACvC,MAAM,IAAI,kIAAQ,CAAC,kBAAkB,+DAA+D;QACtG;QAEA,MAAMC,OAAO,MAAMZ,QAAQM,IAAI;QAC/B,MAAMO,QAAQpB,mBAAmBqB,KAAK,CAACF;QAEvC,MAAMG,UAAU,IAAA,sJAAY,EAAC;YAC3Bb;YACAP,OAAOkB,MAAMlB,KAAK;YAClBE,MAAMgB,MAAMhB,IAAI;YAChBmB,QAAQhB,QAAQiB,OAAO,CAACD,MAAM;QAChC;QAEA,MAAME,WAAW,MAAM,IAAA,kJAAe,EAAC;YACrCC,IAAIJ,QAAQpB,KAAK;YACjByB,WAAWL,QAAQK,SAAS;YAC5BvB,MAAMkB,QAAQlB,IAAI;YAClBK;QACF;QAEA,OAAOG,SAASC,IAAI,CAAC;YACnBC,SAAS;YACTH,MAAM;gBACJiB,IAAIN,QAAQM,EAAE;gBACd1B,OAAOoB,QAAQpB,KAAK;gBACpBE,MAAMkB,QAAQlB,IAAI;gBAClBuB,WAAWL,QAAQK,SAAS;gBAC5BE,OAAOP,QAAQO,KAAK;gBACpBC,WAAWR,QAAQQ,SAAS;gBAC5BL;YACF;QACF;IACF,EAAE,OAAOV,OAAO;QACd,OAAO,IAAA,6IAAmB,EAACA;IAC7B;AACF"}}]
}