{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma = globalForPrisma.prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":["globalForPrisma","globalThis","prisma"],"mappings":";;;;AAAA;;AAEA,MAAMA,kBAAkBC;AAEjB,MAAMC,SAASF,gBAAgBE,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2CF,gBAAgBE,MAAM,GAAGA"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/errors.ts"],"sourcesContent":["export class AppError extends Error {\r\n  public code: string;\r\n  public status: number;\r\n  public details?: any;\r\n\r\n  constructor(code: string, message: string, status: number = 400, details?: any) {\r\n    super(message);\r\n    this.name = 'AppError';\r\n    this.code = code;\r\n    this.status = status;\r\n    this.details = details;\r\n  }\r\n}\r\n\r\nexport function createErrorResponse(error: any) {\r\n  if (error instanceof AppError || (error?.name === 'AppError' && error?.code && error?.message)) {\r\n    return Response.json(\r\n      { success: false, error: { code: error.code, message: error.message, details: error.details } },\r\n      { status: error.status || 400 }\r\n    );\r\n  }\r\n\r\n  if (error?.name === 'ZodError') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'VALIDATION_ERROR',\r\n          message: 'Invalid request payload',\r\n          details: error.issues ?? error.errors,\r\n        },\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  if (error?.code === 'P2002') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'CONFLICT',\r\n          message: 'A record with the same unique value already exists',\r\n          details: error.meta,\r\n        },\r\n      },\r\n      { status: 409 }\r\n    );\r\n  }\r\n\r\n  if (error?.code === 'P2003') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'RELATION_ERROR',\r\n          message: 'Related record is missing or invalid',\r\n          details: error.meta,\r\n        },\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  console.error('[Unhandled Error]:', error);\r\n\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: error?.code || 'INTERNAL_ERROR',\r\n          message: error?.message || 'Unknown server error',\r\n          details: error?.stack || error,\r\n        },\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n\r\n  return Response.json(\r\n    { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\r\n    { status: 500 }\r\n  );\r\n}\r\n"],"names":["AppError","Error","code","status","details","message","name","createErrorResponse","error","Response","json","success","issues","errors","meta","console","stack"],"mappings":";;;;;;AAAO,MAAMA,iBAAiBC;IACrBC,KAAa;IACbC,OAAe;IACfC,QAAc;IAErBJ,YAAYE,IAAY,EAAEG,OAAe,EAAEF,SAAiB,GAAG,EAAEC,OAAa,CAAE;QAC9E,KAAK,CAACC;QACN,IAAI,CAACC,IAAI,GAAG;QACZ,IAAI,CAACJ,IAAI,GAAGA;QACZ,IAAI,CAACC,MAAM,GAAGA;QACd,IAAI,CAACC,OAAO,GAAGA;IACjB;AACF;AAEO,SAASG,oBAAoBC,KAAU;IAC5C,IAAIA,iBAAiBR,YAAaQ,OAAOF,SAAS,cAAcE,OAAON,QAAQM,OAAOH,SAAU;QAC9F,OAAOI,SAASC,IAAI,CAClB;YAAEC,SAAS;YAAOH,OAAO;gBAAEN,MAAMM,MAAMN,IAAI;gBAAEG,SAASG,MAAMH,OAAO;gBAAED,SAASI,MAAMJ,OAAO;YAAC;QAAE,GAC9F;YAAED,QAAQK,MAAML,MAAM,IAAI;QAAI;IAElC;IAEA,IAAIK,OAAOF,SAAS,YAAY;QAC9B,OAAOG,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMI,MAAM,IAAIJ,MAAMK,MAAM;YACvC;QACF,GACA;YAAEV,QAAQ;QAAI;IAElB;IAEA,IAAIK,OAAON,SAAS,SAAS;QAC3B,OAAOO,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMM,IAAI;YACrB;QACF,GACA;YAAEX,QAAQ;QAAI;IAElB;IAEA,IAAIK,OAAON,SAAS,SAAS;QAC3B,OAAOO,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMM,IAAI;YACrB;QACF,GACA;YAAEX,QAAQ;QAAI;IAElB;IAEAY,QAAQP,KAAK,CAAC,sBAAsBA;IAEpC,wCAA2C;QACzC,OAAOC,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAMM,OAAON,QAAQ;gBACrBG,SAASG,OAAOH,WAAW;gBAC3BD,SAASI,OAAOQ,SAASR;YAC3B;QACF,GACA;YAAEL,QAAQ;QAAI;IAElB;;;AAMF"}},
    {"offset": {"line": 146, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/app/api/auth/login/route.ts"],"sourcesContent":["import { randomBytes, scryptSync, timingSafeEqual } from 'node:crypto';\nimport { z } from 'zod';\nimport { prisma } from '@/lib/prisma';\nimport { AppError, createErrorResponse } from '@/lib/errors';\n\nexport const runtime = 'nodejs';\n\nconst loginSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(8),\n});\n\nfunction verifyPassword(password: string, storedHash: string) {\n  const [salt, hash] = storedHash.split(':');\n  if (!salt || !hash) return false;\n\n  const passwordHash = scryptSync(password, salt, 64);\n  const storedHashBuffer = Buffer.from(hash, 'hex');\n\n  if (passwordHash.length !== storedHashBuffer.length) {\n    return false;\n  }\n\n  return timingSafeEqual(passwordHash, storedHashBuffer);\n}\n\nexport async function POST(request: Request) {\n  try {\n    const input = loginSchema.parse(await request.json());\n    const email = input.email.toLowerCase();\n\n    const user = await prisma.user.findUnique({\n      where: { email },\n      include: {\n        memberships: {\n          orderBy: { id: 'asc' },\n          take: 1,\n        },\n      },\n    });\n\n    if (!user || !verifyPassword(input.password, user.hashedPassword)) {\n      throw new AppError('INVALID_CREDENTIALS', 'Invalid email or password.', 401);\n    }\n\n    const membership = user.memberships[0];\n    if (!membership) {\n      throw new AppError('NO_FARM_ACCESS', 'No farm membership found for this account.', 403);\n    }\n\n    const sessionToken = randomBytes(32).toString('hex');\n    const expiresAt = new Date(Date.now() + 1000 * 60 * 60 * 24 * 30);\n\n    await prisma.session.create({\n      data: {\n        userId: user.id,\n        token: sessionToken,\n        expiresAt,\n      },\n    });\n\n    const response = Response.json({\n      success: true,\n      data: {\n        userId: user.id,\n        farmId: membership.farmId,\n        role: membership.role,\n      },\n    });\n\n    response.headers.append(\n      'Set-Cookie',\n      [\n        `session_token=${sessionToken}`,\n        'Path=/',\n        'HttpOnly',\n        'SameSite=Lax',\n        `Expires=${expiresAt.toUTCString()}`,\n        process.env.NODE_ENV === 'production' ? 'Secure' : '',\n      ]\n        .filter(Boolean)\n        .join('; ')\n    );\n\n    return response;\n  } catch (error) {\n    return createErrorResponse(error);\n  }\n}\r\n"],"names":["runtime","loginSchema","object","email","string","password","min","verifyPassword","storedHash","salt","hash","split","passwordHash","storedHashBuffer","Buffer","from","length","POST","request","input","parse","json","toLowerCase","user","findUnique","where","include","memberships","orderBy","id","take","hashedPassword","membership","sessionToken","toString","expiresAt","Date","now","session","create","data","userId","token","response","Response","success","farmId","role","headers","append","toUTCString","filter","Boolean","join","error"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAEO,MAAMA,UAAU;AAEvB,MAAMC,cAAc,yKAAC,CAACC,MAAM,CAAC;IAC3BC,OAAO,yKAAC,CAACC,MAAM,GAAGD,KAAK;IACvBE,UAAU,yKAAC,CAACD,MAAM,GAAGE,GAAG,CAAC;AAC3B;AAEA,SAASC,eAAeF,QAAgB,EAAEG,UAAkB;IAC1D,MAAM,CAACC,MAAMC,KAAK,GAAGF,WAAWG,KAAK,CAAC;IACtC,IAAI,CAACF,QAAQ,CAACC,MAAM,OAAO;IAE3B,MAAME,eAAe,IAAA,mIAAU,EAACP,UAAUI,MAAM;IAChD,MAAMI,mBAAmBC,OAAOC,IAAI,CAACL,MAAM;IAE3C,IAAIE,aAAaI,MAAM,KAAKH,iBAAiBG,MAAM,EAAE;QACnD,OAAO;IACT;IAEA,OAAO,IAAA,wIAAe,EAACJ,cAAcC;AACvC;AAEO,eAAeI,KAAKC,OAAgB;IACzC,IAAI;QACF,MAAMC,QAAQlB,YAAYmB,KAAK,CAAC,MAAMF,QAAQG,IAAI;QAClD,MAAMlB,QAAQgB,MAAMhB,KAAK,CAACmB,WAAW;QAErC,MAAMC,OAAO,MAAM,gIAAM,CAACA,IAAI,CAACC,UAAU,CAAC;YACxCC,OAAO;gBAAEtB;YAAM;YACfuB,SAAS;gBACPC,aAAa;oBACXC,SAAS;wBAAEC,IAAI;oBAAM;oBACrBC,MAAM;gBACR;YACF;QACF;QAEA,IAAI,CAACP,QAAQ,CAAChB,eAAeY,MAAMd,QAAQ,EAAEkB,KAAKQ,cAAc,GAAG;YACjE,MAAM,IAAI,kIAAQ,CAAC,uBAAuB,8BAA8B;QAC1E;QAEA,MAAMC,aAAaT,KAAKI,WAAW,CAAC,EAAE;QACtC,IAAI,CAACK,YAAY;YACf,MAAM,IAAI,kIAAQ,CAAC,kBAAkB,8CAA8C;QACrF;QAEA,MAAMC,eAAe,IAAA,oIAAW,EAAC,IAAIC,QAAQ,CAAC;QAC9C,MAAMC,YAAY,IAAIC,KAAKA,KAAKC,GAAG,KAAK,OAAO,KAAK,KAAK,KAAK;QAE9D,MAAM,gIAAM,CAACC,OAAO,CAACC,MAAM,CAAC;YAC1BC,MAAM;gBACJC,QAAQlB,KAAKM,EAAE;gBACfa,OAAOT;gBACPE;YACF;QACF;QAEA,MAAMQ,WAAWC,SAASvB,IAAI,CAAC;YAC7BwB,SAAS;YACTL,MAAM;gBACJC,QAAQlB,KAAKM,EAAE;gBACfiB,QAAQd,WAAWc,MAAM;gBACzBC,MAAMf,WAAWe,IAAI;YACvB;QACF;QAEAJ,SAASK,OAAO,CAACC,MAAM,CACrB,cACA;YACE,CAAC,cAAc,EAAEhB,cAAc;YAC/B;YACA;YACA;YACA,CAAC,QAAQ,EAAEE,UAAUe,WAAW,IAAI;YACpC,sCAAwC,0BAAW;SACpD,CACEC,MAAM,CAACC,SACPC,IAAI,CAAC;QAGV,OAAOV;IACT,EAAE,OAAOW,OAAO;QACd,OAAO,IAAA,6IAAmB,EAACA;IAC7B;AACF"}}]
}