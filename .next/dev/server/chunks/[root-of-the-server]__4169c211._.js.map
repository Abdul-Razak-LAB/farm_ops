{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma = globalForPrisma.prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":["globalForPrisma","globalThis","prisma"],"mappings":";;;;AAAA;;AAEA,MAAMA,kBAAkBC;AAEjB,MAAMC,SAASF,gBAAgBE,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2CF,gBAAgBE,MAAM,GAAGA"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/errors.ts"],"sourcesContent":["export class AppError extends Error {\r\n  public code: string;\r\n  public status: number;\r\n  public details?: any;\r\n\r\n  constructor(code: string, message: string, status: number = 400, details?: any) {\r\n    super(message);\r\n    this.name = 'AppError';\r\n    this.code = code;\r\n    this.status = status;\r\n    this.details = details;\r\n  }\r\n}\r\n\r\nexport function createErrorResponse(error: any) {\r\n  if (error instanceof AppError || (error?.name === 'AppError' && error?.code && error?.message)) {\r\n    return Response.json(\r\n      { success: false, error: { code: error.code, message: error.message, details: error.details } },\r\n      { status: error.status || 400 }\r\n    );\r\n  }\r\n\r\n  if (error?.name === 'ZodError') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'VALIDATION_ERROR',\r\n          message: 'Invalid request payload',\r\n          details: error.issues ?? error.errors,\r\n        },\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  if (error?.code === 'P2002') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'CONFLICT',\r\n          message: 'A record with the same unique value already exists',\r\n          details: error.meta,\r\n        },\r\n      },\r\n      { status: 409 }\r\n    );\r\n  }\r\n\r\n  if (error?.code === 'P2003') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'RELATION_ERROR',\r\n          message: 'Related record is missing or invalid',\r\n          details: error.meta,\r\n        },\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  console.error('[Unhandled Error]:', error);\r\n\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: error?.code || 'INTERNAL_ERROR',\r\n          message: error?.message || 'Unknown server error',\r\n          details: error?.stack || error,\r\n        },\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n\r\n  return Response.json(\r\n    { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\r\n    { status: 500 }\r\n  );\r\n}\r\n"],"names":["AppError","Error","code","status","details","message","name","createErrorResponse","error","Response","json","success","issues","errors","meta","console","stack"],"mappings":";;;;;;AAAO,MAAMA,iBAAiBC;IACrBC,KAAa;IACbC,OAAe;IACfC,QAAc;IAErBJ,YAAYE,IAAY,EAAEG,OAAe,EAAEF,SAAiB,GAAG,EAAEC,OAAa,CAAE;QAC9E,KAAK,CAACC;QACN,IAAI,CAACC,IAAI,GAAG;QACZ,IAAI,CAACJ,IAAI,GAAGA;QACZ,IAAI,CAACC,MAAM,GAAGA;QACd,IAAI,CAACC,OAAO,GAAGA;IACjB;AACF;AAEO,SAASG,oBAAoBC,KAAU;IAC5C,IAAIA,iBAAiBR,YAAaQ,OAAOF,SAAS,cAAcE,OAAON,QAAQM,OAAOH,SAAU;QAC9F,OAAOI,SAASC,IAAI,CAClB;YAAEC,SAAS;YAAOH,OAAO;gBAAEN,MAAMM,MAAMN,IAAI;gBAAEG,SAASG,MAAMH,OAAO;gBAAED,SAASI,MAAMJ,OAAO;YAAC;QAAE,GAC9F;YAAED,QAAQK,MAAML,MAAM,IAAI;QAAI;IAElC;IAEA,IAAIK,OAAOF,SAAS,YAAY;QAC9B,OAAOG,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMI,MAAM,IAAIJ,MAAMK,MAAM;YACvC;QACF,GACA;YAAEV,QAAQ;QAAI;IAElB;IAEA,IAAIK,OAAON,SAAS,SAAS;QAC3B,OAAOO,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMM,IAAI;YACrB;QACF,GACA;YAAEX,QAAQ;QAAI;IAElB;IAEA,IAAIK,OAAON,SAAS,SAAS;QAC3B,OAAOO,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMM,IAAI;YACrB;QACF,GACA;YAAEX,QAAQ;QAAI;IAElB;IAEAY,QAAQP,KAAK,CAAC,sBAAsBA;IAEpC,wCAA2C;QACzC,OAAOC,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAMM,OAAON,QAAQ;gBACrBG,SAASG,OAAOH,WAAW;gBAC3BD,SAASI,OAAOQ,SAASR;YAC3B;QACF,GACA;YAAEL,QAAQ;QAAI;IAElB;;;AAMF"}},
    {"offset": {"line": 146, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/app/api/auth/signup/route.ts"],"sourcesContent":["import { randomBytes, scryptSync } from 'node:crypto';\nimport { z } from 'zod';\nimport { prisma } from '@/lib/prisma';\nimport { AppError, createErrorResponse } from '@/lib/errors';\n\nexport const runtime = 'nodejs';\n\nconst signupSchema = z.object({\n  fullName: z.string().min(2),\n  email: z.string().email(),\n  phone: z.string().optional(),\n  password: z.string().min(8),\n});\n\nfunction hashPassword(password: string) {\n  const salt = randomBytes(16).toString('hex');\n  const hash = scryptSync(password, salt, 64).toString('hex');\n  return `${salt}:${hash}`;\n}\n\nexport async function POST(request: Request) {\n  try {\n    const input = signupSchema.parse(await request.json());\n    const email = input.email.toLowerCase();\n\n    const existing = await prisma.user.findUnique({ where: { email } });\n    if (existing) {\n      throw new AppError('EMAIL_IN_USE', 'An account with this email already exists.', 409);\n    }\n\n    const result = await prisma.$transaction(async (tx) => {\n      const user = await tx.user.create({\n        data: {\n          email,\n          name: input.fullName,\n          hashedPassword: hashPassword(input.password),\n        },\n      });\n\n      const farm = await tx.farm.create({\n        data: {\n          name: `${input.fullName.split(' ')[0] || 'My'} Farm`,\n        },\n      });\n\n      await tx.farmMembership.create({\n        data: {\n          farmId: farm.id,\n          userId: user.id,\n          role: 'OWNER',\n        },\n      });\n\n      const sessionToken = randomBytes(32).toString('hex');\n      const expiresAt = new Date(Date.now() + 1000 * 60 * 60 * 24 * 30);\n\n      await tx.session.create({\n        data: {\n          userId: user.id,\n          token: sessionToken,\n          expiresAt,\n        },\n      });\n\n      return { user, farm, sessionToken, expiresAt };\n    });\n\n    const response = Response.json({\n      success: true,\n      data: {\n        userId: result.user.id,\n        farmId: result.farm.id,\n        role: 'OWNER' as const,\n        phone: input.phone || null,\n      },\n    });\n\n    response.headers.append(\n      'Set-Cookie',\n      [\n        `session_token=${result.sessionToken}`,\n        'Path=/',\n        'HttpOnly',\n        'SameSite=Lax',\n        `Expires=${result.expiresAt.toUTCString()}`,\n        process.env.NODE_ENV === 'production' ? 'Secure' : '',\n      ]\n        .filter(Boolean)\n        .join('; ')\n    );\n\n    return response;\n  } catch (error) {\n    return createErrorResponse(error);\n  }\n}\r\n"],"names":["runtime","signupSchema","object","fullName","string","min","email","phone","optional","password","hashPassword","salt","toString","hash","POST","request","input","parse","json","toLowerCase","existing","user","findUnique","where","result","$transaction","tx","create","data","name","hashedPassword","farm","split","farmMembership","farmId","id","userId","role","sessionToken","expiresAt","Date","now","session","token","response","Response","success","headers","append","toUTCString","filter","Boolean","join","error"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAEO,MAAMA,UAAU;AAEvB,MAAMC,eAAe,yKAAC,CAACC,MAAM,CAAC;IAC5BC,UAAU,yKAAC,CAACC,MAAM,GAAGC,GAAG,CAAC;IACzBC,OAAO,yKAAC,CAACF,MAAM,GAAGE,KAAK;IACvBC,OAAO,yKAAC,CAACH,MAAM,GAAGI,QAAQ;IAC1BC,UAAU,yKAAC,CAACL,MAAM,GAAGC,GAAG,CAAC;AAC3B;AAEA,SAASK,aAAaD,QAAgB;IACpC,MAAME,OAAO,IAAA,oIAAW,EAAC,IAAIC,QAAQ,CAAC;IACtC,MAAMC,OAAO,IAAA,mIAAU,EAACJ,UAAUE,MAAM,IAAIC,QAAQ,CAAC;IACrD,OAAO,GAAGD,KAAK,CAAC,EAAEE,MAAM;AAC1B;AAEO,eAAeC,KAAKC,OAAgB;IACzC,IAAI;QACF,MAAMC,QAAQf,aAAagB,KAAK,CAAC,MAAMF,QAAQG,IAAI;QACnD,MAAMZ,QAAQU,MAAMV,KAAK,CAACa,WAAW;QAErC,MAAMC,WAAW,MAAM,gIAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YAAEC,OAAO;gBAAEjB;YAAM;QAAE;QACjE,IAAIc,UAAU;YACZ,MAAM,IAAI,kIAAQ,CAAC,gBAAgB,8CAA8C;QACnF;QAEA,MAAMI,SAAS,MAAM,gIAAM,CAACC,YAAY,CAAC,OAAOC;YAC9C,MAAML,OAAO,MAAMK,GAAGL,IAAI,CAACM,MAAM,CAAC;gBAChCC,MAAM;oBACJtB;oBACAuB,MAAMb,MAAMb,QAAQ;oBACpB2B,gBAAgBpB,aAAaM,MAAMP,QAAQ;gBAC7C;YACF;YAEA,MAAMsB,OAAO,MAAML,GAAGK,IAAI,CAACJ,MAAM,CAAC;gBAChCC,MAAM;oBACJC,MAAM,GAAGb,MAAMb,QAAQ,CAAC6B,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,KAAK,KAAK,CAAC;gBACtD;YACF;YAEA,MAAMN,GAAGO,cAAc,CAACN,MAAM,CAAC;gBAC7BC,MAAM;oBACJM,QAAQH,KAAKI,EAAE;oBACfC,QAAQf,KAAKc,EAAE;oBACfE,MAAM;gBACR;YACF;YAEA,MAAMC,eAAe,IAAA,oIAAW,EAAC,IAAI1B,QAAQ,CAAC;YAC9C,MAAM2B,YAAY,IAAIC,KAAKA,KAAKC,GAAG,KAAK,OAAO,KAAK,KAAK,KAAK;YAE9D,MAAMf,GAAGgB,OAAO,CAACf,MAAM,CAAC;gBACtBC,MAAM;oBACJQ,QAAQf,KAAKc,EAAE;oBACfQ,OAAOL;oBACPC;gBACF;YACF;YAEA,OAAO;gBAAElB;gBAAMU;gBAAMO;gBAAcC;YAAU;QAC/C;QAEA,MAAMK,WAAWC,SAAS3B,IAAI,CAAC;YAC7B4B,SAAS;YACTlB,MAAM;gBACJQ,QAAQZ,OAAOH,IAAI,CAACc,EAAE;gBACtBD,QAAQV,OAAOO,IAAI,CAACI,EAAE;gBACtBE,MAAM;gBACN9B,OAAOS,MAAMT,KAAK,IAAI;YACxB;QACF;QAEAqC,SAASG,OAAO,CAACC,MAAM,CACrB,cACA;YACE,CAAC,cAAc,EAAExB,OAAOc,YAAY,EAAE;YACtC;YACA;YACA;YACA,CAAC,QAAQ,EAAEd,OAAOe,SAAS,CAACU,WAAW,IAAI;YAC3C,sCAAwC,0BAAW;SACpD,CACEC,MAAM,CAACC,SACPC,IAAI,CAAC;QAGV,OAAOR;IACT,EAAE,OAAOS,OAAO;QACd,OAAO,IAAA,6IAAmB,EAACA;IAC7B;AACF"}}]
}