{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/app/register/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/components/layout/auth-provider';\r\n\r\ntype BeforeInstallPromptEvent = Event & {\r\n  prompt: () => Promise<void>;\r\n  userChoice: Promise<{ outcome: 'accepted' | 'dismissed'; platform: string }>;\r\n};\r\n\r\nexport default function RegisterPage() {\r\n  const router = useRouter();\r\n  const { setFarmId, setRole, setRegistered } = useAuth();\r\n\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [showConfirm, setShowConfirm] = useState(false);\r\n  const [fullName, setFullName] = useState('');\r\n  const [email, setEmail] = useState('');\r\n  const [phone, setPhone] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [confirmPassword, setConfirmPassword] = useState('');\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [showInstallBanner, setShowInstallBanner] = useState(true);\r\n  const [installMessage, setInstallMessage] = useState('');\r\n  const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);\r\n\r\n  useEffect(() => {\r\n    const handleBeforeInstallPrompt = (event: Event) => {\r\n      event.preventDefault();\r\n      setDeferredPrompt(event as BeforeInstallPromptEvent);\r\n      setInstallMessage('');\r\n    };\r\n\r\n    const handleAppInstalled = () => {\r\n      setDeferredPrompt(null);\r\n      setShowInstallBanner(false);\r\n    };\r\n\r\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n    window.addEventListener('appinstalled', handleAppInstalled);\r\n\r\n    return () => {\r\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n      window.removeEventListener('appinstalled', handleAppInstalled);\r\n    };\r\n  }, []);\r\n\r\n  const installApp = async () => {\r\n    setInstallMessage('');\r\n\r\n    if (!deferredPrompt) {\r\n      setInstallMessage('Install is not available yet. Open browser menu and choose Install app/Add to Home Screen.');\r\n      return;\r\n    }\r\n\r\n    await deferredPrompt.prompt();\r\n    const choice = await deferredPrompt.userChoice;\r\n\r\n    if (choice.outcome === 'accepted') {\r\n      setShowInstallBanner(false);\r\n    }\r\n\r\n    setDeferredPrompt(null);\r\n  };\r\n\r\n  const submit = async (event: React.FormEvent<HTMLFormElement>) => {\r\n    event.preventDefault();\r\n    setError('');\r\n\r\n    if (!fullName.trim() || !email.trim() || !password.trim()) {\r\n      setError('Full name, email, and password are required.');\r\n      return;\r\n    }\r\n\r\n    if (password.length < 8) {\r\n      setError('Password must be at least 8 characters.');\r\n      return;\r\n    }\r\n\r\n    if (password !== confirmPassword) {\r\n      setError('Passwords do not match.');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsSubmitting(true);\r\n\r\n      const response = await fetch('/api/auth/signup', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          fullName: fullName.trim(),\r\n          email: email.trim(),\r\n          phone: phone.trim() || undefined,\r\n          password,\r\n        }),\r\n      });\r\n\r\n      const contentType = response.headers.get('content-type') || '';\r\n      const result = contentType.includes('application/json')\r\n        ? await response.json()\r\n        : { success: false, error: { message: 'Server returned a non-JSON response. Check /api/auth/signup route.' } };\r\n\r\n      if (!result.success) {\r\n        const errorCode = result.error?.code;\r\n        const errorMessage = String(result.error?.message || '').toLowerCase();\r\n        const shouldRedirectToLogin =\r\n          errorCode === 'EMAIL_IN_USE' ||\r\n          errorCode === 'CONFLICT' ||\r\n          errorMessage.includes('already exists') ||\r\n          errorMessage.includes('email in use');\r\n\r\n        if (shouldRedirectToLogin) {\r\n          setRegistered(true);\r\n          router.push(`/login?email=${encodeURIComponent(email.trim())}`);\r\n          return;\r\n        }\r\n        throw new Error(result.error?.message || 'Failed to create account');\r\n      }\r\n\r\n      setRegistered(true);\r\n      setFarmId(result.data.farmId);\r\n      setRole(result.data.role);\r\n      router.push('/');\r\n    } catch (submitError) {\r\n      setError(submitError instanceof Error ? submitError.message : 'Failed to create account');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-muted/30 px-4 py-10 md:py-16\">\r\n      <div className=\"mx-auto w-full max-w-md rounded-2xl border bg-card p-5 md:p-6 shadow-sm\">\r\n        <div className=\"mb-5 flex items-start gap-3\">\r\n          <div className=\"mt-1 h-9 w-9 rounded-md bg-primary text-primary-foreground flex items-center justify-center text-sm font-black\">\r\n            F\r\n          </div>\r\n          <div>\r\n            <h1 className=\"text-2xl font-black leading-none\">FarmOSP</h1>\r\n            <p className=\"text-sm text-muted-foreground mt-1\">Get started with FarmOSP today</p>\r\n          </div>\r\n        </div>\r\n\r\n        <form className=\"space-y-3\" onSubmit={submit}>\r\n          <div className=\"space-y-1\">\r\n            <label htmlFor=\"fullName\" className=\"text-sm font-semibold\">Full Name</label>\r\n            <input\r\n              id=\"fullName\"\r\n              name=\"fullName\"\r\n              placeholder=\"John Doe\"\r\n              value={fullName}\r\n              onChange={(event) => setFullName(event.target.value)}\r\n              className=\"h-11 w-full rounded-md border bg-background px-3 text-sm\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"space-y-1\">\r\n            <label htmlFor=\"email\" className=\"text-sm font-semibold\">Email</label>\r\n            <input\r\n              id=\"email\"\r\n              name=\"email\"\r\n              type=\"email\"\r\n              placeholder=\"name@example.com\"\r\n              value={email}\r\n              onChange={(event) => setEmail(event.target.value)}\r\n              className=\"h-11 w-full rounded-md border bg-background px-3 text-sm\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"space-y-1\">\r\n            <label htmlFor=\"phone\" className=\"text-sm font-semibold\">Phone (Optional)</label>\r\n            <input\r\n              id=\"phone\"\r\n              name=\"phone\"\r\n              placeholder=\"0241234567\"\r\n              value={phone}\r\n              onChange={(event) => setPhone(event.target.value)}\r\n              className=\"h-11 w-full rounded-md border bg-background px-3 text-sm\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"grid gap-3 sm:grid-cols-2\">\r\n            <div className=\"space-y-1\">\r\n              <label htmlFor=\"password\" className=\"text-sm font-semibold\">Password</label>\r\n              <div className=\"relative\">\r\n                <input\r\n                  id=\"password\"\r\n                  name=\"password\"\r\n                  type={showPassword ? 'text' : 'password'}\r\n                  value={password}\r\n                  onChange={(event) => setPassword(event.target.value)}\r\n                  className=\"h-11 w-full rounded-md border bg-background px-3 pr-11 text-sm\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowPassword((current) => !current)}\r\n                  className=\"absolute right-2 top-1/2 -translate-y-1/2 rounded px-2 py-1 text-xs text-muted-foreground\"\r\n                >\r\n                  {showPassword ? 'Hide' : 'Show'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <label htmlFor=\"confirmPassword\" className=\"text-sm font-semibold\">Confirm</label>\r\n              <div className=\"relative\">\r\n                <input\r\n                  id=\"confirmPassword\"\r\n                  name=\"confirmPassword\"\r\n                  type={showConfirm ? 'text' : 'password'}\r\n                  value={confirmPassword}\r\n                  onChange={(event) => setConfirmPassword(event.target.value)}\r\n                  className=\"h-11 w-full rounded-md border bg-background px-3 pr-11 text-sm\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowConfirm((current) => !current)}\r\n                  className=\"absolute right-2 top-1/2 -translate-y-1/2 rounded px-2 py-1 text-xs text-muted-foreground\"\r\n                >\r\n                  {showConfirm ? 'Hide' : 'Show'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {error ? <p className=\"text-xs text-destructive\">{error}</p> : null}\r\n\r\n          <button\r\n            type=\"submit\"\r\n            disabled={isSubmitting}\r\n            className=\"mt-2 h-11 w-full rounded-md bg-primary text-sm font-semibold text-primary-foreground disabled:opacity-60\"\r\n          >\r\n            {isSubmitting ? 'Creating account...' : 'Create account'}\r\n          </button>\r\n        </form>\r\n\r\n        <p className=\"mt-5 text-center text-sm text-muted-foreground\">\r\n          Already have an account?{' '}\r\n          <Link href=\"/login\" className=\"font-semibold text-primary\">Sign In</Link>\r\n        </p>\r\n      </div>\r\n\r\n      {showInstallBanner ? (\r\n      <div className=\"mx-auto mt-6 w-full max-w-3xl rounded-2xl border bg-card px-4 py-4 md:px-5\">\r\n        <div className=\"flex flex-col gap-3 md:flex-row md:items-center md:justify-between\">\r\n          <div>\r\n            <p className=\"text-sm font-semibold\">Install FarmOSP</p>\r\n            <p className=\"text-xs text-muted-foreground\">Save this workspace as an app for faster field access.</p>\r\n            {installMessage ? <p className=\"mt-1 text-xs text-muted-foreground\">{installMessage}</p> : null}\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => void installApp()}\r\n              className=\"h-9 rounded-md bg-primary px-4 text-sm font-semibold text-primary-foreground\"\r\n            >\r\n              Install\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setShowInstallBanner(false)}\r\n              className=\"h-9 rounded-md border px-4 text-sm font-semibold\"\r\n            >\r\n              Not now\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      ) : null}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["RegisterPage","router","setFarmId","setRole","setRegistered","showPassword","setShowPassword","showConfirm","setShowConfirm","fullName","setFullName","email","setEmail","phone","setPhone","password","setPassword","confirmPassword","setConfirmPassword","isSubmitting","setIsSubmitting","error","setError","showInstallBanner","setShowInstallBanner","installMessage","setInstallMessage","deferredPrompt","setDeferredPrompt","handleBeforeInstallPrompt","event","preventDefault","handleAppInstalled","window","addEventListener","removeEventListener","installApp","prompt","choice","userChoice","outcome","submit","trim","length","response","fetch","method","headers","body","JSON","stringify","undefined","contentType","get","result","includes","json","success","message","errorCode","code","errorMessage","String","toLowerCase","shouldRedirectToLogin","push","encodeURIComponent","Error","data","farmId","role","submitError","className","onSubmit","htmlFor","id","name","placeholder","value","onChange","target","type","onClick","current","disabled","href"],"mappings":"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"}}]
}