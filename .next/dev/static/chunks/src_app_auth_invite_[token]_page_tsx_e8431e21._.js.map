{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/app/auth/invite/%5Btoken%5D/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useMemo, useState } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\n\r\ntype InviteDetails = {\r\n  token: string;\r\n  farmId: string;\r\n  email: string;\r\n  role: 'MANAGER' | 'WORKER';\r\n  status: 'PENDING' | 'ACCEPTED' | 'EXPIRED';\r\n  expiresAt: string;\r\n};\r\n\r\nexport default function InviteAcceptPage() {\r\n  const { token } = useParams<{ token: string }>();\r\n  const router = useRouter();\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [invite, setInvite] = useState<InviteDetails | null>(null);\r\n  const [error, setError] = useState('');\r\n  const [mode, setMode] = useState<'LOGIN' | 'SIGNUP'>('SIGNUP');\r\n  const [email, setEmail] = useState('');\r\n  const [name, setName] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const fetchInvite = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const response = await fetch(`/api/auth/invites/${token}`);\r\n        const json = await response.json();\r\n\r\n        if (!json.success) {\r\n          throw new Error(json.error?.message || 'Invite not found');\r\n        }\r\n\r\n        setInvite(json.data);\r\n        setEmail(json.data.email);\r\n      } catch (err) {\r\n        setError(err instanceof Error ? err.message : 'Failed to load invite');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    if (token) {\r\n      void fetchInvite();\r\n    }\r\n  }, [token]);\r\n\r\n  const canAccept = useMemo(() => {\r\n    if (!invite) return false;\r\n    return invite.status === 'PENDING';\r\n  }, [invite]);\r\n\r\n  const acceptInvite = async () => {\r\n    if (!invite) return;\r\n\r\n    try {\r\n      setSubmitting(true);\r\n      setError('');\r\n\r\n      const response = await fetch(`/api/auth/invites/${invite.token}/accept`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          mode,\r\n          email,\r\n          name: mode === 'SIGNUP' ? name : undefined,\r\n          password,\r\n        }),\r\n      });\r\n\r\n      const json = await response.json();\r\n      if (!json.success) {\r\n        throw new Error(json.error?.message || 'Failed to accept invite');\r\n      }\r\n\r\n      localStorage.setItem('farmops.role', json.data.role);\r\n      localStorage.setItem('farmops.farmId', json.data.farmId);\r\n\r\n      router.push('/');\r\n      router.refresh();\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to accept invite');\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"p-6 max-w-md mx-auto\">Loading invite...</div>;\r\n  }\r\n\r\n  if (error && !invite) {\r\n    return <div className=\"p-6 max-w-md mx-auto text-destructive\">{error}</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-8 max-w-md mx-auto space-y-4\">\r\n      <header className=\"space-y-1\">\r\n        <h1 className=\"text-2xl font-bold\">Farm Invite</h1>\r\n        <p className=\"text-sm text-muted-foreground\">Accept invite to join farm workspace</p>\r\n      </header>\r\n\r\n      {invite ? (\r\n        <section className=\"rounded-xl border bg-card p-4 space-y-2 text-sm\">\r\n          <p><span className=\"font-semibold\">Email:</span> {invite.email}</p>\r\n          <p><span className=\"font-semibold\">Role:</span> {invite.role}</p>\r\n          <p><span className=\"font-semibold\">Farm:</span> {invite.farmId}</p>\r\n          <p><span className=\"font-semibold\">Status:</span> {invite.status}</p>\r\n        </section>\r\n      ) : null}\r\n\r\n      {canAccept ? (\r\n        <section className=\"rounded-xl border bg-card p-4 space-y-3\">\r\n          <div className=\"grid grid-cols-2 gap-2 rounded-lg bg-accent/30 p-1\">\r\n            <button\r\n              onClick={() => setMode('SIGNUP')}\r\n              className={`h-9 rounded-md text-xs font-semibold ${mode === 'SIGNUP' ? 'bg-primary text-primary-foreground' : 'text-muted-foreground'}`}\r\n            >\r\n              Sign Up\r\n            </button>\r\n            <button\r\n              onClick={() => setMode('LOGIN')}\r\n              className={`h-9 rounded-md text-xs font-semibold ${mode === 'LOGIN' ? 'bg-primary text-primary-foreground' : 'text-muted-foreground'}`}\r\n            >\r\n              Login\r\n            </button>\r\n          </div>\r\n\r\n          <input\r\n            value={email}\r\n            onChange={(event) => setEmail(event.target.value)}\r\n            className=\"w-full h-10 rounded-md bg-accent/50 px-3 text-sm\"\r\n            placeholder=\"Email\"\r\n          />\r\n\r\n          {mode === 'SIGNUP' ? (\r\n            <input\r\n              value={name}\r\n              onChange={(event) => setName(event.target.value)}\r\n              className=\"w-full h-10 rounded-md bg-accent/50 px-3 text-sm\"\r\n              placeholder=\"Full name\"\r\n            />\r\n          ) : null}\r\n\r\n          <input\r\n            type=\"password\"\r\n            value={password}\r\n            onChange={(event) => setPassword(event.target.value)}\r\n            className=\"w-full h-10 rounded-md bg-accent/50 px-3 text-sm\"\r\n            placeholder=\"Password\"\r\n          />\r\n\r\n          {error ? <p className=\"text-xs text-destructive\">{error}</p> : null}\r\n\r\n          <button\r\n            onClick={() => void acceptInvite()}\r\n            disabled={submitting || !email || !password || (mode === 'SIGNUP' && name.trim().length < 2)}\r\n            className=\"w-full h-10 rounded-md bg-primary text-primary-foreground text-sm font-semibold disabled:opacity-50\"\r\n          >\r\n            {submitting ? 'Submitting...' : mode === 'SIGNUP' ? 'Sign Up & Accept Invite' : 'Login & Accept Invite'}\r\n          </button>\r\n        </section>\r\n      ) : (\r\n        <section className=\"rounded-xl border bg-card p-4\">\r\n          <p className=\"text-sm text-muted-foreground\">This invite is not active. Ask the owner to resend a new email link.</p>\r\n        </section>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["InviteAcceptPage","token","router","loading","setLoading","invite","setInvite","error","setError","mode","setMode","email","setEmail","name","setName","password","setPassword","submitting","setSubmitting","fetchInvite","response","fetch","json","success","Error","message","data","err","canAccept","status","acceptInvite","method","headers","body","JSON","stringify","undefined","localStorage","setItem","role","farmId","push","refresh","className","onClick","value","onChange","event","target","placeholder","type","disabled","trim","length"],"mappings":"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"}}]
}