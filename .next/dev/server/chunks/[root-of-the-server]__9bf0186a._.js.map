{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/errors.ts"],"sourcesContent":["export class AppError extends Error {\r\n  public code: string;\r\n  public status: number;\r\n  public details?: any;\r\n\r\n  constructor(code: string, message: string, status: number = 400, details?: any) {\r\n    super(message);\r\n    this.name = 'AppError';\r\n    this.code = code;\r\n    this.status = status;\r\n    this.details = details;\r\n  }\r\n}\r\n\r\nexport function createErrorResponse(error: any) {\r\n  if (error instanceof AppError || (error?.name === 'AppError' && error?.code && error?.message)) {\r\n    return Response.json(\r\n      { success: false, error: { code: error.code, message: error.message, details: error.details } },\r\n      { status: error.status || 400 }\r\n    );\r\n  }\r\n\r\n  if (error?.name === 'ZodError') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'VALIDATION_ERROR',\r\n          message: 'Invalid request payload',\r\n          details: error.issues ?? error.errors,\r\n        },\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  if (error?.code === 'P2002') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'CONFLICT',\r\n          message: 'A record with the same unique value already exists',\r\n          details: error.meta,\r\n        },\r\n      },\r\n      { status: 409 }\r\n    );\r\n  }\r\n\r\n  if (error?.code === 'P2003') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'RELATION_ERROR',\r\n          message: 'Related record is missing or invalid',\r\n          details: error.meta,\r\n        },\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  console.error('[Unhandled Error]:', error);\r\n\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: error?.code || 'INTERNAL_ERROR',\r\n          message: error?.message || 'Unknown server error',\r\n          details: error?.stack || error,\r\n        },\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n\r\n  return Response.json(\r\n    { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\r\n    { status: 500 }\r\n  );\r\n}\r\n"],"names":["AppError","Error","code","status","details","message","name","createErrorResponse","error","Response","json","success","issues","errors","meta","console","stack"],"mappings":";;;;;;AAAO,MAAMA,iBAAiBC;IACrBC,KAAa;IACbC,OAAe;IACfC,QAAc;IAErBJ,YAAYE,IAAY,EAAEG,OAAe,EAAEF,SAAiB,GAAG,EAAEC,OAAa,CAAE;QAC9E,KAAK,CAACC;QACN,IAAI,CAACC,IAAI,GAAG;QACZ,IAAI,CAACJ,IAAI,GAAGA;QACZ,IAAI,CAACC,MAAM,GAAGA;QACd,IAAI,CAACC,OAAO,GAAGA;IACjB;AACF;AAEO,SAASG,oBAAoBC,KAAU;IAC5C,IAAIA,iBAAiBR,YAAaQ,OAAOF,SAAS,cAAcE,OAAON,QAAQM,OAAOH,SAAU;QAC9F,OAAOI,SAASC,IAAI,CAClB;YAAEC,SAAS;YAAOH,OAAO;gBAAEN,MAAMM,MAAMN,IAAI;gBAAEG,SAASG,MAAMH,OAAO;gBAAED,SAASI,MAAMJ,OAAO;YAAC;QAAE,GAC9F;YAAED,QAAQK,MAAML,MAAM,IAAI;QAAI;IAElC;IAEA,IAAIK,OAAOF,SAAS,YAAY;QAC9B,OAAOG,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMI,MAAM,IAAIJ,MAAMK,MAAM;YACvC;QACF,GACA;YAAEV,QAAQ;QAAI;IAElB;IAEA,IAAIK,OAAON,SAAS,SAAS;QAC3B,OAAOO,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMM,IAAI;YACrB;QACF,GACA;YAAEX,QAAQ;QAAI;IAElB;IAEA,IAAIK,OAAON,SAAS,SAAS;QAC3B,OAAOO,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMM,IAAI;YACrB;QACF,GACA;YAAEX,QAAQ;QAAI;IAElB;IAEAY,QAAQP,KAAK,CAAC,sBAAsBA;IAEpC,wCAA2C;QACzC,OAAOC,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAMM,OAAON,QAAQ;gBACrBG,SAASG,OAAOH,WAAW;gBAC3BD,SAASI,OAAOQ,SAASR;YAC3B;QACF,GACA;YAAEL,QAAQ;QAAI;IAElB;;;AAMF"}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/permissions.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\r\nimport { AppError } from './errors';\r\n\r\nexport type FarmPermission =\r\n  | 'finance:read'\r\n  | 'finance:write'\r\n  | 'finance:approve'\r\n  | 'updates:read'\r\n  | 'updates:write'\r\n  | 'digest:read'\r\n  | 'monitoring:read'\r\n  | 'monitoring:write'\r\n  | 'incident:read'\r\n  | 'incident:write'\r\n  | 'vendor:read'\r\n  | 'vendor:write'\r\n  | 'procurement:read'\r\n  | 'procurement:write'\r\n  | 'payroll:read'\r\n  | 'payroll:write'\r\n  | 'payroll:approve'\r\n  | 'payroll:pay';\r\n\r\ntype FarmRole = 'OWNER' | 'MANAGER' | 'WORKER';\r\n\r\nconst roleMatrix: Record<FarmRole, FarmPermission[]> = {\r\n  OWNER: [\r\n    'finance:read',\r\n    'finance:write',\r\n    'finance:approve',\r\n    'updates:read',\r\n    'updates:write',\r\n    'digest:read',\r\n    'monitoring:read',\r\n    'monitoring:write',\r\n    'incident:read',\r\n    'incident:write',\r\n    'vendor:read',\r\n    'vendor:write',\r\n    'procurement:read',\r\n    'procurement:write',\r\n    'payroll:read',\r\n    'payroll:write',\r\n    'payroll:approve',\r\n    'payroll:pay',\r\n  ],\r\n  MANAGER: [\r\n    'finance:read',\r\n    'finance:write',\r\n    'updates:read',\r\n    'updates:write',\r\n    'digest:read',\r\n    'monitoring:read',\r\n    'monitoring:write',\r\n    'incident:read',\r\n    'incident:write',\r\n    'vendor:read',\r\n    'vendor:write',\r\n    'procurement:read',\r\n    'procurement:write',\r\n    'payroll:read',\r\n    'payroll:write',\r\n  ],\r\n  WORKER: ['updates:read', 'updates:write', 'incident:read', 'incident:write', 'procurement:read'],\r\n};\r\n\r\nexport function getRequestRole(request: NextRequest): FarmRole {\r\n  const headerRole = request.headers.get('x-farm-role');\r\n  if (headerRole === 'OWNER' || headerRole === 'MANAGER' || headerRole === 'WORKER') {\r\n    return headerRole;\r\n  }\r\n\r\n  return 'MANAGER';\r\n}\r\n\r\nexport function getRequestUserId(request: NextRequest): string {\r\n  return request.headers.get('x-user-id') || 'user_id_from_session';\r\n}\r\n\r\nexport function requirePermission(request: NextRequest, permission: FarmPermission) {\r\n  const role = getRequestRole(request);\r\n  if (!roleMatrix[role].includes(permission)) {\r\n    throw new AppError('FORBIDDEN', 'You do not have permission for this action', 403);\r\n  }\r\n}\r\n"],"names":["roleMatrix","OWNER","MANAGER","WORKER","getRequestRole","request","headerRole","headers","get","getRequestUserId","requirePermission","permission","role","includes"],"mappings":";;;;;;;;AACA;;AAwBA,MAAMA,aAAiD;IACrDC,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACDC,SAAS;QACP;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACDC,QAAQ;QAAC;QAAgB;QAAiB;QAAiB;QAAkB;KAAmB;AAClG;AAEO,SAASC,eAAeC,OAAoB;IACjD,MAAMC,aAAaD,QAAQE,OAAO,CAACC,GAAG,CAAC;IACvC,IAAIF,eAAe,WAAWA,eAAe,aAAaA,eAAe,UAAU;QACjF,OAAOA;IACT;IAEA,OAAO;AACT;AAEO,SAASG,iBAAiBJ,OAAoB;IACnD,OAAOA,QAAQE,OAAO,CAACC,GAAG,CAAC,gBAAgB;AAC7C;AAEO,SAASE,kBAAkBL,OAAoB,EAAEM,UAA0B;IAChF,MAAMC,OAAOR,eAAeC;IAC5B,IAAI,CAACL,UAAU,CAACY,KAAK,CAACC,QAAQ,CAACF,aAAa;QAC1C,MAAM,IAAI,kIAAQ,CAAC,aAAa,8CAA8C;IAChF;AACF"}},
    {"offset": {"line": 203, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma = globalForPrisma.prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":["globalForPrisma","globalThis","prisma"],"mappings":";;;;AAAA;;AAEA,MAAMA,kBAAkBC;AAEjB,MAAMC,SAASF,gBAAgBE,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2CF,gBAAgBE,MAAM,GAAGA"}},
    {"offset": {"line": 216, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/services/payroll/payroll-service.ts"],"sourcesContent":["import { prisma } from '@/lib/prisma';\r\nimport { AppError } from '@/lib/errors';\r\n\r\ntype PayrollEntryInput = {\r\n  userId: string;\r\n  grossAmount: number;\r\n  netAmount: number;\r\n};\r\n\r\nexport class PayrollService {\r\n  async listRuns(farmId: string) {\r\n    return prisma.payrollRun.findMany({\r\n      where: { farmId },\r\n      include: { entries: true },\r\n      orderBy: { startDate: 'desc' },\r\n      take: 20,\r\n    });\r\n  }\r\n\r\n  async createRun(input: {\r\n    farmId: string;\r\n    userId: string;\r\n    startDate: Date;\r\n    endDate: Date;\r\n    entries: PayrollEntryInput[];\r\n    idempotencyKey: string;\r\n  }) {\r\n    const existing = await prisma.event.findUnique({\r\n      where: {\r\n        farmId_idempotencyKey: {\r\n          farmId: input.farmId,\r\n          idempotencyKey: input.idempotencyKey,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (existing) {\r\n      return { reused: true, eventId: existing.id };\r\n    }\r\n\r\n    const run = await prisma.$transaction(async (tx: any) => {\r\n      const createdRun = await tx.payrollRun.create({\r\n        data: {\r\n          farmId: input.farmId,\r\n          startDate: input.startDate,\r\n          endDate: input.endDate,\r\n          status: 'DRAFT',\r\n          entries: {\r\n            create: input.entries.map((entry) => ({\r\n              userId: entry.userId,\r\n              grossAmount: entry.grossAmount,\r\n              netAmount: entry.netAmount,\r\n              status: 'DRAFT',\r\n            })),\r\n          },\r\n        },\r\n        include: { entries: true },\r\n      });\r\n\r\n      await tx.event.create({\r\n        data: {\r\n          farmId: input.farmId,\r\n          type: 'PAYROLL_RUN_CREATED',\r\n          payload: {\r\n            runId: createdRun.id,\r\n            entryCount: input.entries.length,\r\n          },\r\n          idempotencyKey: input.idempotencyKey,\r\n          userId: input.userId,\r\n        },\r\n      });\r\n\r\n      return createdRun;\r\n    }, { isolationLevel: 'Serializable' });\r\n\r\n    return run;\r\n  }\r\n\r\n  async approveRun(input: {\r\n    farmId: string;\r\n    runId: string;\r\n    userId: string;\r\n    idempotencyKey: string;\r\n    comment?: string;\r\n  }) {\r\n    const run = await prisma.payrollRun.findFirst({\r\n      where: { id: input.runId, farmId: input.farmId },\r\n    });\r\n\r\n    if (!run) {\r\n      throw new AppError('PAYROLL_RUN_NOT_FOUND', 'Payroll run not found', 404);\r\n    }\r\n\r\n    if (run.status === 'PAID') {\r\n      return { runId: run.id, status: 'ALREADY_PAID' };\r\n    }\r\n\r\n    const existing = await prisma.event.findUnique({\r\n      where: {\r\n        farmId_idempotencyKey: {\r\n          farmId: input.farmId,\r\n          idempotencyKey: input.idempotencyKey,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (existing) {\r\n      return { reused: true };\r\n    }\r\n\r\n    const approved = await prisma.$transaction(async (tx: any) => {\r\n      const updated = await tx.payrollRun.update({\r\n        where: { id: input.runId },\r\n        data: { status: 'PROCESSING' },\r\n      });\r\n\r\n      await tx.event.create({\r\n        data: {\r\n          farmId: input.farmId,\r\n          type: 'PAYROLL_RUN_APPROVED',\r\n          payload: {\r\n            runId: input.runId,\r\n            comment: input.comment,\r\n          },\r\n          idempotencyKey: input.idempotencyKey,\r\n          userId: input.userId,\r\n        },\r\n      });\r\n\r\n      return updated;\r\n    }, { isolationLevel: 'Serializable' });\r\n\r\n    return { runId: approved.id, status: approved.status };\r\n  }\r\n\r\n  async markPaid(input: {\r\n    farmId: string;\r\n    runId: string;\r\n    userId: string;\r\n    idempotencyKey: string;\r\n    reference: string;\r\n  }) {\r\n    const run = await prisma.payrollRun.findFirst({\r\n      where: { id: input.runId, farmId: input.farmId },\r\n      include: { entries: true },\r\n    });\r\n\r\n    if (!run) {\r\n      throw new AppError('PAYROLL_RUN_NOT_FOUND', 'Payroll run not found', 404);\r\n    }\r\n\r\n    if (run.status === 'PAID') {\r\n      return { runId: run.id, status: 'ALREADY_PAID' };\r\n    }\r\n\r\n    const existing = await prisma.event.findUnique({\r\n      where: {\r\n        farmId_idempotencyKey: {\r\n          farmId: input.farmId,\r\n          idempotencyKey: input.idempotencyKey,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (existing) {\r\n      return { reused: true };\r\n    }\r\n\r\n    const paid = await prisma.$transaction(async (tx: any) => {\r\n      await tx.payrollEntry.updateMany({\r\n        where: { payrollRunId: input.runId },\r\n        data: { status: 'PAID' },\r\n      });\r\n\r\n      const updated = await tx.payrollRun.update({\r\n        where: { id: input.runId },\r\n        data: { status: 'PAID' },\r\n      });\r\n\r\n      await tx.event.create({\r\n        data: {\r\n          farmId: input.farmId,\r\n          type: 'PAYROLL_PAID',\r\n          payload: {\r\n            runId: input.runId,\r\n            reference: input.reference,\r\n          },\r\n          idempotencyKey: input.idempotencyKey,\r\n          userId: input.userId,\r\n        },\r\n      });\r\n\r\n      return updated;\r\n    }, { isolationLevel: 'Serializable' });\r\n\r\n    return { runId: paid.id, status: paid.status };\r\n  }\r\n}\r\n\r\nexport const payrollService = new PayrollService();\r\n"],"names":["PayrollService","listRuns","farmId","payrollRun","findMany","where","include","entries","orderBy","startDate","take","createRun","input","existing","event","findUnique","farmId_idempotencyKey","idempotencyKey","reused","eventId","id","run","$transaction","tx","createdRun","create","data","endDate","status","map","entry","userId","grossAmount","netAmount","type","payload","runId","entryCount","length","isolationLevel","approveRun","findFirst","approved","updated","update","comment","markPaid","paid","payrollEntry","updateMany","payrollRunId","reference","payrollService"],"mappings":"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"}},
    {"offset": {"line": 429, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/app/api/farms/%5BfarmId%5D/payroll/runs/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\r\nimport { z } from 'zod';\r\nimport { createErrorResponse } from '@/lib/errors';\r\nimport { getRequestUserId, requirePermission } from '@/lib/permissions';\r\nimport { payrollService } from '@/services/payroll/payroll-service';\r\n\r\nconst createRunSchema = z.object({\r\n  startDate: z.string().datetime(),\r\n  endDate: z.string().datetime(),\r\n  idempotencyKey: z.string().min(8),\r\n  entries: z.array(z.object({\r\n    userId: z.string().min(1),\r\n    grossAmount: z.number().positive(),\r\n    netAmount: z.number().positive(),\r\n  })).min(1).max(500),\r\n});\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  context: { params: Promise<{ farmId: string }> }\r\n) {\r\n  try {\r\n    requirePermission(request, 'payroll:read');\r\n    const { farmId } = await context.params;\r\n    const data = await payrollService.listRuns(farmId);\r\n    return Response.json({ success: true, data });\r\n  } catch (error) {\r\n    return createErrorResponse(error);\r\n  }\r\n}\r\n\r\nexport async function POST(\r\n  request: NextRequest,\r\n  context: { params: Promise<{ farmId: string }> }\r\n) {\r\n  try {\r\n    requirePermission(request, 'payroll:write');\r\n    const { farmId } = await context.params;\r\n    const body = await request.json();\r\n    const input = createRunSchema.parse(body);\r\n    const userId = getRequestUserId(request);\r\n\r\n    const data = await payrollService.createRun({\r\n      farmId,\r\n      userId,\r\n      startDate: new Date(input.startDate),\r\n      endDate: new Date(input.endDate),\r\n      entries: input.entries,\r\n      idempotencyKey: input.idempotencyKey,\r\n    });\r\n\r\n    return Response.json({ success: true, data });\r\n  } catch (error) {\r\n    return createErrorResponse(error);\r\n  }\r\n}\r\n"],"names":["createRunSchema","object","startDate","string","datetime","endDate","idempotencyKey","min","entries","array","userId","grossAmount","number","positive","netAmount","max","GET","request","context","farmId","params","data","listRuns","Response","json","success","error","POST","body","input","parse","createRun","Date"],"mappings":";;;;;;AACA;AACA;AACA;AACA;;;;;AAEA,MAAMA,kBAAkB,yKAAC,CAACC,MAAM,CAAC;IAC/BC,WAAW,yKAAC,CAACC,MAAM,GAAGC,QAAQ;IAC9BC,SAAS,yKAAC,CAACF,MAAM,GAAGC,QAAQ;IAC5BE,gBAAgB,yKAAC,CAACH,MAAM,GAAGI,GAAG,CAAC;IAC/BC,SAAS,yKAAC,CAACC,KAAK,CAAC,yKAAC,CAACR,MAAM,CAAC;QACxBS,QAAQ,yKAAC,CAACP,MAAM,GAAGI,GAAG,CAAC;QACvBI,aAAa,yKAAC,CAACC,MAAM,GAAGC,QAAQ;QAChCC,WAAW,yKAAC,CAACF,MAAM,GAAGC,QAAQ;IAChC,IAAIN,GAAG,CAAC,GAAGQ,GAAG,CAAC;AACjB;AAEO,eAAeC,IACpBC,OAAoB,EACpBC,OAAgD;IAEhD,IAAI;QACF,IAAA,gJAAiB,EAACD,SAAS;QAC3B,MAAM,EAAEE,MAAM,EAAE,GAAG,MAAMD,QAAQE,MAAM;QACvC,MAAMC,OAAO,MAAM,oKAAc,CAACC,QAAQ,CAACH;QAC3C,OAAOI,SAASC,IAAI,CAAC;YAAEC,SAAS;YAAMJ;QAAK;IAC7C,EAAE,OAAOK,OAAO;QACd,OAAO,IAAA,6IAAmB,EAACA;IAC7B;AACF;AAEO,eAAeC,KACpBV,OAAoB,EACpBC,OAAgD;IAEhD,IAAI;QACF,IAAA,gJAAiB,EAACD,SAAS;QAC3B,MAAM,EAAEE,MAAM,EAAE,GAAG,MAAMD,QAAQE,MAAM;QACvC,MAAMQ,OAAO,MAAMX,QAAQO,IAAI;QAC/B,MAAMK,QAAQ7B,gBAAgB8B,KAAK,CAACF;QACpC,MAAMlB,SAAS,IAAA,+IAAgB,EAACO;QAEhC,MAAMI,OAAO,MAAM,oKAAc,CAACU,SAAS,CAAC;YAC1CZ;YACAT;YACAR,WAAW,IAAI8B,KAAKH,MAAM3B,SAAS;YACnCG,SAAS,IAAI2B,KAAKH,MAAMxB,OAAO;YAC/BG,SAASqB,MAAMrB,OAAO;YACtBF,gBAAgBuB,MAAMvB,cAAc;QACtC;QAEA,OAAOiB,SAASC,IAAI,CAAC;YAAEC,SAAS;YAAMJ;QAAK;IAC7C,EAAE,OAAOK,OAAO;QACd,OAAO,IAAA,6IAAmB,EAACA;IAC7B;AACF"}}]
}