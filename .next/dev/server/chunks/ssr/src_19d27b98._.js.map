{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/components/features/incidents/incidents-module.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useAuth } from '@/components/layout/auth-provider';\r\nimport { formatDate } from '@/lib/utils';\r\nimport { useMutation, useQuery } from '@tanstack/react-query';\r\nimport { useState } from 'react';\r\n\r\ntype ApiEnvelope<T> = {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: { code: string; message: string };\r\n};\r\n\r\nasync function apiCall<T>(path: string, options?: RequestInit): Promise<T> {\r\n  const response = await fetch(path, {\r\n    ...options,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      ...(options?.headers || {}),\r\n    },\r\n  });\r\n  const json = (await response.json()) as ApiEnvelope<T>;\r\n  if (!json.success) {\r\n    throw new Error(json.error?.message || 'Request failed');\r\n  }\r\n  return json.data as T;\r\n}\r\n\r\nexport function IncidentsModule() {\r\n  const { farmId } = useAuth();\r\n  const [title, setTitle] = useState('');\r\n  const [details, setDetails] = useState('');\r\n  const [severity, setSeverity] = useState<'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL'>('MEDIUM');\r\n  const [issueEventId, setIssueEventId] = useState('');\r\n  const [resolution, setResolution] = useState('');\r\n\r\n  const timelineQuery = useQuery({\r\n    queryKey: ['incident-timeline', farmId],\r\n    queryFn: () => apiCall<any[]>(`/api/farms/${farmId}/incidents`),\r\n    enabled: Boolean(farmId),\r\n  });\r\n\r\n  const reportMutation = useMutation({\r\n    mutationFn: () => apiCall(`/api/farms/${farmId}/incidents`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({\r\n        title,\r\n        details: details || undefined,\r\n        severity,\r\n        idempotencyKey: crypto.randomUUID(),\r\n      }),\r\n    }),\r\n    onSuccess: () => {\r\n      setTitle('');\r\n      setDetails('');\r\n      void timelineQuery.refetch();\r\n    },\r\n  });\r\n\r\n  const expertMutation = useMutation({\r\n    mutationFn: () => apiCall(`/api/farms/${farmId}/incidents/expert-request`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({\r\n        issueEventId,\r\n        idempotencyKey: crypto.randomUUID(),\r\n      }),\r\n    }),\r\n    onSuccess: () => {\r\n      void timelineQuery.refetch();\r\n    },\r\n  });\r\n\r\n  const resolveMutation = useMutation({\r\n    mutationFn: () => apiCall(`/api/farms/${farmId}/incidents/resolve`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({\r\n        issueEventId,\r\n        resolution,\r\n        idempotencyKey: crypto.randomUUID(),\r\n      }),\r\n    }),\r\n    onSuccess: () => {\r\n      setResolution('');\r\n      void timelineQuery.refetch();\r\n    },\r\n  });\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-6 max-w-6xl mx-auto w-full space-y-6 pb-24 md:pb-8\">\r\n      <header>\r\n        <h1 className=\"text-2xl font-bold tracking-tight\">Incidents</h1>\r\n        <p className=\"text-xs text-muted-foreground uppercase font-semibold\">Escalation, expert support, resolution tracking</p>\r\n      </header>\r\n\r\n      <section className=\"p-4 border rounded-xl bg-card space-y-2\">\r\n        <h2 className=\"text-sm font-bold uppercase\">Report Issue</h2>\r\n        <input\r\n          value={title}\r\n          onChange={(event) => setTitle(event.target.value)}\r\n          placeholder=\"Issue title\"\r\n          className=\"w-full h-10 rounded-md bg-accent/40 px-3 text-sm\"\r\n        />\r\n        <select\r\n          value={severity}\r\n          onChange={(event) => setSeverity(event.target.value as 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL')}\r\n          className=\"w-full h-10 rounded-md bg-accent/40 px-3 text-sm\"\r\n        >\r\n          <option value=\"LOW\">LOW</option>\r\n          <option value=\"MEDIUM\">MEDIUM</option>\r\n          <option value=\"HIGH\">HIGH</option>\r\n          <option value=\"CRITICAL\">CRITICAL</option>\r\n        </select>\r\n        <textarea\r\n          value={details}\r\n          onChange={(event) => setDetails(event.target.value)}\r\n          placeholder=\"Details\"\r\n          className=\"w-full min-h-[80px] rounded-md bg-accent/40 px-3 py-2 text-sm\"\r\n        />\r\n        <button\r\n          onClick={() => reportMutation.mutate()}\r\n          disabled={reportMutation.isPending || title.trim().length < 3}\r\n          className=\"w-full h-10 rounded-md bg-primary text-primary-foreground text-sm font-semibold disabled:opacity-50\"\r\n        >\r\n          {reportMutation.isPending ? 'Reporting...' : 'Report Incident'}\r\n        </button>\r\n      </section>\r\n\r\n      <section className=\"p-4 border rounded-xl bg-card space-y-2\">\r\n        <h2 className=\"text-sm font-bold uppercase\">Issue Action</h2>\r\n        <input\r\n          value={issueEventId}\r\n          onChange={(event) => setIssueEventId(event.target.value)}\r\n          placeholder=\"Issue Event ID\"\r\n          className=\"w-full h-10 rounded-md bg-accent/40 px-3 text-sm\"\r\n        />\r\n        <input\r\n          value={resolution}\r\n          onChange={(event) => setResolution(event.target.value)}\r\n          placeholder=\"Resolution note\"\r\n          className=\"w-full h-10 rounded-md bg-accent/40 px-3 text-sm\"\r\n        />\r\n        <div className=\"grid grid-cols-2 gap-2\">\r\n          <button\r\n            onClick={() => expertMutation.mutate()}\r\n            disabled={expertMutation.isPending || !issueEventId}\r\n            className=\"h-10 rounded-md bg-secondary text-secondary-foreground text-sm font-semibold disabled:opacity-50\"\r\n          >\r\n            Request Expert\r\n          </button>\r\n          <button\r\n            onClick={() => resolveMutation.mutate()}\r\n            disabled={resolveMutation.isPending || !issueEventId || resolution.trim().length < 3}\r\n            className=\"h-10 rounded-md bg-primary text-primary-foreground text-sm font-semibold disabled:opacity-50\"\r\n          >\r\n            Resolve\r\n          </button>\r\n        </div>\r\n      </section>\r\n\r\n      <section className=\"p-4 border rounded-xl bg-card\">\r\n        <h2 className=\"text-sm font-bold uppercase mb-2\">Issue Timeline</h2>\r\n        <div className=\"space-y-2\">\r\n          {timelineQuery.data?.length ? timelineQuery.data.map((event: any) => (\r\n            <div key={event.id} className=\"p-3 rounded-md bg-accent/20\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <p className=\"text-xs font-semibold\">{event.type}</p>\r\n                <p className=\"text-[10px] text-muted-foreground\">{formatDate(event.createdAt)}</p>\r\n              </div>\r\n              <p className=\"text-[11px] mt-1 text-muted-foreground\">{JSON.stringify(event.payload)}</p>\r\n            </div>\r\n          )) : <p className=\"text-xs text-muted-foreground\">No incident events yet.</p>}\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["apiCall","path","options","response","fetch","headers","json","success","Error","error","message","data","IncidentsModule","farmId","title","setTitle","details","setDetails","severity","setSeverity","issueEventId","setIssueEventId","resolution","setResolution","timelineQuery","queryKey","queryFn","enabled","Boolean","reportMutation","mutationFn","method","body","JSON","stringify","undefined","idempotencyKey","crypto","randomUUID","onSuccess","refetch","expertMutation","resolveMutation","className","value","onChange","event","target","placeholder","onClick","mutate","disabled","isPending","trim","length","map","type","createdAt","payload","id"],"mappings":"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"}},
    {"offset": {"line": 358, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/app/%28dashboard%29/incidents/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { IncidentsModule } from '@/components/features/incidents/incidents-module';\r\n\r\nexport default function IncidentsPage() {\r\n  return <IncidentsModule />;\r\n}\r\n"],"names":["IncidentsPage"],"mappings":";;;;;AAEA;AAFA;;;AAIe,SAASA;IACtB,qBAAO,8OAAC,qLAAe;;;;;AACzB"}}]
}