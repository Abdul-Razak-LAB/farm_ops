{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/media-upload-client.ts"],"sourcesContent":["type SignedUpload = {\r\n  uploadId: string;\r\n  uploadUrl: string;\r\n  fileUrl: string;\r\n  method: 'PUT';\r\n};\r\n\r\ntype ApiEnvelope<T> = {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: { code: string; message: string };\r\n};\r\n\r\nasync function requestSignedUpload(endpoint: string, file: File) {\r\n  const response = await fetch(endpoint, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({\r\n      fileName: file.name,\r\n      contentType: file.type || 'application/octet-stream',\r\n    }),\r\n  });\r\n\r\n  const json = (await response.json()) as ApiEnvelope<SignedUpload>;\r\n  if (!json.success || !json.data) {\r\n    throw new Error(json.error?.message || 'Unable to get signed upload URL');\r\n  }\r\n\r\n  return json.data;\r\n}\r\n\r\nasync function putWithProgress(uploadUrl: string, file: File, onProgress?: (progress: number) => void) {\r\n  await new Promise<void>((resolve, reject) => {\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open('PUT', uploadUrl, true);\r\n    if (file.type) {\r\n      xhr.setRequestHeader('Content-Type', file.type);\r\n    }\r\n\r\n    xhr.upload.onprogress = (event) => {\r\n      if (!event.lengthComputable || !onProgress) return;\r\n      onProgress(Math.round((event.loaded / event.total) * 100));\r\n    };\r\n\r\n    xhr.onload = () => {\r\n      if (xhr.status >= 200 && xhr.status < 300) {\r\n        onProgress?.(100);\r\n        resolve();\r\n      } else {\r\n        reject(new Error(`Upload failed with status ${xhr.status}`));\r\n      }\r\n    };\r\n\r\n    xhr.onerror = () => reject(new Error('Upload failed due to network error'));\r\n    xhr.send(file);\r\n  });\r\n}\r\n\r\nexport async function uploadFileWithSignedEndpoint(\r\n  signedUploadEndpoint: string,\r\n  file: File,\r\n  onProgress?: (progress: number) => void\r\n) {\r\n  const signed = await requestSignedUpload(signedUploadEndpoint, file);\r\n  await putWithProgress(signed.uploadUrl, file, onProgress);\r\n  return signed.fileUrl;\r\n}\r\n"],"names":["requestSignedUpload","endpoint","file","response","fetch","method","headers","body","JSON","stringify","fileName","name","contentType","type","json","success","data","Error","error","message","putWithProgress","uploadUrl","onProgress","Promise","resolve","reject","xhr","XMLHttpRequest","open","setRequestHeader","upload","onprogress","event","lengthComputable","Math","round","loaded","total","onload","status","onerror","send","uploadFileWithSignedEndpoint","signedUploadEndpoint","signed","fileUrl"],"mappings":";;;;AAaA,eAAeA,oBAAoBC,QAAgB,EAAEC,IAAU;IAC7D,MAAMC,WAAW,MAAMC,MAAMH,UAAU;QACrCI,QAAQ;QACRC,SAAS;YAAE,gBAAgB;QAAmB;QAC9CC,MAAMC,KAAKC,SAAS,CAAC;YACnBC,UAAUR,KAAKS,IAAI;YACnBC,aAAaV,KAAKW,IAAI,IAAI;QAC5B;IACF;IAEA,MAAMC,OAAQ,MAAMX,SAASW,IAAI;IACjC,IAAI,CAACA,KAAKC,OAAO,IAAI,CAACD,KAAKE,IAAI,EAAE;QAC/B,MAAM,IAAIC,MAAMH,KAAKI,KAAK,EAAEC,WAAW;IACzC;IAEA,OAAOL,KAAKE,IAAI;AAClB;AAEA,eAAeI,gBAAgBC,SAAiB,EAAEnB,IAAU,EAAEoB,UAAuC;IACnG,MAAM,IAAIC,QAAc,CAACC,SAASC;QAChC,MAAMC,MAAM,IAAIC;QAChBD,IAAIE,IAAI,CAAC,OAAOP,WAAW;QAC3B,IAAInB,KAAKW,IAAI,EAAE;YACba,IAAIG,gBAAgB,CAAC,gBAAgB3B,KAAKW,IAAI;QAChD;QAEAa,IAAII,MAAM,CAACC,UAAU,GAAG,CAACC;YACvB,IAAI,CAACA,MAAMC,gBAAgB,IAAI,CAACX,YAAY;YAC5CA,WAAWY,KAAKC,KAAK,CAAC,AAACH,MAAMI,MAAM,GAAGJ,MAAMK,KAAK,GAAI;QACvD;QAEAX,IAAIY,MAAM,GAAG;YACX,IAAIZ,IAAIa,MAAM,IAAI,OAAOb,IAAIa,MAAM,GAAG,KAAK;gBACzCjB,aAAa;gBACbE;YACF,OAAO;gBACLC,OAAO,IAAIR,MAAM,CAAC,0BAA0B,EAAES,IAAIa,MAAM,EAAE;YAC5D;QACF;QAEAb,IAAIc,OAAO,GAAG,IAAMf,OAAO,IAAIR,MAAM;QACrCS,IAAIe,IAAI,CAACvC;IACX;AACF;AAEO,eAAewC,6BACpBC,oBAA4B,EAC5BzC,IAAU,EACVoB,UAAuC;IAEvC,MAAMsB,SAAS,MAAM5C,oBAAoB2C,sBAAsBzC;IAC/D,MAAMkB,gBAAgBwB,OAAOvB,SAAS,EAAEnB,MAAMoB;IAC9C,OAAOsB,OAAOC,OAAO;AACvB"}},
    {"offset": {"line": 57, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/app/%28dashboard%29/vendor/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useAuth } from '@/components/layout/auth-provider';\r\nimport { useMutation, useQuery } from '@tanstack/react-query';\r\nimport { useState } from 'react';\r\nimport { uploadFileWithSignedEndpoint } from '@/lib/media-upload-client';\r\n\r\ntype ApiEnvelope<T> = {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: { code: string; message: string };\r\n};\r\n\r\nasync function apiCall<T>(path: string, options?: RequestInit): Promise<T> {\r\n  const response = await fetch(path, {\r\n    ...options,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      ...(options?.headers || {}),\r\n    },\r\n  });\r\n\r\n  const json = (await response.json()) as ApiEnvelope<T>;\r\n  if (!json.success) {\r\n    throw new Error(json.error?.message || 'Request failed');\r\n  }\r\n\r\n  return json.data as T;\r\n}\r\n\r\nexport default function VendorPage() {\r\n  const { farmId } = useAuth();\r\n  const [poId, setPoId] = useState('');\r\n  const [invoiceNumber, setInvoiceNumber] = useState('');\r\n  const [evidenceUrl, setEvidenceUrl] = useState('');\r\n  const [uploadProgress, setUploadProgress] = useState(0);\r\n  const [isUploadingEvidence, setIsUploadingEvidence] = useState(false);\r\n\r\n  const ordersQuery = useQuery({\r\n    queryKey: ['vendor-orders', farmId],\r\n    queryFn: () => apiCall<any[]>(`/api/farms/${farmId}/vendor/orders`),\r\n    enabled: Boolean(farmId),\r\n  });\r\n\r\n  const confirmMutation = useMutation({\r\n    mutationFn: () => apiCall(`/api/farms/${farmId}/vendor/orders`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({\r\n        poId,\r\n        invoiceNumber,\r\n        evidenceUrl: evidenceUrl || undefined,\r\n        idempotencyKey: crypto.randomUUID(),\r\n      }),\r\n    }),\r\n    onSuccess: () => {\r\n      setInvoiceNumber('');\r\n      setEvidenceUrl('');\r\n      void ordersQuery.refetch();\r\n    },\r\n  });\r\n\r\n  const handleEvidenceUpload = async (file: File) => {\r\n    if (!farmId) return;\r\n    setIsUploadingEvidence(true);\r\n    setUploadProgress(0);\r\n    try {\r\n      const fileUrl = await uploadFileWithSignedEndpoint(`/api/farms/${farmId}/media/signed-upload`, file, setUploadProgress);\r\n      setEvidenceUrl(fileUrl);\r\n    } finally {\r\n      setIsUploadingEvidence(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-6 max-w-6xl mx-auto w-full space-y-6 pb-24 md:pb-8\">\r\n      <header>\r\n        <h1 className=\"text-2xl font-bold tracking-tight\">Vendor Portal</h1>\r\n        <p className=\"text-xs text-muted-foreground uppercase font-semibold\">PO confirmation and invoice evidence</p>\r\n      </header>\r\n\r\n      <section className=\"p-4 border rounded-xl bg-card space-y-2\">\r\n        <h2 className=\"text-sm font-bold uppercase\">Confirm Purchase Order</h2>\r\n        <input\r\n          value={poId}\r\n          onChange={(event) => setPoId(event.target.value)}\r\n          placeholder=\"PO ID\"\r\n          className=\"w-full h-10 rounded-md bg-accent/40 px-3 text-sm\"\r\n        />\r\n        <input\r\n          value={invoiceNumber}\r\n          onChange={(event) => setInvoiceNumber(event.target.value)}\r\n          placeholder=\"Invoice Number\"\r\n          className=\"w-full h-10 rounded-md bg-accent/40 px-3 text-sm\"\r\n        />\r\n        <input\r\n          type=\"file\"\r\n          accept=\"image/*,application/pdf\"\r\n          onChange={(event) => {\r\n            const file = event.target.files?.[0];\r\n            if (file) void handleEvidenceUpload(file);\r\n          }}\r\n          className=\"w-full h-10 rounded-md bg-accent/40 px-3 text-sm\"\r\n        />\r\n        <p className=\"text-[11px] text-muted-foreground\">{isUploadingEvidence ? `Uploading evidence ${uploadProgress}%` : evidenceUrl ? 'Evidence uploaded' : 'Evidence optional'}</p>\r\n        <button\r\n          onClick={() => confirmMutation.mutate()}\r\n          disabled={confirmMutation.isPending || isUploadingEvidence || !poId || !invoiceNumber}\r\n          className=\"w-full h-10 rounded-md bg-primary text-primary-foreground text-sm font-semibold disabled:opacity-50\"\r\n        >\r\n          {confirmMutation.isPending ? 'Submitting...' : 'Confirm Order'}\r\n        </button>\r\n      </section>\r\n\r\n      <section className=\"p-4 border rounded-xl bg-card\">\r\n        <h2 className=\"text-sm font-bold uppercase mb-3\">Open Orders</h2>\r\n        <div className=\"space-y-2\">\r\n          {ordersQuery.data?.length ? ordersQuery.data.map((order: any) => (\r\n            <button\r\n              key={order.id}\r\n              onClick={() => setPoId(order.id)}\r\n              className=\"w-full text-left p-3 rounded-md bg-accent/20\"\r\n            >\r\n              <div className=\"flex justify-between text-xs\">\r\n                <span className=\"font-semibold\">{order.id.slice(0, 10)}</span>\r\n                <span className=\"uppercase text-muted-foreground\">{order.status}</span>\r\n              </div>\r\n              <p className=\"text-[11px] mt-1 text-muted-foreground\">Vendor: {order.vendor?.name ?? 'Unknown'}</p>\r\n            </button>\r\n          )) : <p className=\"text-xs text-muted-foreground\">No open vendor orders.</p>}\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["apiCall","path","options","response","fetch","headers","json","success","Error","error","message","data","VendorPage","farmId","poId","setPoId","invoiceNumber","setInvoiceNumber","evidenceUrl","setEvidenceUrl","uploadProgress","setUploadProgress","isUploadingEvidence","setIsUploadingEvidence","ordersQuery","queryKey","queryFn","enabled","Boolean","confirmMutation","mutationFn","method","body","JSON","stringify","undefined","idempotencyKey","crypto","randomUUID","onSuccess","refetch","handleEvidenceUpload","file","fileUrl","className","value","onChange","event","target","placeholder","type","accept","files","onClick","mutate","disabled","isPending","length","map","order","id","slice","status","vendor","name"],"mappings":"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"}}]
}