{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/logger.ts"],"sourcesContent":["type LogLevel = 'debug' | 'info' | 'warn' | 'error';\r\n\r\ntype LogContext = Record<string, unknown>;\r\n\r\nconst REDACT_KEYS = ['password', 'token', 'authorization', 'cookie', 'email', 'phone', 'secret'];\r\n\r\nfunction redactValue(value: unknown): unknown {\r\n  if (Array.isArray(value)) {\r\n    return value.map(redactValue);\r\n  }\r\n\r\n  if (value && typeof value === 'object') {\r\n    const entries = Object.entries(value as Record<string, unknown>).map(([key, val]) => {\r\n      const shouldRedact = REDACT_KEYS.some((redactKey) => key.toLowerCase().includes(redactKey));\r\n      return [key, shouldRedact ? '[REDACTED]' : redactValue(val)];\r\n    });\r\n    return Object.fromEntries(entries);\r\n  }\r\n\r\n  return value;\r\n}\r\n\r\nfunction emit(level: LogLevel, message: string, context?: LogContext) {\r\n  const payload = {\r\n    level,\r\n    message,\r\n    timestamp: new Date().toISOString(),\r\n    context: redactValue(context || {}),\r\n  };\r\n\r\n  const line = JSON.stringify(payload);\r\n  if (level === 'error') {\r\n    console.error(line);\r\n    return;\r\n  }\r\n\r\n  if (level === 'warn') {\r\n    console.warn(line);\r\n    return;\r\n  }\r\n\r\n  console.log(line);\r\n}\r\n\r\nexport const logger = {\r\n  debug: (message: string, context?: LogContext) => emit('debug', message, context),\r\n  info: (message: string, context?: LogContext) => emit('info', message, context),\r\n  warn: (message: string, context?: LogContext) => emit('warn', message, context),\r\n  error: (message: string, context?: LogContext) => emit('error', message, context),\r\n};\r\n"],"names":["REDACT_KEYS","redactValue","value","Array","isArray","map","entries","Object","key","val","shouldRedact","some","redactKey","toLowerCase","includes","fromEntries","emit","level","message","context","payload","timestamp","Date","toISOString","line","JSON","stringify","console","error","warn","log","logger","debug","info"],"mappings":";;;;AAIA,MAAMA,cAAc;IAAC;IAAY;IAAS;IAAiB;IAAU;IAAS;IAAS;CAAS;AAEhG,SAASC,YAAYC,KAAc;IACjC,IAAIC,MAAMC,OAAO,CAACF,QAAQ;QACxB,OAAOA,MAAMG,GAAG,CAACJ;IACnB;IAEA,IAAIC,SAAS,OAAOA,UAAU,UAAU;QACtC,MAAMI,UAAUC,OAAOD,OAAO,CAACJ,OAAkCG,GAAG,CAAC,CAAC,CAACG,KAAKC,IAAI;YAC9E,MAAMC,eAAeV,YAAYW,IAAI,CAAC,CAACC,YAAcJ,IAAIK,WAAW,GAAGC,QAAQ,CAACF;YAChF,OAAO;gBAACJ;gBAAKE,eAAe,eAAeT,YAAYQ;aAAK;QAC9D;QACA,OAAOF,OAAOQ,WAAW,CAACT;IAC5B;IAEA,OAAOJ;AACT;AAEA,SAASc,KAAKC,KAAe,EAAEC,OAAe,EAAEC,OAAoB;IAClE,MAAMC,UAAU;QACdH;QACAC;QACAG,WAAW,IAAIC,OAAOC,WAAW;QACjCJ,SAASlB,YAAYkB,WAAW,CAAC;IACnC;IAEA,MAAMK,OAAOC,KAAKC,SAAS,CAACN;IAC5B,IAAIH,UAAU,SAAS;QACrBU,QAAQC,KAAK,CAACJ;QACd;IACF;IAEA,IAAIP,UAAU,QAAQ;QACpBU,QAAQE,IAAI,CAACL;QACb;IACF;IAEAG,QAAQG,GAAG,CAACN;AACd;AAEO,MAAMO,SAAS;IACpBC,OAAO,CAACd,SAAiBC,UAAyBH,KAAK,SAASE,SAASC;IACzEc,MAAM,CAACf,SAAiBC,UAAyBH,KAAK,QAAQE,SAASC;IACvEU,MAAM,CAACX,SAAiBC,UAAyBH,KAAK,QAAQE,SAASC;IACvES,OAAO,CAACV,SAAiBC,UAAyBH,KAAK,SAASE,SAASC;AAC3E"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/server-observability.ts"],"sourcesContent":["import { logger } from '@/lib/logger';\r\n\r\ntype CaptureContext = {\r\n  tags?: Record<string, string>;\r\n  extra?: Record<string, unknown>;\r\n};\r\n\r\nlet sentryInitPromise: Promise<typeof import('@sentry/node') | null> | null = null;\r\n\r\nasync function getSentry() {\r\n  if (!process.env.SENTRY_DSN) {\r\n    return null;\r\n  }\r\n\r\n  if (!sentryInitPromise) {\r\n    sentryInitPromise = import('@sentry/node')\r\n      .then((sentry) => {\r\n        sentry.init({\r\n          dsn: process.env.SENTRY_DSN,\r\n          environment: process.env.NODE_ENV,\r\n        });\r\n        return sentry;\r\n      })\r\n      .catch(() => null);\r\n  }\r\n\r\n  return sentryInitPromise;\r\n}\r\n\r\nexport async function captureServerException(error: unknown, context?: CaptureContext) {\r\n  logger.error('Unhandled server exception', {\r\n    error: error instanceof Error ? { message: error.message, stack: error.stack } : error,\r\n    ...context,\r\n  });\r\n\r\n  const sentry = await getSentry();\r\n  if (sentry) {\r\n    sentry.withScope((scope) => {\r\n      Object.entries(context?.tags || {}).forEach(([key, value]) => scope.setTag(key, value));\r\n      Object.entries(context?.extra || {}).forEach(([key, value]) => scope.setExtra(key, value));\r\n      sentry.captureException(error);\r\n    });\r\n    return;\r\n  }\r\n\r\n  try {\r\n    await fetch(process.env.SENTRY_DSN as string, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        message: error instanceof Error ? error.message : 'Unknown error',\r\n        stack: error instanceof Error ? error.stack : undefined,\r\n        tags: context?.tags,\r\n        extra: context?.extra,\r\n        timestamp: new Date().toISOString(),\r\n      }),\r\n    });\r\n  } catch (captureError) {\r\n    logger.warn('Failed to send server exception to Sentry-compatible endpoint', {\r\n      captureError,\r\n    });\r\n  }\r\n}\r\n"],"names":["sentryInitPromise","getSentry","process","env","SENTRY_DSN","then","sentry","init","dsn","environment","catch","captureServerException","error","context","Error","message","stack","withScope","scope","Object","entries","tags","forEach","key","value","setTag","extra","setExtra","captureException","fetch","method","headers","body","JSON","stringify","undefined","timestamp","Date","toISOString","captureError","warn"],"mappings":";;;;AAAA;;AAOA,IAAIA,oBAA0E;AAE9E,eAAeC;IACb,IAAI,CAACC,QAAQC,GAAG,CAACC,UAAU,EAAE;QAC3B,OAAO;IACT;IAEA,IAAI,CAACJ,mBAAmB;QACtBA,oBAAoB,yHACjBK,IAAI,CAAC,CAACC;YACLA,OAAOC,IAAI,CAAC;gBACVC,KAAKN,QAAQC,GAAG,CAACC,UAAU;gBAC3BK,WAAW;YACb;YACA,OAAOH;QACT,GACCI,KAAK,CAAC,IAAM;IACjB;IAEA,OAAOV;AACT;AAEO,eAAeW,uBAAuBC,KAAc,EAAEC,OAAwB;IACnF,gIAAM,CAACD,KAAK,CAAC,8BAA8B;QACzCA,OAAOA,iBAAiBE,QAAQ;YAAEC,SAASH,MAAMG,OAAO;YAAEC,OAAOJ,MAAMI,KAAK;QAAC,IAAIJ;QACjF,GAAGC,OAAO;IACZ;IAEA,MAAMP,SAAS,MAAML;IACrB,IAAIK,QAAQ;QACVA,OAAOW,SAAS,CAAC,CAACC;YAChBC,OAAOC,OAAO,CAACP,SAASQ,QAAQ,CAAC,GAAGC,OAAO,CAAC,CAAC,CAACC,KAAKC,MAAM,GAAKN,MAAMO,MAAM,CAACF,KAAKC;YAChFL,OAAOC,OAAO,CAACP,SAASa,SAAS,CAAC,GAAGJ,OAAO,CAAC,CAAC,CAACC,KAAKC,MAAM,GAAKN,MAAMS,QAAQ,CAACJ,KAAKC;YACnFlB,OAAOsB,gBAAgB,CAAChB;QAC1B;QACA;IACF;IAEA,IAAI;QACF,MAAMiB,MAAM3B,QAAQC,GAAG,CAACC,UAAU,EAAY;YAC5C0B,QAAQ;YACRC,SAAS;gBAAE,gBAAgB;YAAmB;YAC9CC,MAAMC,KAAKC,SAAS,CAAC;gBACnBnB,SAASH,iBAAiBE,QAAQF,MAAMG,OAAO,GAAG;gBAClDC,OAAOJ,iBAAiBE,QAAQF,MAAMI,KAAK,GAAGmB;gBAC9Cd,MAAMR,SAASQ;gBACfK,OAAOb,SAASa;gBAChBU,WAAW,IAAIC,OAAOC,WAAW;YACnC;QACF;IACF,EAAE,OAAOC,cAAc;QACrB,gIAAM,CAACC,IAAI,CAAC,iEAAiE;YAC3ED;QACF;IACF;AACF"}},
    {"offset": {"line": 154, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/errors.ts"],"sourcesContent":["import { logger } from '@/lib/logger';\r\nimport { captureServerException } from '@/lib/server-observability';\r\n\r\nexport class AppError extends Error {\r\n  public code: string;\r\n  public status: number;\r\n  public details?: any;\r\n\r\n  constructor(code: string, message: string, status: number = 400, details?: any) {\r\n    super(message);\r\n    this.name = 'AppError';\r\n    this.code = code;\r\n    this.status = status;\r\n    this.details = details;\r\n  }\r\n}\r\n\r\nexport function createErrorResponse(error: any) {\r\n  if (error instanceof AppError || (error?.name === 'AppError' && error?.code && error?.message)) {\r\n    return Response.json(\r\n      { success: false, error: { code: error.code, message: error.message, details: error.details } },\r\n      { status: error.status || 400 }\r\n    );\r\n  }\r\n\r\n  if (error?.name === 'ZodError') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'VALIDATION_ERROR',\r\n          message: 'Invalid request payload',\r\n          details: error.issues ?? error.errors,\r\n        },\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  if (error?.code === 'P2002') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'CONFLICT',\r\n          message: 'A record with the same unique value already exists',\r\n          details: error.meta,\r\n        },\r\n      },\r\n      { status: 409 }\r\n    );\r\n  }\r\n\r\n  if (error?.code === 'P2003') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'RELATION_ERROR',\r\n          message: 'Related record is missing or invalid',\r\n          details: error.meta,\r\n        },\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  logger.error('Unhandled API error', {\r\n    code: error?.code,\r\n    message: error?.message,\r\n  });\r\n  void captureServerException(error, {\r\n    tags: { scope: 'api.createErrorResponse' },\r\n  });\r\n\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: error?.code || 'INTERNAL_ERROR',\r\n          message: error?.message || 'Unknown server error',\r\n          details: error?.stack || error,\r\n        },\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n\r\n  return Response.json(\r\n    { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\r\n    { status: 500 }\r\n  );\r\n}\r\n"],"names":["AppError","Error","code","status","details","message","name","createErrorResponse","error","Response","json","success","issues","errors","meta","tags","scope","stack"],"mappings":";;;;;;AAAA;AACA;;;AAEO,MAAMA,iBAAiBC;IACrBC,KAAa;IACbC,OAAe;IACfC,QAAc;IAErBJ,YAAYE,IAAY,EAAEG,OAAe,EAAEF,SAAiB,GAAG,EAAEC,OAAa,CAAE;QAC9E,KAAK,CAACC;QACN,IAAI,CAACC,IAAI,GAAG;QACZ,IAAI,CAACJ,IAAI,GAAGA;QACZ,IAAI,CAACC,MAAM,GAAGA;QACd,IAAI,CAACC,OAAO,GAAGA;IACjB;AACF;AAEO,SAASG,oBAAoBC,KAAU;IAC5C,IAAIA,iBAAiBR,YAAaQ,OAAOF,SAAS,cAAcE,OAAON,QAAQM,OAAOH,SAAU;QAC9F,OAAOI,SAASC,IAAI,CAClB;YAAEC,SAAS;YAAOH,OAAO;gBAAEN,MAAMM,MAAMN,IAAI;gBAAEG,SAASG,MAAMH,OAAO;gBAAED,SAASI,MAAMJ,OAAO;YAAC;QAAE,GAC9F;YAAED,QAAQK,MAAML,MAAM,IAAI;QAAI;IAElC;IAEA,IAAIK,OAAOF,SAAS,YAAY;QAC9B,OAAOG,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMI,MAAM,IAAIJ,MAAMK,MAAM;YACvC;QACF,GACA;YAAEV,QAAQ;QAAI;IAElB;IAEA,IAAIK,OAAON,SAAS,SAAS;QAC3B,OAAOO,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMM,IAAI;YACrB;QACF,GACA;YAAEX,QAAQ;QAAI;IAElB;IAEA,IAAIK,OAAON,SAAS,SAAS;QAC3B,OAAOO,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMM,IAAI;YACrB;QACF,GACA;YAAEX,QAAQ;QAAI;IAElB;IAEA,gIAAM,CAACK,KAAK,CAAC,uBAAuB;QAClCN,MAAMM,OAAON;QACbG,SAASG,OAAOH;IAClB;IACA,KAAK,IAAA,iKAAsB,EAACG,OAAO;QACjCO,MAAM;YAAEC,OAAO;QAA0B;IAC3C;IAEA,wCAA2C;QACzC,OAAOP,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAMM,OAAON,QAAQ;gBACrBG,SAASG,OAAOH,WAAW;gBAC3BD,SAASI,OAAOS,SAAST;YAC3B;QACF,GACA;YAAEL,QAAQ;QAAI;IAElB;;;AAMF"}},
    {"offset": {"line": 253, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/permissions.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\r\nimport { AppError } from './errors';\r\n\r\nexport type FarmPermission =\r\n  | 'finance:read'\r\n  | 'finance:write'\r\n  | 'finance:approve'\r\n  | 'updates:read'\r\n  | 'updates:write'\r\n  | 'digest:read'\r\n  | 'monitoring:read'\r\n  | 'monitoring:write'\r\n  | 'incident:read'\r\n  | 'incident:write'\r\n  | 'vendor:read'\r\n  | 'vendor:write'\r\n  | 'procurement:read'\r\n  | 'procurement:write'\r\n  | 'payroll:read'\r\n  | 'payroll:write'\r\n  | 'payroll:approve'\r\n  | 'payroll:pay';\r\n\r\ntype FarmRole = 'OWNER' | 'MANAGER' | 'WORKER';\r\n\r\nconst roleMatrix: Record<FarmRole, FarmPermission[]> = {\r\n  OWNER: [\r\n    'finance:read',\r\n    'finance:write',\r\n    'finance:approve',\r\n    'updates:read',\r\n    'updates:write',\r\n    'digest:read',\r\n    'monitoring:read',\r\n    'monitoring:write',\r\n    'incident:read',\r\n    'incident:write',\r\n    'vendor:read',\r\n    'vendor:write',\r\n    'procurement:read',\r\n    'procurement:write',\r\n    'payroll:read',\r\n    'payroll:write',\r\n    'payroll:approve',\r\n    'payroll:pay',\r\n  ],\r\n  MANAGER: [\r\n    'finance:read',\r\n    'finance:write',\r\n    'updates:read',\r\n    'updates:write',\r\n    'digest:read',\r\n    'monitoring:read',\r\n    'monitoring:write',\r\n    'incident:read',\r\n    'incident:write',\r\n    'vendor:read',\r\n    'vendor:write',\r\n    'procurement:read',\r\n    'procurement:write',\r\n    'payroll:read',\r\n    'payroll:write',\r\n  ],\r\n  WORKER: ['updates:read', 'updates:write', 'incident:read', 'incident:write', 'procurement:read'],\r\n};\r\n\r\nexport function getRequestRole(request: NextRequest): FarmRole {\r\n  const headerRole = request.headers.get('x-farm-role');\r\n  if (headerRole === 'OWNER' || headerRole === 'MANAGER' || headerRole === 'WORKER') {\r\n    return headerRole;\r\n  }\r\n\r\n  return 'MANAGER';\r\n}\r\n\r\nexport function getRequestUserId(request: NextRequest): string {\r\n  return request.headers.get('x-user-id') || 'user_id_from_session';\r\n}\r\n\r\nexport function requirePermission(request: NextRequest, permission: FarmPermission) {\r\n  const role = getRequestRole(request);\r\n  if (!roleMatrix[role].includes(permission)) {\r\n    throw new AppError('FORBIDDEN', 'You do not have permission for this action', 403);\r\n  }\r\n}\r\n"],"names":["roleMatrix","OWNER","MANAGER","WORKER","getRequestRole","request","headerRole","headers","get","getRequestUserId","requirePermission","permission","role","includes"],"mappings":";;;;;;;;AACA;;AAwBA,MAAMA,aAAiD;IACrDC,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACDC,SAAS;QACP;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACDC,QAAQ;QAAC;QAAgB;QAAiB;QAAiB;QAAkB;KAAmB;AAClG;AAEO,SAASC,eAAeC,OAAoB;IACjD,MAAMC,aAAaD,QAAQE,OAAO,CAACC,GAAG,CAAC;IACvC,IAAIF,eAAe,WAAWA,eAAe,aAAaA,eAAe,UAAU;QACjF,OAAOA;IACT;IAEA,OAAO;AACT;AAEO,SAASG,iBAAiBJ,OAAoB;IACnD,OAAOA,QAAQE,OAAO,CAACC,GAAG,CAAC,gBAAgB;AAC7C;AAEO,SAASE,kBAAkBL,OAAoB,EAAEM,UAA0B;IAChF,MAAMC,OAAOR,eAAeC;IAC5B,IAAI,CAACL,UAAU,CAACY,KAAK,CAACC,QAAQ,CAACF,aAAa;QAC1C,MAAM,IAAI,kIAAQ,CAAC,aAAa,8CAA8C;IAChF;AACF"}},
    {"offset": {"line": 329, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma = globalForPrisma.prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":["globalForPrisma","globalThis","prisma"],"mappings":";;;;AAAA;;AAEA,MAAMA,kBAAkBC;AAEjB,MAAMC,SAASF,gBAAgBE,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2CF,gBAAgBE,MAAM,GAAGA"}},
    {"offset": {"line": 342, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/services/monitoring/monitoring-service.ts"],"sourcesContent":["import { prisma } from '@/lib/prisma';\r\nimport { AppError } from '@/lib/errors';\r\n\r\ntype VraZoneInput = {\r\n  zoneId: string;\r\n  name: string;\r\n  hectares: number;\r\n  productivityIndex: number;\r\n};\r\n\r\ntype VraPlanInput = {\r\n  farmId: string;\r\n  userId: string;\r\n  idempotencyKey: string;\r\n  zones: VraZoneInput[];\r\n  market: {\r\n    commodityPricePerTon: number;\r\n    seedCostPerKg: number;\r\n    fertilizerCostPerKg: number;\r\n    targetMarginPerHa: number;\r\n  };\r\n  intelligence: {\r\n    weatherRisk: 'LOW' | 'MEDIUM' | 'HIGH';\r\n    pestPressure: 'LOW' | 'MEDIUM' | 'HIGH';\r\n    maxYieldPotentialTonsPerHa: number;\r\n  };\r\n};\r\n\r\ntype VraFeedbackInput = {\r\n  farmId: string;\r\n  userId: string;\r\n  idempotencyKey: string;\r\n  outcomes: Array<{\r\n    zoneId: string;\r\n    recommendedYieldPerHa: number;\r\n    actualYieldPerHa: number;\r\n  }>;\r\n};\r\n\r\nexport class MonitoringService {\r\n  private normalizeNumeric(value: unknown) {\r\n    if (typeof value === 'number' && Number.isFinite(value)) return value;\r\n    if (typeof value === 'string') {\r\n      const parsed = Number(value);\r\n      if (Number.isFinite(parsed)) return parsed;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private pickNumeric(data: unknown, keys: string[]) {\r\n    if (!data || typeof data !== 'object') return null;\r\n    const source = data as Record<string, unknown>;\r\n    for (const key of keys) {\r\n      const value = this.normalizeNumeric(source[key]);\r\n      if (value !== null) return value;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private clamp(value: number, min: number, max: number) {\r\n    return Math.max(min, Math.min(max, value));\r\n  }\r\n\r\n  private hashSeed(source: string) {\r\n    let hash = 0;\r\n    for (let index = 0; index < source.length; index += 1) {\r\n      hash = ((hash << 5) - hash + source.charCodeAt(index)) | 0;\r\n    }\r\n    return Math.abs(hash);\r\n  }\r\n\r\n  private inferFieldName(deviceName: string) {\r\n    const normalized = deviceName.trim();\r\n    if (!normalized) return 'General';\r\n\r\n    const splitByDash = normalized.split(' - ').map((part) => part.trim()).filter(Boolean);\r\n    if (splitByDash.length > 1) {\r\n      return splitByDash[splitByDash.length - 1];\r\n    }\r\n\r\n    return normalized;\r\n  }\r\n\r\n  private inferGrowthStage(ndvi: number) {\r\n    if (ndvi < 0.3) return 'GERMINATION';\r\n    if (ndvi < 0.45) return 'VEGETATIVE';\r\n    if (ndvi < 0.62) return 'FLOWERING';\r\n    if (ndvi < 0.75) return 'FRUIT_FILL';\r\n    return 'MATURITY';\r\n  }\r\n\r\n  async getDashboard(farmId: string) {\r\n    const now = Date.now();\r\n    const readingWindowStart = new Date(now - 24 * 60 * 60 * 1000);\r\n    const [devices, unresolvedAlerts, latestReadings, recentEvents] = await Promise.all([\r\n      prisma.sensorDevice.findMany({\r\n        where: { farmId },\r\n        include: {\r\n          readings: {\r\n            orderBy: { createdAt: 'desc' },\r\n            take: 1,\r\n          },\r\n        },\r\n      }),\r\n      prisma.alert.findMany({\r\n        where: { farmId, resolved: false },\r\n        orderBy: { createdAt: 'desc' },\r\n        take: 20,\r\n      }),\r\n      prisma.sensorReading.findMany({\r\n        where: {\r\n          device: { farmId },\r\n          createdAt: { gte: readingWindowStart },\r\n        },\r\n        include: { device: true },\r\n        orderBy: { createdAt: 'desc' },\r\n        take: 500,\r\n      }),\r\n      prisma.event.findMany({\r\n        where: { farmId },\r\n        orderBy: { createdAt: 'desc' },\r\n        take: 120,\r\n      }),\r\n    ]);\r\n\r\n    const leaderboardMap = new Map<string, {\r\n      fieldName: string;\r\n      score: number;\r\n      readingCount: number;\r\n      lastSignalAt: Date;\r\n      topDevice: string;\r\n      topDeviceCount: number;\r\n    }>();\r\n\r\n    for (const reading of latestReadings) {\r\n      const fieldName = this.inferFieldName(reading.device.name);\r\n      const minutesAgo = (now - reading.createdAt.getTime()) / (1000 * 60);\r\n      const recencyWeight = Math.max(0.2, 1 - Math.min(minutesAgo, 180) / 180);\r\n\r\n      const existing = leaderboardMap.get(fieldName);\r\n      if (!existing) {\r\n        leaderboardMap.set(fieldName, {\r\n          fieldName,\r\n          score: recencyWeight,\r\n          readingCount: 1,\r\n          lastSignalAt: reading.createdAt,\r\n          topDevice: reading.device.name,\r\n          topDeviceCount: 1,\r\n        });\r\n        continue;\r\n      }\r\n\r\n      existing.score += recencyWeight;\r\n      existing.readingCount += 1;\r\n      if (reading.createdAt > existing.lastSignalAt) {\r\n        existing.lastSignalAt = reading.createdAt;\r\n      }\r\n\r\n      if (reading.device.name === existing.topDevice) {\r\n        existing.topDeviceCount += 1;\r\n      } else if (existing.topDeviceCount <= 1) {\r\n        existing.topDevice = reading.device.name;\r\n        existing.topDeviceCount = 1;\r\n      }\r\n    }\r\n\r\n    const fieldLeaderboard = [...leaderboardMap.values()]\r\n      .sort((a, b) => b.score - a.score)\r\n      .slice(0, 8)\r\n      .map((entry, index) => ({\r\n        rank: index + 1,\r\n        fieldName: entry.fieldName,\r\n        score: Number(entry.score.toFixed(2)),\r\n        readingCount: entry.readingCount,\r\n        lastSignalAt: entry.lastSignalAt.toISOString(),\r\n        topDevice: entry.topDevice,\r\n      }));\r\n\r\n    const weatherRiskScore = this.clamp(\r\n      unresolvedAlerts.filter((alert) => alert.level === 'CRITICAL').length * 15\r\n      + unresolvedAlerts.filter((alert) => alert.level === 'WARNING').length * 6,\r\n      8,\r\n      95,\r\n    );\r\n    const weatherCondition = weatherRiskScore > 70\r\n      ? 'HIGH_RISK'\r\n      : weatherRiskScore > 45\r\n        ? 'MODERATE_RISK'\r\n        : 'STABLE';\r\n\r\n    const weatherForecast = {\r\n      riskLevel: weatherCondition,\r\n      next24hRainProbabilityPct: this.clamp(Math.round(weatherRiskScore * 0.9), 5, 98),\r\n      next24hTemperatureRangeC: {\r\n        min: this.clamp(14 + Math.round(weatherRiskScore * 0.06), 10, 26),\r\n        max: this.clamp(26 + Math.round(weatherRiskScore * 0.07), 23, 42),\r\n      },\r\n      windKph: this.clamp(8 + Math.round(weatherRiskScore * 0.22), 6, 34),\r\n      advisory: weatherRiskScore > 70\r\n        ? 'Pause non-critical spraying and protect high-stress zones.'\r\n        : weatherRiskScore > 45\r\n          ? 'Maintain irrigation watch and verify disease-prone blocks.'\r\n          : 'Proceed with normal operations and monitor threshold alerts.',\r\n    };\r\n\r\n    const ndviCandidates = latestReadings\r\n      .map((reading) => this.pickNumeric(reading.data, ['ndvi', 'NDVI', 'vegetationIndex', 'vigour']))\r\n      .filter((value): value is number => value !== null)\r\n      .map((value) => this.clamp(value, 0.1, 0.92));\r\n    const averageNdvi = ndviCandidates.length\r\n      ? ndviCandidates.reduce((sum, value) => sum + value, 0) / ndviCandidates.length\r\n      : this.clamp(0.38 + fieldLeaderboard.length * 0.03, 0.28, 0.78);\r\n\r\n    const vegetationIndices = {\r\n      ndvi: Number(averageNdvi.toFixed(3)),\r\n      evi: Number(this.clamp(averageNdvi * 0.82, 0.18, 0.82).toFixed(3)),\r\n      savi: Number(this.clamp(averageNdvi * 0.89, 0.2, 0.86).toFixed(3)),\r\n      trend: averageNdvi > 0.62 ? 'IMPROVING' : averageNdvi > 0.45 ? 'STABLE' : 'DECLINING',\r\n    };\r\n\r\n    const stageByField = fieldLeaderboard.map((field) => {\r\n      const fieldSignals = latestReadings.filter((reading) => this.inferFieldName(reading.device.name) === field.fieldName);\r\n      const fieldNdviSamples = fieldSignals\r\n        .map((reading) => this.pickNumeric(reading.data, ['ndvi', 'NDVI', 'vegetationIndex', 'vigour']))\r\n        .filter((value): value is number => value !== null)\r\n        .map((value) => this.clamp(value, 0.1, 0.92));\r\n\r\n      const fieldNdvi = fieldNdviSamples.length\r\n        ? fieldNdviSamples.reduce((sum, value) => sum + value, 0) / fieldNdviSamples.length\r\n        : this.clamp(vegetationIndices.ndvi + (field.rank === 1 ? 0.08 : 0) - field.rank * 0.02, 0.2, 0.86);\r\n\r\n      const stage = this.inferGrowthStage(fieldNdvi);\r\n      return {\r\n        fieldName: field.fieldName,\r\n        stage,\r\n        ndvi: Number(fieldNdvi.toFixed(3)),\r\n        confidence: Number(this.clamp(0.55 + field.readingCount / 50, 0.55, 0.98).toFixed(2)),\r\n      };\r\n    });\r\n\r\n    const machineEntries = devices.map((device) => {\r\n      const latestDeviceReading = latestReadings.find((reading) => reading.deviceId === device.id)\r\n        || device.readings[0]\r\n        || null;\r\n      const seed = this.hashSeed(device.id);\r\n\r\n      const baseFuel = 25 + (seed % 65);\r\n      const baseRpm = 900 + (seed % 1600);\r\n      const baseSpeed = (seed % 38);\r\n      const baseBattery = 11.8 + ((seed % 30) / 10);\r\n      const baseEngineHours = 120 + (seed % 2800);\r\n\r\n      const fuelLevelPct = this.clamp(\r\n        Math.round(this.pickNumeric(latestDeviceReading?.data, ['fuelLevelPct', 'fuel', 'tankLevel', 'fuelPct']) ?? baseFuel),\r\n        5,\r\n        100,\r\n      );\r\n      const speedKph = this.clamp(\r\n        Math.round(this.pickNumeric(latestDeviceReading?.data, ['speedKph', 'speed', 'velocity']) ?? baseSpeed),\r\n        0,\r\n        65,\r\n      );\r\n      const rpm = this.clamp(\r\n        Math.round(this.pickNumeric(latestDeviceReading?.data, ['rpm', 'engineRpm']) ?? baseRpm),\r\n        650,\r\n        3200,\r\n      );\r\n      const batteryVoltage = Number(this.clamp(\r\n        this.pickNumeric(latestDeviceReading?.data, ['batteryVoltage', 'voltage']) ?? baseBattery,\r\n        10.8,\r\n        14.7,\r\n      ).toFixed(1));\r\n      const engineHours = Math.round(this.clamp(\r\n        this.pickNumeric(latestDeviceReading?.data, ['engineHours', 'hours']) ?? baseEngineHours,\r\n        20,\r\n        9999,\r\n      ));\r\n      const temperatureC = Math.round(this.clamp(\r\n        this.pickNumeric(latestDeviceReading?.data, ['engineTempC', 'temperatureC', 'temp']) ?? (32 + (seed % 44)),\r\n        24,\r\n        118,\r\n      ));\r\n\r\n      const minutesSinceLastSeen = latestDeviceReading\r\n        ? Math.round((now - latestDeviceReading.createdAt.getTime()) / (1000 * 60))\r\n        : 9_999;\r\n      const connectivity = minutesSinceLastSeen <= 8 ? 'ONLINE' : minutesSinceLastSeen <= 35 ? 'DEGRADED' : 'OFFLINE';\r\n\r\n      const healthScore = this.clamp(\r\n        Math.round(\r\n          100\r\n          - Math.max(0, temperatureC - 92) * 1.2\r\n          - Math.max(0, 20 - fuelLevelPct) * 1.1\r\n          - (connectivity === 'OFFLINE' ? 32 : connectivity === 'DEGRADED' ? 14 : 0)\r\n        ),\r\n        18,\r\n        100,\r\n      );\r\n\r\n      return {\r\n        machineId: device.id,\r\n        machineName: device.name,\r\n        machineType: device.type,\r\n        fieldName: this.inferFieldName(device.name),\r\n        connectivity,\r\n        healthScore,\r\n        lastSeenAt: latestDeviceReading?.createdAt.toISOString() ?? null,\r\n        telemetry: {\r\n          engineHours,\r\n          speedKph,\r\n          fuelLevelPct,\r\n          rpm,\r\n          batteryVoltage,\r\n          temperatureC,\r\n        },\r\n      };\r\n    });\r\n\r\n    const sortedMachines = [...machineEntries].sort((a, b) => b.healthScore - a.healthScore);\r\n    const keyFactors = [\r\n      {\r\n        factor: 'Weather Stress',\r\n        status: weatherForecast.riskLevel,\r\n        impact: weatherForecast.riskLevel === 'HIGH_RISK' ? 'HIGH' : weatherForecast.riskLevel === 'MODERATE_RISK' ? 'MEDIUM' : 'LOW',\r\n      },\r\n      {\r\n        factor: 'Vegetation Trend',\r\n        status: vegetationIndices.trend,\r\n        impact: vegetationIndices.trend === 'DECLINING' ? 'HIGH' : vegetationIndices.trend === 'STABLE' ? 'MEDIUM' : 'LOW',\r\n      },\r\n      {\r\n        factor: 'Machinery Reliability',\r\n        status: sortedMachines.length\r\n          ? `${Math.round(sortedMachines.reduce((sum, machine) => sum + machine.healthScore, 0) / sortedMachines.length)} AVG`\r\n          : 'NO DATA',\r\n        impact: sortedMachines.some((machine) => machine.connectivity === 'OFFLINE') ? 'HIGH' : 'LOW',\r\n      },\r\n      {\r\n        factor: 'Alert Pressure',\r\n        status: `${unresolvedAlerts.length} OPEN`,\r\n        impact: unresolvedAlerts.length >= 4 ? 'HIGH' : unresolvedAlerts.length >= 2 ? 'MEDIUM' : 'LOW',\r\n      },\r\n    ];\r\n\r\n    const dataManager = {\r\n      summary: {\r\n        totalMachines: sortedMachines.length,\r\n        onlineMachines: sortedMachines.filter((machine) => machine.connectivity === 'ONLINE').length,\r\n        degradedMachines: sortedMachines.filter((machine) => machine.connectivity === 'DEGRADED').length,\r\n        offlineMachines: sortedMachines.filter((machine) => machine.connectivity === 'OFFLINE').length,\r\n        avgHealthScore: sortedMachines.length\r\n          ? Math.round(sortedMachines.reduce((sum, machine) => sum + machine.healthScore, 0) / sortedMachines.length)\r\n          : 0,\r\n      },\r\n      machines: sortedMachines,\r\n      recentMachineEvents: recentEvents\r\n        .filter((event) => event.type.includes('ALERT') || event.type.includes('SYNC') || event.type.includes('VRA'))\r\n        .slice(0, 12)\r\n        .map((event) => ({\r\n          id: event.id,\r\n          type: event.type,\r\n          at: event.createdAt.toISOString(),\r\n        })),\r\n      generatedAt: new Date().toISOString(),\r\n    };\r\n\r\n    const fieldStateAnalytics = {\r\n      weatherForecast,\r\n      vegetationIndices,\r\n      growthStages: stageByField,\r\n      keyFactors,\r\n      generatedAt: new Date().toISOString(),\r\n    };\r\n\r\n    return {\r\n      devices,\r\n      unresolvedAlerts,\r\n      latestReadings,\r\n      fieldLeaderboard,\r\n      leaderboardGeneratedAt: new Date().toISOString(),\r\n      fieldStateAnalytics,\r\n      dataManager,\r\n      summary: {\r\n        totalDevices: devices.length,\r\n        unresolvedAlerts: unresolvedAlerts.length,\r\n      },\r\n    };\r\n  }\r\n\r\n  async triggerAlert(input: {\r\n    farmId: string;\r\n    userId: string;\r\n    level: 'INFO' | 'WARNING' | 'CRITICAL';\r\n    message: string;\r\n    idempotencyKey: string;\r\n  }) {\r\n    const existing = await prisma.event.findUnique({\r\n      where: {\r\n        farmId_idempotencyKey: {\r\n          farmId: input.farmId,\r\n          idempotencyKey: input.idempotencyKey,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (existing) {\r\n      return { reused: true };\r\n    }\r\n\r\n    const alert = await prisma.$transaction(async (tx: any) => {\r\n      const createdAlert = await tx.alert.create({\r\n        data: {\r\n          farmId: input.farmId,\r\n          level: input.level,\r\n          message: input.message,\r\n          resolved: false,\r\n        },\r\n      });\r\n\r\n      await tx.event.create({\r\n        data: {\r\n          farmId: input.farmId,\r\n          type: 'SENSOR_ALERT_TRIGGERED',\r\n          payload: {\r\n            alertId: createdAlert.id,\r\n            level: input.level,\r\n            message: input.message,\r\n          },\r\n          userId: input.userId,\r\n          idempotencyKey: input.idempotencyKey,\r\n        },\r\n      });\r\n\r\n      return createdAlert;\r\n    }, { isolationLevel: 'Serializable' });\r\n\r\n    return alert;\r\n  }\r\n\r\n  async resolveAlert(input: { farmId: string; alertId: string; userId: string; idempotencyKey: string }) {\r\n    const alert = await prisma.alert.findFirst({ where: { id: input.alertId, farmId: input.farmId } });\r\n    if (!alert) {\r\n      throw new AppError('ALERT_NOT_FOUND', 'Alert not found', 404);\r\n    }\r\n\r\n    const existing = await prisma.event.findUnique({\r\n      where: {\r\n        farmId_idempotencyKey: {\r\n          farmId: input.farmId,\r\n          idempotencyKey: input.idempotencyKey,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (existing) {\r\n      return { reused: true };\r\n    }\r\n\r\n    await prisma.$transaction(async (tx: any) => {\r\n      await tx.alert.update({\r\n        where: { id: input.alertId },\r\n        data: { resolved: true },\r\n      });\r\n\r\n      await tx.event.create({\r\n        data: {\r\n          farmId: input.farmId,\r\n          type: 'ALERT_RESOLVED',\r\n          payload: { alertId: input.alertId },\r\n          userId: input.userId,\r\n          idempotencyKey: input.idempotencyKey,\r\n        },\r\n      });\r\n    }, { isolationLevel: 'Serializable' });\r\n\r\n    return { alertId: input.alertId, status: 'RESOLVED' };\r\n  }\r\n\r\n  private async getLearningAdjustment(farmId: string) {\r\n    const feedbackEvents = await prisma.event.findMany({\r\n      where: { farmId, type: 'VRA_FEEDBACK_RECORDED' },\r\n      orderBy: { createdAt: 'desc' },\r\n      take: 30,\r\n    });\r\n\r\n    const errors: number[] = [];\r\n\r\n    for (const event of feedbackEvents) {\r\n      const payload = event.payload as any;\r\n      const outcomes = Array.isArray(payload?.outcomes) ? payload.outcomes : [];\r\n      for (const outcome of outcomes) {\r\n        const recommended = Number(outcome?.recommendedYieldPerHa || 0);\r\n        const actual = Number(outcome?.actualYieldPerHa || 0);\r\n        if (recommended > 0) {\r\n          errors.push((actual - recommended) / recommended);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (errors.length === 0) {\r\n      return {\r\n        adjustmentFactor: 1,\r\n        confidence: 0,\r\n        averageYieldError: 0,\r\n      };\r\n    }\r\n\r\n    const averageYieldError = errors.reduce((sum, value) => sum + value, 0) / errors.length;\r\n    const adjustmentFactor = Math.max(0.85, Math.min(1.15, 1 + averageYieldError * 0.35));\r\n    const confidence = Math.min(1, errors.length / 20);\r\n\r\n    return {\r\n      adjustmentFactor,\r\n      confidence,\r\n      averageYieldError,\r\n    };\r\n  }\r\n\r\n  async generateVraPlan(input: VraPlanInput) {\r\n    if (!input.zones.length) {\r\n      throw new AppError('INVALID_ZONES', 'At least one productivity zone is required', 400);\r\n    }\r\n\r\n    const existing = await prisma.event.findUnique({\r\n      where: {\r\n        farmId_idempotencyKey: {\r\n          farmId: input.farmId,\r\n          idempotencyKey: input.idempotencyKey,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (existing) {\r\n      return existing.payload as any;\r\n    }\r\n\r\n    const learning = await this.getLearningAdjustment(input.farmId);\r\n\r\n    const phase1 = input.zones.map((zone) => {\r\n      const band = zone.productivityIndex < 0.4\r\n        ? 'LOW'\r\n        : zone.productivityIndex < 0.7\r\n          ? 'MEDIUM'\r\n          : 'HIGH';\r\n\r\n      return {\r\n        zoneId: zone.zoneId,\r\n        zoneName: zone.name,\r\n        hectares: zone.hectares,\r\n        productivityIndex: zone.productivityIndex,\r\n        applicationBand: band,\r\n      };\r\n    });\r\n\r\n    const weatherModifier = input.intelligence.weatherRisk === 'HIGH' ? 0.92 : input.intelligence.weatherRisk === 'MEDIUM' ? 0.97 : 1.02;\r\n    const pestModifier = input.intelligence.pestPressure === 'HIGH' ? 0.94 : input.intelligence.pestPressure === 'MEDIUM' ? 0.98 : 1.03;\r\n\r\n    const phase2 = phase1.map((zone) => {\r\n      const seedBandFactor = zone.applicationBand === 'LOW' ? 0.9 : zone.applicationBand === 'HIGH' ? 1.12 : 1;\r\n      const fertilizerBandFactor = zone.applicationBand === 'LOW' ? 0.88 : zone.applicationBand === 'HIGH' ? 1.15 : 1;\r\n\r\n      const seedRateKgPerHa = Number((22 * seedBandFactor * learning.adjustmentFactor).toFixed(2));\r\n      const fertilizerRateKgPerHa = Number((180 * fertilizerBandFactor * learning.adjustmentFactor).toFixed(2));\r\n\r\n      return {\r\n        zoneId: zone.zoneId,\r\n        zoneName: zone.zoneName,\r\n        hectares: zone.hectares,\r\n        seedRateKgPerHa,\r\n        fertilizerRateKgPerHa,\r\n      };\r\n    });\r\n\r\n    const optimizedZones = phase2.map((zone) => {\r\n      const productivity = phase1.find((item) => item.zoneId === zone.zoneId)?.productivityIndex || 0.5;\r\n      const estimatedYieldPerHa = Number((\r\n        input.intelligence.maxYieldPotentialTonsPerHa * productivity * weatherModifier * pestModifier\r\n      ).toFixed(2));\r\n\r\n      const grossRevenue = estimatedYieldPerHa * input.market.commodityPricePerTon * zone.hectares;\r\n      const inputCost = (\r\n        zone.seedRateKgPerHa * input.market.seedCostPerKg +\r\n        zone.fertilizerRateKgPerHa * input.market.fertilizerCostPerKg\r\n      ) * zone.hectares;\r\n\r\n      let adjustedSeedRateKgPerHa = zone.seedRateKgPerHa;\r\n      let adjustedFertilizerRateKgPerHa = zone.fertilizerRateKgPerHa;\r\n\r\n      const marginPerHa = (grossRevenue - inputCost) / zone.hectares;\r\n      if (marginPerHa < input.market.targetMarginPerHa) {\r\n        adjustedSeedRateKgPerHa = Number((zone.seedRateKgPerHa * 0.96).toFixed(2));\r\n        adjustedFertilizerRateKgPerHa = Number((zone.fertilizerRateKgPerHa * 0.9).toFixed(2));\r\n      }\r\n\r\n      const adjustedInputCost = (\r\n        adjustedSeedRateKgPerHa * input.market.seedCostPerKg +\r\n        adjustedFertilizerRateKgPerHa * input.market.fertilizerCostPerKg\r\n      ) * zone.hectares;\r\n\r\n      const expectedMargin = grossRevenue - adjustedInputCost;\r\n\r\n      return {\r\n        zoneId: zone.zoneId,\r\n        zoneName: zone.zoneName,\r\n        hectares: zone.hectares,\r\n        estimatedYieldPerHa,\r\n        optimizedSeedRateKgPerHa: adjustedSeedRateKgPerHa,\r\n        optimizedFertilizerRateKgPerHa: adjustedFertilizerRateKgPerHa,\r\n        expectedRevenue: Number(grossRevenue.toFixed(2)),\r\n        expectedInputCost: Number(adjustedInputCost.toFixed(2)),\r\n        expectedMargin: Number(expectedMargin.toFixed(2)),\r\n      };\r\n    });\r\n\r\n    const totalExpectedMargin = optimizedZones.reduce((sum, zone) => sum + zone.expectedMargin, 0);\r\n    const averageYieldPerHa = optimizedZones.reduce((sum, zone) => sum + zone.estimatedYieldPerHa, 0) / optimizedZones.length;\r\n\r\n    const plan = {\r\n      phase1,\r\n      phase2,\r\n      phase3: {\r\n        zones: optimizedZones,\r\n        totals: {\r\n          expectedMargin: Number(totalExpectedMargin.toFixed(2)),\r\n          averageYieldPerHa: Number(averageYieldPerHa.toFixed(2)),\r\n        },\r\n      },\r\n      phase4: {\r\n        learningAdjustmentFactor: Number(learning.adjustmentFactor.toFixed(4)),\r\n        learningConfidence: Number(learning.confidence.toFixed(2)),\r\n        averageYieldError: Number(learning.averageYieldError.toFixed(4)),\r\n        recommendation: learning.confidence < 0.3\r\n          ? 'Collect more yield feedback to strengthen zone intelligence.'\r\n          : learning.averageYieldError < 0\r\n            ? 'Yields are below recommendations; reduce aggressive rates in low-productivity zones.'\r\n            : 'Yields are meeting/exceeding recommendations; keep optimized strategy and monitor risk shifts.',\r\n      },\r\n      generatedAt: new Date().toISOString(),\r\n    };\r\n\r\n    await prisma.event.create({\r\n      data: {\r\n        farmId: input.farmId,\r\n        type: 'VRA_PLAN_GENERATED',\r\n        payload: plan,\r\n        userId: input.userId,\r\n        idempotencyKey: input.idempotencyKey,\r\n      },\r\n    });\r\n\r\n    return plan;\r\n  }\r\n\r\n  async recordVraFeedback(input: VraFeedbackInput) {\r\n    if (!input.outcomes.length) {\r\n      throw new AppError('INVALID_FEEDBACK', 'At least one zone outcome is required', 400);\r\n    }\r\n\r\n    const existing = await prisma.event.findUnique({\r\n      where: {\r\n        farmId_idempotencyKey: {\r\n          farmId: input.farmId,\r\n          idempotencyKey: input.idempotencyKey,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (existing) {\r\n      return { reused: true };\r\n    }\r\n\r\n    await prisma.event.create({\r\n      data: {\r\n        farmId: input.farmId,\r\n        type: 'VRA_FEEDBACK_RECORDED',\r\n        payload: { outcomes: input.outcomes, recordedAt: new Date().toISOString() },\r\n        userId: input.userId,\r\n        idempotencyKey: input.idempotencyKey,\r\n      },\r\n    });\r\n\r\n    return { status: 'RECORDED' };\r\n  }\r\n}\r\n\r\nexport const monitoringService = new MonitoringService();\r\n"],"names":["MonitoringService","normalizeNumeric","value","Number","isFinite","parsed","pickNumeric","data","keys","source","key","clamp","min","max","Math","hashSeed","hash","index","length","charCodeAt","abs","inferFieldName","deviceName","normalized","trim","splitByDash","split","map","part","filter","Boolean","inferGrowthStage","ndvi","getDashboard","farmId","now","Date","readingWindowStart","devices","unresolvedAlerts","latestReadings","recentEvents","Promise","all","sensorDevice","findMany","where","include","readings","orderBy","createdAt","take","alert","resolved","sensorReading","device","gte","event","leaderboardMap","Map","reading","fieldName","name","minutesAgo","getTime","recencyWeight","existing","get","set","score","readingCount","lastSignalAt","topDevice","topDeviceCount","fieldLeaderboard","values","sort","a","b","slice","entry","rank","toFixed","toISOString","weatherRiskScore","level","weatherCondition","weatherForecast","riskLevel","next24hRainProbabilityPct","round","next24hTemperatureRangeC","windKph","advisory","ndviCandidates","averageNdvi","reduce","sum","vegetationIndices","evi","savi","trend","stageByField","field","fieldSignals","fieldNdviSamples","fieldNdvi","stage","confidence","machineEntries","latestDeviceReading","find","deviceId","id","seed","baseFuel","baseRpm","baseSpeed","baseBattery","baseEngineHours","fuelLevelPct","speedKph","rpm","batteryVoltage","engineHours","temperatureC","minutesSinceLastSeen","connectivity","healthScore","machineId","machineName","machineType","type","lastSeenAt","telemetry","sortedMachines","keyFactors","factor","status","impact","machine","some","dataManager","summary","totalMachines","onlineMachines","degradedMachines","offlineMachines","avgHealthScore","machines","recentMachineEvents","includes","at","generatedAt","fieldStateAnalytics","growthStages","leaderboardGeneratedAt","totalDevices","triggerAlert","input","findUnique","farmId_idempotencyKey","idempotencyKey","reused","$transaction","tx","createdAlert","create","message","payload","alertId","userId","isolationLevel","resolveAlert","findFirst","update","getLearningAdjustment","feedbackEvents","errors","outcomes","Array","isArray","outcome","recommended","recommendedYieldPerHa","actual","actualYieldPerHa","push","adjustmentFactor","averageYieldError","generateVraPlan","zones","learning","phase1","zone","band","productivityIndex","zoneId","zoneName","hectares","applicationBand","weatherModifier","intelligence","weatherRisk","pestModifier","pestPressure","phase2","seedBandFactor","fertilizerBandFactor","seedRateKgPerHa","fertilizerRateKgPerHa","optimizedZones","productivity","item","estimatedYieldPerHa","maxYieldPotentialTonsPerHa","grossRevenue","market","commodityPricePerTon","inputCost","seedCostPerKg","fertilizerCostPerKg","adjustedSeedRateKgPerHa","adjustedFertilizerRateKgPerHa","marginPerHa","targetMarginPerHa","adjustedInputCost","expectedMargin","optimizedSeedRateKgPerHa","optimizedFertilizerRateKgPerHa","expectedRevenue","expectedInputCost","totalExpectedMargin","averageYieldPerHa","plan","phase3","totals","phase4","learningAdjustmentFactor","learningConfidence","recommendation","recordVraFeedback","recordedAt","monitoringService"],"mappings":"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"}},
    {"offset": {"line": 919, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/app/api/farms/%5BfarmId%5D/monitoring/vra/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\r\nimport { z } from 'zod';\r\nimport { createErrorResponse } from '@/lib/errors';\r\nimport { getRequestUserId, requirePermission } from '@/lib/permissions';\r\nimport { monitoringService } from '@/services/monitoring/monitoring-service';\r\n\r\nconst zoneSchema = z.object({\r\n  zoneId: z.string().min(1),\r\n  name: z.string().min(1),\r\n  hectares: z.number().positive(),\r\n  productivityIndex: z.number().min(0).max(1),\r\n});\r\n\r\nconst createSchema = z.object({\r\n  zones: z.array(zoneSchema).min(1).max(50),\r\n  market: z.object({\r\n    commodityPricePerTon: z.number().positive(),\r\n    seedCostPerKg: z.number().positive(),\r\n    fertilizerCostPerKg: z.number().positive(),\r\n    targetMarginPerHa: z.number().positive(),\r\n  }),\r\n  intelligence: z.object({\r\n    weatherRisk: z.enum(['LOW', 'MEDIUM', 'HIGH']),\r\n    pestPressure: z.enum(['LOW', 'MEDIUM', 'HIGH']),\r\n    maxYieldPotentialTonsPerHa: z.number().positive(),\r\n  }),\r\n  idempotencyKey: z.string().min(8),\r\n});\r\n\r\nconst sampleRequest = {\r\n  zones: [\r\n    { zoneId: 'z1', name: 'North Ridge', hectares: 12, productivityIndex: 0.34 },\r\n    { zoneId: 'z2', name: 'Central Flat', hectares: 18, productivityIndex: 0.61 },\r\n    { zoneId: 'z3', name: 'South Valley', hectares: 10, productivityIndex: 0.82 },\r\n  ],\r\n  market: {\r\n    commodityPricePerTon: 360,\r\n    seedCostPerKg: 2.6,\r\n    fertilizerCostPerKg: 0.95,\r\n    targetMarginPerHa: 420,\r\n  },\r\n  intelligence: {\r\n    weatherRisk: 'MEDIUM' as const,\r\n    pestPressure: 'LOW' as const,\r\n    maxYieldPotentialTonsPerHa: 6.2,\r\n  },\r\n};\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  context: { params: Promise<{ farmId: string }> }\r\n) {\r\n  try {\r\n    requirePermission(request, 'monitoring:read');\r\n    const { farmId } = await context.params;\r\n    const userId = getRequestUserId(request);\r\n\r\n    const data = await monitoringService.generateVraPlan({\r\n      farmId,\r\n      userId,\r\n      idempotencyKey: `sample-${new Date().toISOString().slice(0, 10)}`,\r\n      ...sampleRequest,\r\n    });\r\n\r\n    return Response.json({ success: true, data });\r\n  } catch (error) {\r\n    return createErrorResponse(error);\r\n  }\r\n}\r\n\r\nexport async function POST(\r\n  request: NextRequest,\r\n  context: { params: Promise<{ farmId: string }> }\r\n) {\r\n  try {\r\n    requirePermission(request, 'monitoring:write');\r\n    const { farmId } = await context.params;\r\n    const userId = getRequestUserId(request);\r\n    const input = createSchema.parse(await request.json());\r\n\r\n    const data = await monitoringService.generateVraPlan({\r\n      farmId,\r\n      userId,\r\n      ...input,\r\n    });\r\n\r\n    return Response.json({ success: true, data });\r\n  } catch (error) {\r\n    return createErrorResponse(error);\r\n  }\r\n}\r\n"],"names":["zoneSchema","object","zoneId","string","min","name","hectares","number","positive","productivityIndex","max","createSchema","zones","array","market","commodityPricePerTon","seedCostPerKg","fertilizerCostPerKg","targetMarginPerHa","intelligence","weatherRisk","enum","pestPressure","maxYieldPotentialTonsPerHa","idempotencyKey","sampleRequest","GET","request","context","farmId","params","userId","data","generateVraPlan","Date","toISOString","slice","Response","json","success","error","POST","input","parse"],"mappings":";;;;;;AACA;AACA;AACA;AACA;;;;;AAEA,MAAMA,aAAa,yKAAC,CAACC,MAAM,CAAC;IAC1BC,QAAQ,yKAAC,CAACC,MAAM,GAAGC,GAAG,CAAC;IACvBC,MAAM,yKAAC,CAACF,MAAM,GAAGC,GAAG,CAAC;IACrBE,UAAU,yKAAC,CAACC,MAAM,GAAGC,QAAQ;IAC7BC,mBAAmB,yKAAC,CAACF,MAAM,GAAGH,GAAG,CAAC,GAAGM,GAAG,CAAC;AAC3C;AAEA,MAAMC,eAAe,yKAAC,CAACV,MAAM,CAAC;IAC5BW,OAAO,yKAAC,CAACC,KAAK,CAACb,YAAYI,GAAG,CAAC,GAAGM,GAAG,CAAC;IACtCI,QAAQ,yKAAC,CAACb,MAAM,CAAC;QACfc,sBAAsB,yKAAC,CAACR,MAAM,GAAGC,QAAQ;QACzCQ,eAAe,yKAAC,CAACT,MAAM,GAAGC,QAAQ;QAClCS,qBAAqB,yKAAC,CAACV,MAAM,GAAGC,QAAQ;QACxCU,mBAAmB,yKAAC,CAACX,MAAM,GAAGC,QAAQ;IACxC;IACAW,cAAc,yKAAC,CAAClB,MAAM,CAAC;QACrBmB,aAAa,yKAAC,CAACC,IAAI,CAAC;YAAC;YAAO;YAAU;SAAO;QAC7CC,cAAc,yKAAC,CAACD,IAAI,CAAC;YAAC;YAAO;YAAU;SAAO;QAC9CE,4BAA4B,yKAAC,CAAChB,MAAM,GAAGC,QAAQ;IACjD;IACAgB,gBAAgB,yKAAC,CAACrB,MAAM,GAAGC,GAAG,CAAC;AACjC;AAEA,MAAMqB,gBAAgB;IACpBb,OAAO;QACL;YAAEV,QAAQ;YAAMG,MAAM;YAAeC,UAAU;YAAIG,mBAAmB;QAAK;QAC3E;YAAEP,QAAQ;YAAMG,MAAM;YAAgBC,UAAU;YAAIG,mBAAmB;QAAK;QAC5E;YAAEP,QAAQ;YAAMG,MAAM;YAAgBC,UAAU;YAAIG,mBAAmB;QAAK;KAC7E;IACDK,QAAQ;QACNC,sBAAsB;QACtBC,eAAe;QACfC,qBAAqB;QACrBC,mBAAmB;IACrB;IACAC,cAAc;QACZC,aAAa;QACbE,cAAc;QACdC,4BAA4B;IAC9B;AACF;AAEO,eAAeG,IACpBC,OAAoB,EACpBC,OAAgD;IAEhD,IAAI;QACF,IAAA,gJAAiB,EAACD,SAAS;QAC3B,MAAM,EAAEE,MAAM,EAAE,GAAG,MAAMD,QAAQE,MAAM;QACvC,MAAMC,SAAS,IAAA,+IAAgB,EAACJ;QAEhC,MAAMK,OAAO,MAAM,6KAAiB,CAACC,eAAe,CAAC;YACnDJ;YACAE;YACAP,gBAAgB,CAAC,OAAO,EAAE,IAAIU,OAAOC,WAAW,GAAGC,KAAK,CAAC,GAAG,KAAK;YACjE,GAAGX,aAAa;QAClB;QAEA,OAAOY,SAASC,IAAI,CAAC;YAAEC,SAAS;YAAMP;QAAK;IAC7C,EAAE,OAAOQ,OAAO;QACd,OAAO,IAAA,6IAAmB,EAACA;IAC7B;AACF;AAEO,eAAeC,KACpBd,OAAoB,EACpBC,OAAgD;IAEhD,IAAI;QACF,IAAA,gJAAiB,EAACD,SAAS;QAC3B,MAAM,EAAEE,MAAM,EAAE,GAAG,MAAMD,QAAQE,MAAM;QACvC,MAAMC,SAAS,IAAA,+IAAgB,EAACJ;QAChC,MAAMe,QAAQ/B,aAAagC,KAAK,CAAC,MAAMhB,QAAQW,IAAI;QAEnD,MAAMN,OAAO,MAAM,6KAAiB,CAACC,eAAe,CAAC;YACnDJ;YACAE;YACA,GAAGW,KAAK;QACV;QAEA,OAAOL,SAASC,IAAI,CAAC;YAAEC,SAAS;YAAMP;QAAK;IAC7C,EAAE,OAAOQ,OAAO;QACd,OAAO,IAAA,6IAAmB,EAACA;IAC7B;AACF"}}]
}