{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/components/features/payroll/payroll-module.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useAuth } from '@/components/layout/auth-provider';\r\nimport { useMutation, useQuery } from '@tanstack/react-query';\r\nimport { useState } from 'react';\r\nimport { formatDate } from '@/lib/utils';\r\n\r\ntype ApiEnvelope<T> = {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: { code: string; message: string };\r\n};\r\n\r\nasync function apiCall<T>(path: string, options?: RequestInit): Promise<T> {\r\n  const response = await fetch(path, {\r\n    ...options,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      ...(options?.headers || {}),\r\n    },\r\n  });\r\n\r\n  const json = (await response.json()) as ApiEnvelope<T>;\r\n  if (!json.success) {\r\n    throw new Error(json.error?.message || 'Request failed');\r\n  }\r\n\r\n  return json.data as T;\r\n}\r\n\r\nexport function PayrollModule() {\r\n  const { farmId } = useAuth();\r\n  const [startDate, setStartDate] = useState('');\r\n  const [endDate, setEndDate] = useState('');\r\n  const [workerId, setWorkerId] = useState('');\r\n  const [grossAmount, setGrossAmount] = useState(0);\r\n  const [netAmount, setNetAmount] = useState(0);\r\n  const [paymentRef, setPaymentRef] = useState('');\r\n\r\n  const runsQuery = useQuery({\r\n    queryKey: ['payroll-runs', farmId],\r\n    queryFn: () => apiCall<any[]>(`/api/farms/${farmId}/payroll/runs`),\r\n    enabled: Boolean(farmId),\r\n  });\r\n\r\n  const createRunMutation = useMutation({\r\n    mutationFn: () => apiCall(`/api/farms/${farmId}/payroll/runs`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({\r\n        startDate: new Date(startDate).toISOString(),\r\n        endDate: new Date(endDate).toISOString(),\r\n        idempotencyKey: crypto.randomUUID(),\r\n        entries: [{ userId: workerId, grossAmount, netAmount }],\r\n      }),\r\n    }),\r\n    onSuccess: () => {\r\n      void runsQuery.refetch();\r\n    },\r\n  });\r\n\r\n  const approveRunMutation = useMutation({\r\n    mutationFn: (runId: string) => apiCall(`/api/farms/${farmId}/payroll/runs/${runId}/approve`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({\r\n        idempotencyKey: crypto.randomUUID(),\r\n      }),\r\n    }),\r\n    onSuccess: () => {\r\n      void runsQuery.refetch();\r\n    },\r\n  });\r\n\r\n  const payRunMutation = useMutation({\r\n    mutationFn: (runId: string) => apiCall(`/api/farms/${farmId}/payroll/runs/${runId}/pay`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({\r\n        idempotencyKey: crypto.randomUUID(),\r\n        reference: paymentRef || `PAY-${Date.now()}`,\r\n      }),\r\n    }),\r\n    onSuccess: () => {\r\n      void runsQuery.refetch();\r\n    },\r\n  });\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-6 max-w-6xl mx-auto w-full space-y-6 pb-24 md:pb-8\">\r\n      <header>\r\n        <h1 className=\"text-2xl font-bold tracking-tight\">Payroll</h1>\r\n        <p className=\"text-xs text-muted-foreground uppercase font-semibold\">Run prep, approvals, payment status</p>\r\n      </header>\r\n\r\n      <section className=\"p-4 border rounded-xl bg-card space-y-3\">\r\n        <h2 className=\"text-sm font-bold uppercase\">Create Payroll Run</h2>\r\n        <div className=\"grid grid-cols-2 gap-2\">\r\n          <input\r\n            type=\"date\"\r\n            value={startDate}\r\n            onChange={(event) => setStartDate(event.target.value)}\r\n            className=\"w-full h-10 rounded-md bg-accent/50 px-3 text-sm\"\r\n          />\r\n          <input\r\n            type=\"date\"\r\n            value={endDate}\r\n            onChange={(event) => setEndDate(event.target.value)}\r\n            className=\"w-full h-10 rounded-md bg-accent/50 px-3 text-sm\"\r\n          />\r\n        </div>\r\n        <input\r\n          value={workerId}\r\n          onChange={(event) => setWorkerId(event.target.value)}\r\n          placeholder=\"Worker User ID\"\r\n          className=\"w-full h-10 rounded-md bg-accent/50 px-3 text-sm\"\r\n        />\r\n        <div className=\"grid grid-cols-2 gap-2\">\r\n          <input\r\n            type=\"number\"\r\n            value={grossAmount}\r\n            onChange={(event) => setGrossAmount(Number(event.target.value))}\r\n            placeholder=\"Gross\"\r\n            className=\"w-full h-10 rounded-md bg-accent/50 px-3 text-sm\"\r\n          />\r\n          <input\r\n            type=\"number\"\r\n            value={netAmount}\r\n            onChange={(event) => setNetAmount(Number(event.target.value))}\r\n            placeholder=\"Net\"\r\n            className=\"w-full h-10 rounded-md bg-accent/50 px-3 text-sm\"\r\n          />\r\n        </div>\r\n        <button\r\n          onClick={() => createRunMutation.mutate()}\r\n          disabled={createRunMutation.isPending || !startDate || !endDate || !workerId || grossAmount <= 0 || netAmount <= 0}\r\n          className=\"w-full h-10 rounded-md bg-primary text-primary-foreground text-sm font-semibold disabled:opacity-50\"\r\n        >\r\n          {createRunMutation.isPending ? 'Creating...' : 'Create Run'}\r\n        </button>\r\n      </section>\r\n\r\n      <section className=\"p-4 border rounded-xl bg-card space-y-3\">\r\n        <h2 className=\"text-sm font-bold uppercase\">Payment Reference</h2>\r\n        <input\r\n          value={paymentRef}\r\n          onChange={(event) => setPaymentRef(event.target.value)}\r\n          placeholder=\"Optional payment reference\"\r\n          className=\"w-full h-10 rounded-md bg-accent/50 px-3 text-sm\"\r\n        />\r\n      </section>\r\n\r\n      <section className=\"p-4 border rounded-xl bg-card\">\r\n        <h2 className=\"text-sm font-bold uppercase mb-3\">Recent Runs</h2>\r\n        <div className=\"space-y-3\">\r\n          {runsQuery.data?.length ? runsQuery.data.map((run: any) => (\r\n            <div key={run.id} className=\"p-3 rounded-md bg-accent/20 space-y-2\">\r\n              <div className=\"flex items-center justify-between text-xs\">\r\n                <span className=\"font-semibold\">{run.id.slice(0, 12)}</span>\r\n                <span className=\"uppercase text-muted-foreground\">{run.status}</span>\r\n              </div>\r\n              <p className=\"text-[11px] text-muted-foreground\">\r\n                {formatDate(run.startDate)} - {formatDate(run.endDate)}\r\n              </p>\r\n              <div className=\"flex gap-2\">\r\n                <button\r\n                  onClick={() => approveRunMutation.mutate(run.id)}\r\n                  disabled={approveRunMutation.isPending || run.status === 'PAID'}\r\n                  className=\"h-8 px-3 rounded-md bg-secondary text-secondary-foreground text-xs font-semibold disabled:opacity-50\"\r\n                >\r\n                  Approve\r\n                </button>\r\n                <button\r\n                  onClick={() => payRunMutation.mutate(run.id)}\r\n                  disabled={payRunMutation.isPending || run.status === 'PAID'}\r\n                  className=\"h-8 px-3 rounded-md bg-primary text-primary-foreground text-xs font-semibold disabled:opacity-50\"\r\n                >\r\n                  Mark Paid\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )) : <p className=\"text-xs text-muted-foreground\">No payroll runs yet.</p>}\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["apiCall","path","options","response","fetch","headers","json","success","Error","error","message","data","PayrollModule","farmId","startDate","setStartDate","endDate","setEndDate","workerId","setWorkerId","grossAmount","setGrossAmount","netAmount","setNetAmount","paymentRef","setPaymentRef","runsQuery","queryKey","queryFn","enabled","Boolean","createRunMutation","mutationFn","method","body","JSON","stringify","Date","toISOString","idempotencyKey","crypto","randomUUID","entries","userId","onSuccess","refetch","approveRunMutation","runId","payRunMutation","reference","now","className","type","value","onChange","event","target","placeholder","Number","onClick","mutate","disabled","isPending","length","map","run","id","slice","status"],"mappings":"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"}},
    {"offset": {"line": 392, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/app/%28dashboard%29/payroll/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { PayrollModule } from '@/components/features/payroll/payroll-module';\r\n\r\nexport default function PayrollPage() {\r\n  return <PayrollModule />;\r\n}\r\n"],"names":["PayrollPage"],"mappings":";;;;;AAEA;AAFA;;;AAIe,SAASA;IACtB,qBAAO,6LAAC,kLAAa;;;;;AACvB;KAFwBA"}}]
}