{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/components/layout/auth-provider.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { createContext, useContext, ReactNode, useEffect, useMemo, useState } from 'react';\r\n\r\ntype Role = 'OWNER' | 'MANAGER' | 'WORKER';\r\n\r\ninterface AuthContextType {\r\n  role: Role | null;\r\n  farmId: string | null;\r\n  isLoading: boolean;\r\n  isRegistered: boolean;\r\n  isAuthenticated: boolean;\r\n  setRole: (role: Role) => void;\r\n  setFarmId: (farmId: string) => void;\r\n  setRegistered: (registered: boolean) => void;\r\n  logout: () => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n  const [role, setRoleState] = useState<Role | null>(null);\r\n  const [farmId, setFarmIdState] = useState<string | null>(null);\r\n  const [isRegistered, setIsRegistered] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const registered = localStorage.getItem('farmops.registered') === 'true';\r\n      const storedRole = localStorage.getItem('farmops.role');\r\n      const storedFarmId = localStorage.getItem('farmops.farmId');\r\n\r\n      setIsRegistered(registered);\r\n\r\n      if (!registered) {\r\n        localStorage.removeItem('farmops.role');\r\n        localStorage.removeItem('farmops.farmId');\r\n        return;\r\n      }\r\n\r\n      if (storedRole === 'OWNER' || storedRole === 'MANAGER' || storedRole === 'WORKER') {\r\n        setRoleState(storedRole);\r\n      }\r\n\r\n      if (storedFarmId && storedFarmId.trim().length > 0) {\r\n        setFarmIdState(storedFarmId);\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const setRole = (nextRole: Role) => {\r\n    setRoleState(nextRole);\r\n    localStorage.setItem('farmops.role', nextRole);\r\n  };\r\n\r\n  const setFarmId = (nextFarmId: string) => {\r\n    setFarmIdState(nextFarmId);\r\n    localStorage.setItem('farmops.farmId', nextFarmId);\r\n  };\r\n\r\n  const setRegistered = (registered: boolean) => {\r\n    setIsRegistered(registered);\r\n    localStorage.setItem('farmops.registered', registered ? 'true' : 'false');\r\n\r\n    if (!registered) {\r\n      setRoleState(null);\r\n      setFarmIdState(null);\r\n      localStorage.removeItem('farmops.role');\r\n      localStorage.removeItem('farmops.farmId');\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    setRoleState(null);\r\n    setFarmIdState(null);\r\n    localStorage.removeItem('farmops.role');\r\n    localStorage.removeItem('farmops.farmId');\r\n  };\r\n\r\n  const auth = useMemo(() => ({\r\n    role,\r\n    farmId,\r\n    isLoading,\r\n    isRegistered,\r\n    isAuthenticated: Boolean(role && farmId),\r\n    setRole,\r\n    setFarmId,\r\n    setRegistered,\r\n    logout,\r\n  }), [role, farmId, isLoading, isRegistered]);\r\n\r\n  return <AuthContext.Provider value={auth}>{children}</AuthContext.Provider>;\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n}\r\n"],"names":["AuthContext","undefined","AuthProvider","children","role","setRoleState","farmId","setFarmIdState","isRegistered","setIsRegistered","isLoading","setIsLoading","registered","localStorage","getItem","storedRole","storedFarmId","removeItem","trim","length","setRole","nextRole","setItem","setFarmId","nextFarmId","setRegistered","logout","auth","isAuthenticated","Boolean","Provider","value","useAuth","context","Error"],"mappings":";;;;;;;AAEA;AAFA;;;AAkBA,MAAMA,4BAAc,IAAA,sNAAa,EAA8BC;AAExD,SAASC,aAAa,EAAEC,QAAQ,EAA2B;IAChE,MAAM,CAACC,MAAMC,aAAa,GAAG,IAAA,iNAAQ,EAAc;IACnD,MAAM,CAACC,QAAQC,eAAe,GAAG,IAAA,iNAAQ,EAAgB;IACzD,MAAM,CAACC,cAAcC,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IACjD,MAAM,CAACC,WAAWC,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAE3C,IAAA,kNAAS,EAAC;QACR,IAAI;YACF,MAAMC,aAAaC,aAAaC,OAAO,CAAC,0BAA0B;YAClE,MAAMC,aAAaF,aAAaC,OAAO,CAAC;YACxC,MAAME,eAAeH,aAAaC,OAAO,CAAC;YAE1CL,gBAAgBG;YAEhB,IAAI,CAACA,YAAY;gBACfC,aAAaI,UAAU,CAAC;gBACxBJ,aAAaI,UAAU,CAAC;gBACxB;YACF;YAEA,IAAIF,eAAe,WAAWA,eAAe,aAAaA,eAAe,UAAU;gBACjFV,aAAaU;YACf;YAEA,IAAIC,gBAAgBA,aAAaE,IAAI,GAAGC,MAAM,GAAG,GAAG;gBAClDZ,eAAeS;YACjB;QACF,SAAU;YACRL,aAAa;QACf;IACF,GAAG,EAAE;IAEL,MAAMS,UAAU,CAACC;QACfhB,aAAagB;QACbR,aAAaS,OAAO,CAAC,gBAAgBD;IACvC;IAEA,MAAME,YAAY,CAACC;QACjBjB,eAAeiB;QACfX,aAAaS,OAAO,CAAC,kBAAkBE;IACzC;IAEA,MAAMC,gBAAgB,CAACb;QACrBH,gBAAgBG;QAChBC,aAAaS,OAAO,CAAC,sBAAsBV,aAAa,SAAS;QAEjE,IAAI,CAACA,YAAY;YACfP,aAAa;YACbE,eAAe;YACfM,aAAaI,UAAU,CAAC;YACxBJ,aAAaI,UAAU,CAAC;QAC1B;IACF;IAEA,MAAMS,SAAS;QACbrB,aAAa;QACbE,eAAe;QACfM,aAAaI,UAAU,CAAC;QACxBJ,aAAaI,UAAU,CAAC;IAC1B;IAEA,MAAMU,OAAO,IAAA,gNAAO,EAAC,IAAM,CAAC;YAC1BvB;YACAE;YACAI;YACAF;YACAoB,iBAAiBC,QAAQzB,QAAQE;YACjCc;YACAG;YACAE;YACAC;QACF,CAAC,GAAG;QAACtB;QAAME;QAAQI;QAAWF;KAAa;IAE3C,qBAAO,8OAACR,YAAY8B,QAAQ;QAACC,OAAOJ;kBAAOxB;;;;;;AAC7C;AAEO,SAAS6B;IACd,MAAMC,UAAU,IAAA,mNAAU,EAACjC;IAC3B,IAAIiC,YAAYhC,WAAW;QACzB,MAAM,IAAIiC,MAAM;IAClB;IACA,OAAOD;AACT"}},
    {"offset": {"line": 126, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from 'clsx';\r\nimport { twMerge } from 'tailwind-merge';\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs));\r\n}\r\n\r\nexport function formatDate(date: Date | string) {\r\n  return new Intl.DateTimeFormat('en-GB', {\r\n    day: 'numeric',\r\n    month: 'short',\r\n    year: '2-digit',\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n  }).format(new Date(date));\r\n}\r\n"],"names":["cn","inputs","formatDate","date","Intl","DateTimeFormat","day","month","year","hour","minute","format","Date"],"mappings":";;;;;;AAAA;AACA;;;AAEO,SAASA,GAAG,GAAGC,MAAoB;IACxC,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAACA;AACtB;AAEO,SAASC,WAAWC,IAAmB;IAC5C,OAAO,IAAIC,KAAKC,cAAc,CAAC,SAAS;QACtCC,KAAK;QACLC,OAAO;QACPC,MAAM;QACNC,MAAM;QACNC,QAAQ;IACV,GAAGC,MAAM,CAAC,IAAIC,KAAKT;AACrB"}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/db/index.ts"],"sourcesContent":["import Dexie, { type Table } from 'dexie';\r\n\r\nexport interface OutboxEntry {\r\n  id: string;\r\n  domain: string;\r\n  action: string;\r\n  payload: any;\r\n  status: 'PENDING' | 'SYNCING' | 'FAILED' | 'COMPLETED';\r\n  retryCount: number;\r\n  lastError?: string;\r\n  createdAt: Date;\r\n  nextAttemptAt?: Date;\r\n}\r\n\r\nexport interface LocalTask {\r\n  id: string;\r\n  farmId: string;\r\n  title: string;\r\n  status: 'TODO' | 'IN_PROGRESS' | 'COMPLETED' | 'VERIFIED';\r\n  dueDate: Date;\r\n  assignedTo?: string;\r\n  data: any;\r\n}\r\n\r\nexport class FarmDB extends Dexie {\r\n  outbox!: Table<OutboxEntry>;\r\n  local_tasks!: Table<LocalTask>;\r\n  local_media!: Table<{ id: string; blob: Blob; metadata: any; synced: boolean }>;\r\n  sync_meta!: Table<{ key: string; value: any }>;\r\n\r\n  constructor() {\r\n    super('FarmOpsDB');\r\n    this.version(1).stores({\r\n      outbox: 'id, domain, status, createdAt',\r\n      local_tasks: 'id, farmId, status, dueDate',\r\n      local_media: 'id, synced',\r\n      sync_meta: 'key'\r\n    });\r\n  }\r\n}\r\n\r\nexport const db = new FarmDB();\r\n"],"names":["FarmDB","outbox","local_tasks","local_media","sync_meta","version","stores","db"],"mappings":";;;;;;AAAA;;AAwBO,MAAMA,eAAe,sJAAK;IAC/BC,OAA4B;IAC5BC,YAA+B;IAC/BC,YAAgF;IAChFC,UAA+C;IAE/CJ,aAAc;QACZ,KAAK,CAAC;QACN,IAAI,CAACK,OAAO,CAAC,GAAGC,MAAM,CAAC;YACrBL,QAAQ;YACRC,aAAa;YACbC,aAAa;YACbC,WAAW;QACb;IACF;AACF;AAEO,MAAMG,KAAK,IAAIP"}},
    {"offset": {"line": 180, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/store/outbox.ts"],"sourcesContent":["import { create } from 'zustand';\r\n\r\ninterface OutboxState {\r\n  isSyncing: boolean;\r\n  pendingCount: number;\r\n  setSyncing: (status: boolean) => void;\r\n  setPendingCount: (count: number) => void;\r\n}\r\n\r\nexport const useOutboxStore = create<OutboxState>((set) => ({\r\n  isSyncing: false,\r\n  pendingCount: 0,\r\n  setSyncing: (status) => set({ isSyncing: status }),\r\n  setPendingCount: (count) => set({ pendingCount: count }),\r\n}));\r\n"],"names":["useOutboxStore","set","isSyncing","pendingCount","setSyncing","status","setPendingCount","count"],"mappings":";;;;AAAA;;AASO,MAAMA,iBAAiB,IAAA,kJAAM,EAAc,CAACC,MAAQ,CAAC;QAC1DC,WAAW;QACXC,cAAc;QACdC,YAAY,CAACC,SAAWJ,IAAI;gBAAEC,WAAWG;YAAO;QAChDC,iBAAiB,CAACC,QAAUN,IAAI;gBAAEE,cAAcI;YAAM;IACxD,CAAC"}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/hooks/outbox-transitions.ts"],"sourcesContent":["import type { OutboxEntry } from '@/lib/db';\r\n\r\nexport function toCompletedUpdate() {\r\n  return { status: 'COMPLETED' as const };\r\n}\r\n\r\nexport function toFailedUpdate(entry: OutboxEntry, error: unknown) {\r\n  return {\r\n    status: 'FAILED' as const,\r\n    retryCount: entry.retryCount + 1,\r\n    lastError: error instanceof Error ? error.message : 'Unknown error',\r\n  };\r\n}\r\n\r\nexport function toRetryUpdate() {\r\n  return {\r\n    status: 'PENDING' as const,\r\n    retryCount: 0,\r\n    lastError: undefined,\r\n    nextAttemptAt: new Date(),\r\n  };\r\n}\r\n"],"names":["toCompletedUpdate","status","toFailedUpdate","entry","error","retryCount","lastError","Error","message","toRetryUpdate","undefined","nextAttemptAt","Date"],"mappings":";;;;;;;;AAEO,SAASA;IACd,OAAO;QAAEC,QAAQ;IAAqB;AACxC;AAEO,SAASC,eAAeC,KAAkB,EAAEC,KAAc;IAC/D,OAAO;QACLH,QAAQ;QACRI,YAAYF,MAAME,UAAU,GAAG;QAC/BC,WAAWF,iBAAiBG,QAAQH,MAAMI,OAAO,GAAG;IACtD;AACF;AAEO,SAASC;IACd,OAAO;QACLR,QAAQ;QACRI,YAAY;QACZC,WAAWI;QACXC,eAAe,IAAIC;IACrB;AACF"}},
    {"offset": {"line": 232, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/hooks/use-offline-sync.ts"],"sourcesContent":["import { useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { db, OutboxEntry } from '@/lib/db';\r\nimport { useOutboxStore } from '@/lib/store/outbox';\r\nimport { useCallback, useEffect } from 'react';\r\nimport { toCompletedUpdate, toFailedUpdate } from './outbox-transitions';\r\n\r\nexport function useOfflineAction<T>(domain: string, action: string) {\r\n  const queryClient = useQueryClient();\r\n  const setPendingCount = useOutboxStore((state) => state.setPendingCount);\r\n\r\n  return useMutation({\r\n    mutationFn: async (payload: T) => {\r\n      const taskId = (payload as { taskId?: string })?.taskId;\r\n      if (typeof taskId === 'string' && taskId.length > 0) {\r\n        const existing = await db.outbox\r\n          .where('status')\r\n          .anyOf(['PENDING', 'FAILED', 'SYNCING'])\r\n          .filter((entry) => (\r\n            entry.domain === domain\r\n            && entry.action === action\r\n            && (entry.payload as { taskId?: string } | undefined)?.taskId === taskId\r\n          ))\r\n          .first();\r\n\r\n        if (existing) {\r\n          await db.outbox.update(existing.id, {\r\n            payload,\r\n            status: 'PENDING',\r\n            retryCount: 0,\r\n            lastError: undefined,\r\n            createdAt: new Date(),\r\n          });\r\n\r\n          const count = await db.outbox.where('status').equals('PENDING').count();\r\n          setPendingCount(count);\r\n          return { ...existing, payload, status: 'PENDING', retryCount: 0, lastError: undefined } as OutboxEntry;\r\n        }\r\n      }\r\n\r\n      const entry: OutboxEntry = {\r\n        id: crypto.randomUUID(),\r\n        domain,\r\n        action,\r\n        payload,\r\n        status: 'PENDING',\r\n        retryCount: 0,\r\n        createdAt: new Date(),\r\n      };\r\n\r\n      await db.outbox.add(entry);\r\n      \r\n      const count = await db.outbox.where('status').equals('PENDING').count();\r\n      setPendingCount(count);\r\n\r\n      // Attempt immediate sync if online\r\n      if (typeof window !== 'undefined' && navigator.onLine) {\r\n        // In a real app, you'd trigger the sync orchestrator here\r\n        console.log('Online: Triggering sync for', entry.id);\r\n      }\r\n\r\n      return entry;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [domain] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useSyncOrchestrator({ autoStart = true }: { autoStart?: boolean } = {}) {\r\n  const setPendingCount = useOutboxStore((state) => state.setPendingCount);\r\n  const setSyncing = useOutboxStore((state) => state.setSyncing);\r\n\r\n  const runSync = useCallback(async () => {\r\n    if (useOutboxStore.getState().isSyncing) {\r\n      return;\r\n    }\r\n\r\n    const pending = await db.outbox\r\n      .where('status')\r\n      .anyOf(['PENDING', 'FAILED'])\r\n      .toArray();\r\n\r\n    if (pending.length === 0) {\r\n      const count = await db.outbox.where('status').equals('PENDING').count();\r\n      setPendingCount(count);\r\n      return;\r\n    }\r\n\r\n    setSyncing(true);\r\n\r\n    try {\r\n      for (const item of pending) {\r\n        try {\r\n          await db.outbox.update(item.id, { status: 'SYNCING' });\r\n\r\n          // Implement exponential backoff check here logic\r\n          // await apiClient.processEvent(item);\r\n          await db.outbox.update(item.id, toCompletedUpdate());\r\n        } catch (error) {\r\n          await db.outbox.update(item.id, toFailedUpdate(item, error));\r\n        }\r\n      }\r\n\r\n      const count = await db.outbox.where('status').equals('PENDING').count();\r\n      setPendingCount(count);\r\n    } finally {\r\n      setSyncing(false);\r\n    }\r\n  }, [setPendingCount, setSyncing]);\r\n\r\n  useEffect(() => {\r\n    if (!autoStart) return;\r\n    if (typeof window === 'undefined') return;\r\n\r\n    window.addEventListener('online', runSync);\r\n    return () => window.removeEventListener('online', runSync);\r\n  }, [autoStart, runSync]);\r\n\r\n  return { runSync };\r\n}\r\n"],"names":["useOfflineAction","domain","action","queryClient","setPendingCount","state","mutationFn","payload","taskId","length","existing","outbox","where","anyOf","filter","entry","first","update","id","status","retryCount","lastError","undefined","createdAt","Date","count","equals","crypto","randomUUID","add","onSuccess","invalidateQueries","queryKey","useSyncOrchestrator","autoStart","setSyncing","runSync","getState","isSyncing","pending","toArray","item","error"],"mappings":"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"}},
    {"offset": {"line": 362, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/observability.ts"],"sourcesContent":["export type IntegrationName = 'upload' | 'email' | 'push';\r\n\r\ntype CaptureContext = {\r\n  tags?: Record<string, string>;\r\n  extra?: Record<string, unknown>;\r\n};\r\n\r\ntype GlobalSentryLike = {\r\n  captureException?: (error: unknown, context?: CaptureContext) => void;\r\n  captureMessage?: (message: string, context?: CaptureContext) => void;\r\n};\r\n\r\nfunction getSentryGlobal(): GlobalSentryLike | null {\r\n  if (typeof window === 'undefined') {\r\n    return null;\r\n  }\r\n  const candidate = (window as Window & { Sentry?: GlobalSentryLike }).Sentry;\r\n  return candidate ?? null;\r\n}\r\n\r\nexport function captureAppException(error: unknown, context?: CaptureContext) {\r\n  const sentry = getSentryGlobal();\r\n  sentry?.captureException?.(error, context);\r\n  console.error(error);\r\n}\r\n\r\nexport function captureAppMessage(message: string, context?: CaptureContext) {\r\n  const sentry = getSentryGlobal();\r\n  sentry?.captureMessage?.(message, context);\r\n  console.warn(message);\r\n}\r\n\r\nexport function reportIntegrationDegraded(integration: IntegrationName, reason: string) {\r\n  captureAppMessage(`Integration degraded: ${integration}`, {\r\n    tags: { integration },\r\n    extra: { reason },\r\n  });\r\n\r\n  if (typeof window !== 'undefined') {\r\n    window.dispatchEvent(new CustomEvent('farmops:integration-degraded', {\r\n      detail: { integration, reason },\r\n    }));\r\n  }\r\n}\r\n"],"names":["getSentryGlobal","candidate","captureAppException","error","context","sentry","captureException","console","captureAppMessage","message","captureMessage","warn","reportIntegrationDegraded","integration","reason","tags","extra"],"mappings":";;;;;;;;AAYA,SAASA;IACP,wCAAmC;QACjC,OAAO;IACT;;;IACA,MAAMC;AAER;AAEO,SAASC,oBAAoBC,KAAc,EAAEC,OAAwB;IAC1E,MAAMC,SAASL;IACfK,QAAQC,mBAAmBH,OAAOC;IAClCG,QAAQJ,KAAK,CAACA;AAChB;AAEO,SAASK,kBAAkBC,OAAe,EAAEL,OAAwB;IACzE,MAAMC,SAASL;IACfK,QAAQK,iBAAiBD,SAASL;IAClCG,QAAQI,IAAI,CAACF;AACf;AAEO,SAASG,0BAA0BC,WAA4B,EAAEC,MAAc;IACpFN,kBAAkB,CAAC,sBAAsB,EAAEK,aAAa,EAAE;QACxDE,MAAM;YAAEF;QAAY;QACpBG,OAAO;YAAEF;QAAO;IAClB;IAEA;;AAKF"}},
    {"offset": {"line": 404, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/app/providers.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\r\nimport { ReactNode, createContext, useContext, useEffect, useMemo, useState } from 'react';\r\nimport { useSyncOrchestrator } from '@/hooks/use-offline-sync';\r\nimport { captureAppException } from '@/lib/observability';\r\n\r\ntype Theme = 'light' | 'dark';\r\ntype ThemeMode = Theme;\r\n\r\ntype ThemeContextValue = {\r\n  theme: Theme;\r\n  mode: ThemeMode;\r\n  setThemeMode: (mode: ThemeMode) => void;\r\n  cycleThemeMode: () => void;\r\n};\r\n\r\nconst ThemeContext = createContext<ThemeContextValue | undefined>(undefined);\r\n\r\nfunction getInitialThemeMode(): ThemeMode {\r\n  if (typeof window === 'undefined') return 'light';\r\n\r\n  const stored = window.localStorage.getItem('theme');\r\n  if (stored === 'light' || stored === 'dark') return stored;\r\n\r\n  return 'light';\r\n}\r\n\r\nfunction applyTheme(theme: Theme) {\r\n  if (typeof document === 'undefined') return;\r\n  document.documentElement.classList.toggle('dark', theme === 'dark');\r\n  document.documentElement.style.colorScheme = theme;\r\n}\r\n\r\nexport function Providers({ children }: { children: ReactNode }) {\r\n  const [queryClient] = useState(() => new QueryClient({\r\n    defaultOptions: {\r\n      queries: {\r\n        staleTime: 1000 * 60 * 5, // 5 minutes\r\n      },\r\n    },\r\n  }));\r\n  const [mode, setMode] = useState<ThemeMode>('light');\r\n  const [theme, setTheme] = useState<Theme>('light');\r\n\r\n  useSyncOrchestrator();\r\n\r\n  useEffect(() => {\r\n    const initialMode = getInitialThemeMode();\r\n    setMode(initialMode);\r\n    setTheme(initialMode);\r\n    applyTheme(initialMode);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const handleError = (event: ErrorEvent) => {\r\n      captureAppException(event.error ?? new Error(event.message || 'Unhandled window error'), {\r\n        tags: { scope: 'window.error' },\r\n      });\r\n    };\r\n\r\n    const handleRejection = (event: PromiseRejectionEvent) => {\r\n      captureAppException(event.reason ?? new Error('Unhandled promise rejection'), {\r\n        tags: { scope: 'window.unhandledrejection' },\r\n      });\r\n    };\r\n\r\n    window.addEventListener('error', handleError);\r\n    window.addEventListener('unhandledrejection', handleRejection);\r\n\r\n    return () => {\r\n      window.removeEventListener('error', handleError);\r\n      window.removeEventListener('unhandledrejection', handleRejection);\r\n    };\r\n  }, []);\r\n\r\n  const setThemeMode = (nextMode: ThemeMode) => {\r\n    setMode(nextMode);\r\n    setTheme(nextMode);\r\n    if (typeof window !== 'undefined') {\r\n      window.localStorage.setItem('theme', nextMode);\r\n    }\r\n    applyTheme(nextMode);\r\n  };\r\n\r\n  const value = useMemo<ThemeContextValue>(() => ({\r\n    theme,\r\n    mode,\r\n    setThemeMode,\r\n    cycleThemeMode: () => {\r\n      const order: ThemeMode[] = ['light', 'dark'];\r\n      const next = order[(order.indexOf(mode) + 1) % order.length];\r\n      setThemeMode(next);\r\n    },\r\n  }), [theme, mode]);\r\n\r\n  return (\r\n    <ThemeContext.Provider value={value}>\r\n      <QueryClientProvider client={queryClient}>\r\n        {children}\r\n      </QueryClientProvider>\r\n    </ThemeContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useTheme() {\r\n  const context = useContext(ThemeContext);\r\n  if (!context) {\r\n    throw new Error('useTheme must be used within Providers');\r\n  }\r\n  return context;\r\n}\r\n"],"names":["ThemeContext","undefined","getInitialThemeMode","stored","applyTheme","theme","document","documentElement","classList","toggle","style","colorScheme","Providers","children","queryClient","defaultOptions","queries","staleTime","mode","setMode","setTheme","initialMode","handleError","event","error","Error","message","tags","scope","handleRejection","reason","window","addEventListener","removeEventListener","setThemeMode","nextMode","value","cycleThemeMode","order","next","indexOf","length","Provider","client","useTheme","context"],"mappings":";;;;;;;AAEA;AAAA;AACA;AACA;AACA;AALA;;;;;;AAiBA,MAAMA,6BAAe,IAAA,sNAAa,EAAgCC;AAElE,SAASC;IACP,wCAAmC,OAAO;;;IAE1C,MAAMC;AAIR;AAEA,SAASC,WAAWC,KAAY;IAC9B,IAAI,OAAOC,aAAa,aAAa;IACrCA,SAASC,eAAe,CAACC,SAAS,CAACC,MAAM,CAAC,QAAQJ,UAAU;IAC5DC,SAASC,eAAe,CAACG,KAAK,CAACC,WAAW,GAAGN;AAC/C;AAEO,SAASO,UAAU,EAAEC,QAAQ,EAA2B;IAC7D,MAAM,CAACC,YAAY,GAAG,IAAA,iNAAQ,EAAC,IAAM,IAAI,4LAAW,CAAC;YACnDC,gBAAgB;gBACdC,SAAS;oBACPC,WAAW,OAAO,KAAK;gBACzB;YACF;QACF;IACA,MAAM,CAACC,MAAMC,QAAQ,GAAG,IAAA,iNAAQ,EAAY;IAC5C,MAAM,CAACd,OAAOe,SAAS,GAAG,IAAA,iNAAQ,EAAQ;IAE1C,IAAA,6JAAmB;IAEnB,IAAA,kNAAS,EAAC;QACR,MAAMC,cAAcnB;QACpBiB,QAAQE;QACRD,SAASC;QACTjB,WAAWiB;IACb,GAAG,EAAE;IAEL,IAAA,kNAAS,EAAC;QACR,MAAMC,cAAc,CAACC;YACnB,IAAA,kJAAmB,EAACA,MAAMC,KAAK,IAAI,IAAIC,MAAMF,MAAMG,OAAO,IAAI,2BAA2B;gBACvFC,MAAM;oBAAEC,OAAO;gBAAe;YAChC;QACF;QAEA,MAAMC,kBAAkB,CAACN;YACvB,IAAA,kJAAmB,EAACA,MAAMO,MAAM,IAAI,IAAIL,MAAM,gCAAgC;gBAC5EE,MAAM;oBAAEC,OAAO;gBAA4B;YAC7C;QACF;QAEAG,OAAOC,gBAAgB,CAAC,SAASV;QACjCS,OAAOC,gBAAgB,CAAC,sBAAsBH;QAE9C,OAAO;YACLE,OAAOE,mBAAmB,CAAC,SAASX;YACpCS,OAAOE,mBAAmB,CAAC,sBAAsBJ;QACnD;IACF,GAAG,EAAE;IAEL,MAAMK,eAAe,CAACC;QACpBhB,QAAQgB;QACRf,SAASe;QACT;;QAGA/B,WAAW+B;IACb;IAEA,MAAMC,QAAQ,IAAA,gNAAO,EAAoB,IAAM,CAAC;YAC9C/B;YACAa;YACAgB;YACAG,gBAAgB;gBACd,MAAMC,QAAqB;oBAAC;oBAAS;iBAAO;gBAC5C,MAAMC,OAAOD,KAAK,CAAC,CAACA,MAAME,OAAO,CAACtB,QAAQ,CAAC,IAAIoB,MAAMG,MAAM,CAAC;gBAC5DP,aAAaK;YACf;QACF,CAAC,GAAG;QAAClC;QAAOa;KAAK;IAEjB,qBACE,8OAAClB,aAAa0C,QAAQ;QAACN,OAAOA;kBAC5B,cAAA,8OAAC,6MAAmB;YAACO,QAAQ7B;sBAC1BD;;;;;;;;;;;AAIT;AAEO,SAAS+B;IACd,MAAMC,UAAU,IAAA,mNAAU,EAAC7C;IAC3B,IAAI,CAAC6C,SAAS;QACZ,MAAM,IAAIpB,MAAM;IAClB;IACA,OAAOoB;AACT"}},
    {"offset": {"line": 523, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/components/layout/route-access.ts"],"sourcesContent":["export type RouteRule = { prefix: string; roles: string[] };\r\n\r\nexport const ROUTE_RULES: RouteRule[] = [\r\n  { prefix: '/tasks', roles: ['MANAGER', 'WORKER'] },\r\n  { prefix: '/finance', roles: ['OWNER', 'MANAGER'] },\r\n  { prefix: '/inventory', roles: ['OWNER', 'MANAGER'] },\r\n  { prefix: '/procurement', roles: ['OWNER', 'MANAGER'] },\r\n  { prefix: '/payroll', roles: ['OWNER', 'MANAGER'] },\r\n  { prefix: '/digest', roles: ['OWNER', 'MANAGER'] },\r\n  { prefix: '/monitoring', roles: ['OWNER', 'MANAGER'] },\r\n  { prefix: '/audits', roles: ['OWNER', 'MANAGER'] },\r\n  { prefix: '/vendor', roles: ['OWNER', 'MANAGER'] },\r\n  { prefix: '/updates/daily', roles: ['OWNER', 'MANAGER'] },\r\n  { prefix: '/updates', roles: ['OWNER', 'MANAGER', 'WORKER'] },\r\n  { prefix: '/incidents', roles: ['OWNER', 'MANAGER', 'WORKER'] },\r\n  { prefix: '/offline', roles: ['OWNER', 'MANAGER', 'WORKER'] },\r\n];\r\n\r\nexport function hasRouteAccess(pathname: string, role: string | null | undefined, rules: RouteRule[] = ROUTE_RULES) {\r\n  const matchedRule = rules.find((rule) => pathname.startsWith(rule.prefix));\r\n  return !matchedRule || matchedRule.roles.includes(role || '');\r\n}\r\n"],"names":["ROUTE_RULES","prefix","roles","hasRouteAccess","pathname","role","rules","matchedRule","find","rule","startsWith","includes"],"mappings":";;;;;;AAEO,MAAMA,cAA2B;IACtC;QAAEC,QAAQ;QAAUC,OAAO;YAAC;YAAW;SAAS;IAAC;IACjD;QAAED,QAAQ;QAAYC,OAAO;YAAC;YAAS;SAAU;IAAC;IAClD;QAAED,QAAQ;QAAcC,OAAO;YAAC;YAAS;SAAU;IAAC;IACpD;QAAED,QAAQ;QAAgBC,OAAO;YAAC;YAAS;SAAU;IAAC;IACtD;QAAED,QAAQ;QAAYC,OAAO;YAAC;YAAS;SAAU;IAAC;IAClD;QAAED,QAAQ;QAAWC,OAAO;YAAC;YAAS;SAAU;IAAC;IACjD;QAAED,QAAQ;QAAeC,OAAO;YAAC;YAAS;SAAU;IAAC;IACrD;QAAED,QAAQ;QAAWC,OAAO;YAAC;YAAS;SAAU;IAAC;IACjD;QAAED,QAAQ;QAAWC,OAAO;YAAC;YAAS;SAAU;IAAC;IACjD;QAAED,QAAQ;QAAkBC,OAAO;YAAC;YAAS;SAAU;IAAC;IACxD;QAAED,QAAQ;QAAYC,OAAO;YAAC;YAAS;YAAW;SAAS;IAAC;IAC5D;QAAED,QAAQ;QAAcC,OAAO;YAAC;YAAS;YAAW;SAAS;IAAC;IAC9D;QAAED,QAAQ;QAAYC,OAAO;YAAC;YAAS;YAAW;SAAS;IAAC;CAC7D;AAEM,SAASC,eAAeC,QAAgB,EAAEC,IAA+B,EAAEC,QAAqBN,WAAW;IAChH,MAAMO,cAAcD,MAAME,IAAI,CAAC,CAACC,OAASL,SAASM,UAAU,CAACD,KAAKR,MAAM;IACxE,OAAO,CAACM,eAAeA,YAAYL,KAAK,CAACS,QAAQ,CAACN,QAAQ;AAC5D"}},
    {"offset": {"line": 633, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/hooks/use-integration-status.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useQuery } from '@tanstack/react-query';\r\n\r\ntype IntegrationStatus = {\r\n  upload: boolean;\r\n  push: boolean;\r\n  email: boolean;\r\n};\r\n\r\ntype ApiEnvelope<T> = {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: { code: string; message: string };\r\n};\r\n\r\nasync function fetchIntegrationStatus() {\r\n  const response = await fetch('/api/integrations/status', {\r\n    method: 'GET',\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  const json = (await response.json()) as ApiEnvelope<IntegrationStatus>;\r\n  if (!json.success || !json.data) {\r\n    throw new Error(json.error?.message || 'Unable to load integration status');\r\n  }\r\n  return json.data;\r\n}\r\n\r\nexport function useIntegrationStatus() {\r\n  return useQuery({\r\n    queryKey: ['integration-status'],\r\n    queryFn: fetchIntegrationStatus,\r\n    staleTime: 1000 * 60,\r\n  });\r\n}\r\n"],"names":["fetchIntegrationStatus","response","fetch","method","headers","json","success","data","Error","error","message","useIntegrationStatus","queryKey","queryFn","staleTime"],"mappings":";;;;AAEA;AAFA;;AAgBA,eAAeA;IACb,MAAMC,WAAW,MAAMC,MAAM,4BAA4B;QACvDC,QAAQ;QACRC,SAAS;YAAE,gBAAgB;QAAmB;IAChD;IACA,MAAMC,OAAQ,MAAMJ,SAASI,IAAI;IACjC,IAAI,CAACA,KAAKC,OAAO,IAAI,CAACD,KAAKE,IAAI,EAAE;QAC/B,MAAM,IAAIC,MAAMH,KAAKI,KAAK,EAAEC,WAAW;IACzC;IACA,OAAOL,KAAKE,IAAI;AAClB;AAEO,SAASI;IACd,OAAO,IAAA,uLAAQ,EAAC;QACdC,UAAU;YAAC;SAAqB;QAChCC,SAASb;QACTc,WAAW,OAAO;IACpB;AACF"}},
    {"offset": {"line": 666, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/components/layout/navigation-shell.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useRef, useState } from 'react';\r\nimport { useAuth } from './auth-provider';\r\nimport Link from 'next/link';\r\nimport { usePathname, useRouter } from 'next/navigation';\r\nimport { cn } from '@/lib/utils';\r\nimport { useTheme } from '@/app/providers';\r\nimport { db } from '@/lib/db';\r\nimport { hasRouteAccess, ROUTE_RULES } from './route-access';\r\nimport { \r\n  HomeIcon, \r\n  CheckCircleIcon, \r\n  BanknotesIcon, \r\n  ClipboardDocumentCheckIcon,\r\n  SignalIcon,\r\n  ShoppingCartIcon,\r\n  CreditCardIcon,\r\n  CalendarDaysIcon,\r\n  ChartBarIcon,\r\n  BellAlertIcon,\r\n  BuildingStorefrontIcon\r\n} from '@heroicons/react/24/outline';\r\nimport { useOutboxStore } from '@/lib/store/outbox';\r\nimport { useIntegrationStatus } from '@/hooks/use-integration-status';\r\n\r\nexport function NavigationShell({ children }: { children: React.ReactNode }) {\r\n  const { role, setRole, isLoading, isAuthenticated, isRegistered, logout } = useAuth();\r\n  const { mode, setThemeMode } = useTheme();\r\n  const [controlsOpen, setControlsOpen] = useState(false);\r\n  const [quickAction, setQuickAction] = useState('');\r\n  const controlsMenuRef = useRef<HTMLDivElement | null>(null);\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const integrationStatus = useIntegrationStatus();\r\n  const pendingCount = useOutboxStore((state) => state.pendingCount);\r\n  const setPendingCount = useOutboxStore((state) => state.setPendingCount);\r\n  const isStandaloneRoute = pathname === '/register' || pathname === '/login';\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      await fetch('/api/auth/logout', { method: 'POST' });\r\n    } catch {\r\n    }\r\n\r\n    logout();\r\n    setControlsOpen(false);\r\n    router.replace('/login');\r\n  };\r\n\r\n  const handleQuickAction = async (action: string) => {\r\n    if (!action) return;\r\n\r\n    if (action === 'theme:light') {\r\n      setThemeMode('light');\r\n      setControlsOpen(false);\r\n      return;\r\n    }\r\n\r\n    if (action === 'theme:dark') {\r\n      setThemeMode('dark');\r\n      setControlsOpen(false);\r\n      return;\r\n    }\r\n\r\n    if (action === 'role:OWNER' || action === 'role:MANAGER' || action === 'role:WORKER') {\r\n      const nextRole = action.replace('role:', '') as 'OWNER' | 'MANAGER' | 'WORKER';\r\n      setRole(nextRole);\r\n      setControlsOpen(false);\r\n      return;\r\n    }\r\n\r\n    if (action === 'logout') {\r\n      await handleLogout();\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isLoading) return;\r\n\r\n    if (!isAuthenticated) {\r\n      if (isStandaloneRoute) {\r\n        return;\r\n      }\r\n\r\n      const target = isRegistered ? '/login' : '/register';\r\n      if (pathname !== target) {\r\n        router.replace(target);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (isAuthenticated && isStandaloneRoute) {\r\n      router.replace('/');\r\n    }\r\n  }, [isAuthenticated, isLoading, isRegistered, isStandaloneRoute, pathname, router]);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    const refreshPendingCount = async () => {\r\n      const count = await db.outbox.where('status').equals('PENDING').count();\r\n      if (!cancelled) {\r\n        setPendingCount(count);\r\n      }\r\n    };\r\n\r\n    void refreshPendingCount();\r\n    const interval = window.setInterval(() => {\r\n      void refreshPendingCount();\r\n    }, 3000);\r\n\r\n    return () => {\r\n      cancelled = true;\r\n      window.clearInterval(interval);\r\n    };\r\n  }, [setPendingCount]);\r\n\r\n  useEffect(() => {\r\n    if (!controlsOpen) return;\r\n\r\n    const handlePointerDown = (event: MouseEvent | TouchEvent) => {\r\n      const target = event.target as Node | null;\r\n      if (!target) return;\r\n      if (controlsMenuRef.current?.contains(target)) return;\r\n      setControlsOpen(false);\r\n    };\r\n\r\n    const handleKeyDown = (event: KeyboardEvent) => {\r\n      if (event.key === 'Escape') {\r\n        setControlsOpen(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handlePointerDown);\r\n    document.addEventListener('touchstart', handlePointerDown, { passive: true });\r\n    document.addEventListener('keydown', handleKeyDown);\r\n\r\n    return () => {\r\n      document.removeEventListener('mousedown', handlePointerDown);\r\n      document.removeEventListener('touchstart', handlePointerDown);\r\n      document.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n  }, [controlsOpen]);\r\n\r\n  const navItems = [\r\n    { name: 'Home', href: '/', icon: HomeIcon, roles: ['OWNER', 'MANAGER', 'WORKER'] },\r\n    { name: 'Tasks', href: '/tasks', icon: CheckCircleIcon, roles: ['MANAGER', 'WORKER'] },\r\n    { name: 'Finance', href: '/finance', icon: BanknotesIcon, roles: ['OWNER', 'MANAGER'] },\r\n    { name: 'Updates', href: '/updates', icon: CalendarDaysIcon, roles: ['OWNER', 'MANAGER', 'WORKER'] },\r\n    { name: 'Digest', href: '/digest', icon: ChartBarIcon, roles: ['OWNER', 'MANAGER'] },\r\n    { name: 'Procure', href: '/procurement', icon: ShoppingCartIcon, roles: ['OWNER', 'MANAGER'] },\r\n    { name: 'Payroll', href: '/payroll', icon: CreditCardIcon, roles: ['OWNER', 'MANAGER'] },\r\n    { name: 'Monitor', href: '/monitoring', icon: BellAlertIcon, roles: ['OWNER', 'MANAGER'] },\r\n    { name: 'Incident', href: '/incidents', icon: BellAlertIcon, roles: ['OWNER', 'MANAGER', 'WORKER'] },\r\n    { name: 'Vendor', href: '/vendor', icon: BuildingStorefrontIcon, roles: ['OWNER', 'MANAGER'] },\r\n    { name: 'Audits', href: '/audits', icon: ClipboardDocumentCheckIcon, roles: ['OWNER', 'MANAGER'] },\r\n    { name: 'Offline', href: '/offline', icon: SignalIcon, roles: ['OWNER', 'MANAGER', 'WORKER'], badge: pendingCount },\r\n  ];\r\n\r\n  const filteredNav = navItems.filter((item) => item.roles.includes(role!));\r\n\r\n  const hasRouteAccessForPath = hasRouteAccess(pathname, role, ROUTE_RULES);\r\n  const unavailableIntegrations = integrationStatus.data\r\n    ? (Object.entries(integrationStatus.data).filter(([, available]) => !available).map(([name]) => name))\r\n    : [];\r\n\r\n  if (isLoading) {\r\n    return <div className=\"min-h-screen bg-background text-foreground\" />;\r\n  }\r\n\r\n  if (!isAuthenticated && !isStandaloneRoute) {\r\n    return <div className=\"min-h-screen bg-background text-foreground\" />;\r\n  }\r\n\r\n  if (isStandaloneRoute) {\r\n    return <div className=\"min-h-screen bg-background text-foreground\">{children}</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen bg-background text-foreground\">\r\n      <aside className=\"hidden md:flex md:w-64 md:flex-col md:border-r md:bg-background/60 md:backdrop-blur-sm\">\r\n        <div className=\"p-4 border-b\">\r\n          <h1 className=\"text-lg font-bold\">FarmOps</h1>\r\n          <p className=\"text-xs text-muted-foreground uppercase\">{role} workspace</p>\r\n        </div>\r\n        <nav className=\"p-3 space-y-1 overflow-y-auto\">\r\n          {filteredNav.map((item) => (\r\n            <Link\r\n              key={item.name}\r\n              href={item.href}\r\n              className={cn(\r\n                'flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium transition-colors',\r\n                pathname === item.href ? 'bg-accent text-foreground' : 'text-muted-foreground hover:bg-accent/60'\r\n              )}\r\n            >\r\n              <div className=\"relative\">\r\n                <item.icon className=\"h-5 w-5\" />\r\n                {item.badge && item.badge > 0 && (\r\n                  <span className=\"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-destructive text-[10px] text-destructive-foreground\">\r\n                    {item.badge}\r\n                  </span>\r\n                )}\r\n              </div>\r\n              <span>{item.name}</span>\r\n            </Link>\r\n          ))}\r\n        </nav>\r\n      </aside>\r\n\r\n      <div className=\"flex-1 flex flex-col min-w-0\">\r\n      <div ref={controlsMenuRef} className=\"fixed top-3 right-3 z-50\">\r\n        <button\r\n          onClick={() => setControlsOpen((current) => !current)}\r\n          className=\"h-10 rounded-full border bg-background/90 backdrop-blur px-3 text-[10px] font-semibold uppercase\"\r\n          aria-expanded={controlsOpen}\r\n        >\r\n          â˜° Controls\r\n        </button>\r\n\r\n      {controlsOpen ? (\r\n        <div className=\"mt-1 w-[min(92vw,320px)] rounded-xl border bg-background/95 backdrop-blur p-3 space-y-3\">\r\n          <div className=\"space-y-1\">\r\n            <p className=\"text-[10px] uppercase text-muted-foreground font-semibold\">Select Control</p>\r\n            <select\r\n              value={quickAction}\r\n              onChange={(event) => {\r\n                const nextAction = event.target.value;\r\n                setQuickAction('');\r\n                void handleQuickAction(nextAction);\r\n              }}\r\n              className=\"w-full h-10 rounded-md bg-accent/40 px-3 text-sm\"\r\n            >\r\n              <option value=\"\">Choose action...</option>\r\n              <option value=\"theme:light\">Light</option>\r\n              <option value=\"theme:dark\">Dark</option>\r\n              <option value=\"role:OWNER\">Owner</option>\r\n              <option value=\"role:MANAGER\">Manager</option>\r\n              <option value=\"role:WORKER\">Worker</option>\r\n              <option value=\"logout\">Logout</option>\r\n            </select>\r\n            <p className=\"text-[10px] text-muted-foreground\">\r\n              Current: theme {mode}, role {role}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n      </div>\r\n      <main className=\"flex-1 pt-16 md:pt-0 pb-20 md:pb-8\">\r\n        {unavailableIntegrations.length > 0 ? (\r\n          <div className=\"mx-auto w-full max-w-6xl px-4 pt-4 md:px-6\">\r\n            <div className=\"rounded-md border border-destructive/30 bg-destructive/5 p-3 text-xs text-destructive\">\r\n              Limited integrations: {unavailableIntegrations.join(', ')}. Related controls are disabled until service is restored.\r\n            </div>\r\n          </div>\r\n        ) : null}\r\n        {hasRouteAccessForPath ? (\r\n          children\r\n        ) : (\r\n          <div className=\"p-8 max-w-3xl mx-auto w-full space-y-3\">\r\n            <h1 className=\"text-xl font-bold\">Access Restricted</h1>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              Current role does not have access to this module. Switch role from the selector in the top-right to preview authorized surfaces.\r\n            </p>\r\n          </div>\r\n        )}\r\n      </main>\r\n      \r\n      {/* Mobile Bottom Navigation */}\r\n      <nav className=\"fixed bottom-0 left-0 right-0 border-t bg-background/80 backdrop-blur-md px-2 py-2 md:hidden\">\r\n        <div className=\"pointer-events-none absolute inset-y-0 left-0 w-6 bg-gradient-to-r from-background/95 to-transparent\" />\r\n        <div className=\"pointer-events-none absolute inset-y-0 right-0 w-6 bg-gradient-to-l from-background/95 to-transparent\" />\r\n        <ul className=\"flex items-center gap-1 overflow-x-auto whitespace-nowrap no-scrollbar px-1\">\r\n          {filteredNav.map((item) => (\r\n            <li key={item.name} className=\"shrink-0\">\r\n              <Link\r\n                href={item.href}\r\n                className={cn(\r\n                  \"flex flex-col items-center gap-1 p-2 min-w-16 text-xs font-medium transition-colors\",\r\n                  pathname === item.href ? \"text-primary\" : \"text-muted-foreground\"\r\n                )}\r\n              >\r\n                <div className=\"relative\">\r\n                  <item.icon className=\"h-6 w-6\" />\r\n                  {item.badge && item.badge > 0 && (\r\n                    <span className=\"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-destructive text-[10px] text-destructive-foreground\">\r\n                      {item.badge}\r\n                    </span>\r\n                  )}\r\n                </div>\r\n                {item.name}\r\n              </Link>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      </nav>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["NavigationShell","children","role","setRole","isLoading","isAuthenticated","isRegistered","logout","mode","setThemeMode","controlsOpen","setControlsOpen","quickAction","setQuickAction","controlsMenuRef","router","pathname","integrationStatus","pendingCount","state","setPendingCount","isStandaloneRoute","handleLogout","fetch","method","replace","handleQuickAction","action","nextRole","target","cancelled","refreshPendingCount","count","outbox","where","equals","interval","window","setInterval","clearInterval","handlePointerDown","event","current","contains","handleKeyDown","key","document","addEventListener","passive","removeEventListener","navItems","name","href","icon","roles","badge","filteredNav","filter","item","includes","hasRouteAccessForPath","unavailableIntegrations","data","Object","entries","available","map","className","ref","onClick","value","onChange","nextAction","length","join"],"mappings":"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"}}]
}