{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/db/index.ts"],"sourcesContent":["import Dexie, { type Table } from 'dexie';\r\n\r\nexport interface OutboxEntry {\r\n  id: string;\r\n  domain: string;\r\n  action: string;\r\n  payload: any;\r\n  status: 'PENDING' | 'SYNCING' | 'FAILED' | 'COMPLETED';\r\n  retryCount: number;\r\n  lastError?: string;\r\n  createdAt: Date;\r\n  nextAttemptAt?: Date;\r\n}\r\n\r\nexport interface LocalTask {\r\n  id: string;\r\n  farmId: string;\r\n  title: string;\r\n  status: 'TODO' | 'IN_PROGRESS' | 'COMPLETED' | 'VERIFIED';\r\n  dueDate: Date;\r\n  assignedTo?: string;\r\n  data: any;\r\n}\r\n\r\nexport class FarmDB extends Dexie {\r\n  outbox!: Table<OutboxEntry>;\r\n  local_tasks!: Table<LocalTask>;\r\n  local_media!: Table<{ id: string; blob: Blob; metadata: any; synced: boolean }>;\r\n  sync_meta!: Table<{ key: string; value: any }>;\r\n\r\n  constructor() {\r\n    super('FarmOpsDB');\r\n    this.version(1).stores({\r\n      outbox: 'id, domain, status, createdAt',\r\n      local_tasks: 'id, farmId, status, dueDate',\r\n      local_media: 'id, synced',\r\n      sync_meta: 'key'\r\n    });\r\n  }\r\n}\r\n\r\nexport const db = new FarmDB();\r\n"],"names":["FarmDB","outbox","local_tasks","local_media","sync_meta","version","stores","db"],"mappings":";;;;;;AAAA;;AAwBO,MAAMA,eAAe,yJAAK;IAC/BC,OAA4B;IAC5BC,YAA+B;IAC/BC,YAAgF;IAChFC,UAA+C;IAE/CJ,aAAc;QACZ,KAAK,CAAC;QACN,IAAI,CAACK,OAAO,CAAC,GAAGC,MAAM,CAAC;YACrBL,QAAQ;YACRC,aAAa;YACbC,aAAa;YACbC,WAAW;QACb;IACF;AACF;AAEO,MAAMG,KAAK,IAAIP"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/hooks/use-offline-sync.ts"],"sourcesContent":["import { useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { db, OutboxEntry } from '@/lib/db';\r\nimport { useOutboxStore } from '@/lib/store/outbox';\r\nimport { useCallback, useEffect } from 'react';\r\n\r\nexport function useOfflineAction<T>(domain: string, action: string) {\r\n  const queryClient = useQueryClient();\r\n  const setPendingCount = useOutboxStore((state) => state.setPendingCount);\r\n\r\n  return useMutation({\r\n    mutationFn: async (payload: T) => {\r\n      const entry: OutboxEntry = {\r\n        id: crypto.randomUUID(),\r\n        domain,\r\n        action,\r\n        payload,\r\n        status: 'PENDING',\r\n        retryCount: 0,\r\n        createdAt: new Date(),\r\n      };\r\n\r\n      await db.outbox.add(entry);\r\n      \r\n      const count = await db.outbox.where('status').equals('PENDING').count();\r\n      setPendingCount(count);\r\n\r\n      // Attempt immediate sync if online\r\n      if (typeof window !== 'undefined' && navigator.onLine) {\r\n        // In a real app, you'd trigger the sync orchestrator here\r\n        console.log('Online: Triggering sync for', entry.id);\r\n      }\r\n\r\n      return entry;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [domain] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useSyncOrchestrator() {\r\n  const setPendingCount = useOutboxStore((state) => state.setPendingCount);\r\n  const setSyncing = useOutboxStore((state) => state.setSyncing);\r\n\r\n  const runSync = useCallback(async () => {\r\n    const pending = await db.outbox\r\n      .where('status')\r\n      .anyOf(['PENDING', 'FAILED'])\r\n      .toArray();\r\n\r\n    if (pending.length === 0) return;\r\n\r\n    setSyncing(true);\r\n    \r\n    for (const item of pending) {\r\n      try {\r\n        // Implement exponential backoff check here logic\r\n        // await apiClient.processEvent(item);\r\n        await db.outbox.update(item.id, { status: 'COMPLETED' });\r\n      } catch (error) {\r\n        await db.outbox.update(item.id, { \r\n          status: 'FAILED', \r\n          retryCount: item.retryCount + 1,\r\n          lastError: error instanceof Error ? error.message : 'Unknown error'\r\n        });\r\n      }\r\n    }\r\n\r\n    const count = await db.outbox.where('status').equals('PENDING').count();\r\n    setPendingCount(count);\r\n    setSyncing(false);\r\n  }, [setPendingCount, setSyncing]);\r\n\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    window.addEventListener('online', runSync);\r\n    return () => window.removeEventListener('online', runSync);\r\n  }, [runSync]);\r\n\r\n  return { runSync };\r\n}\r\n"],"names":["useOfflineAction","domain","action","queryClient","setPendingCount","state","mutationFn","payload","entry","id","crypto","randomUUID","status","retryCount","createdAt","Date","outbox","add","count","where","equals","navigator","onLine","console","log","onSuccess","invalidateQueries","queryKey","useSyncOrchestrator","setSyncing","runSync","pending","anyOf","toArray","length","item","update","error","lastError","Error","message","window","addEventListener","removeEventListener"],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;AACA;;;;;;AAEO,SAASA,iBAAoBC,MAAc,EAAEC,MAAc;;IAChE,MAAMC,cAAc,IAAA,2MAAc;IAClC,MAAMC,kBAAkB,IAAA,kJAAc;4DAAC,CAACC,QAAUA,MAAMD,eAAe;;IAEvE,OAAO,IAAA,gMAAW,EAAC;QACjBE,UAAU;4CAAE,OAAOC;gBACjB,MAAMC,QAAqB;oBACzBC,IAAIC,OAAOC,UAAU;oBACrBV;oBACAC;oBACAK;oBACAK,QAAQ;oBACRC,YAAY;oBACZC,WAAW,IAAIC;gBACjB;gBAEA,MAAM,kIAAE,CAACC,MAAM,CAACC,GAAG,CAACT;gBAEpB,MAAMU,QAAQ,MAAM,kIAAE,CAACF,MAAM,CAACG,KAAK,CAAC,UAAUC,MAAM,CAAC,WAAWF,KAAK;gBACrEd,gBAAgBc;gBAEhB,mCAAmC;gBACnC,IAAI,+CAAkB,eAAeG,UAAUC,MAAM,EAAE;oBACrD,0DAA0D;oBAC1DC,QAAQC,GAAG,CAAC,+BAA+BhB,MAAMC,EAAE;gBACrD;gBAEA,OAAOD;YACT;;QACAiB,SAAS;4CAAE;gBACTtB,YAAYuB,iBAAiB,CAAC;oBAAEC,UAAU;wBAAC1B;qBAAO;gBAAC;YACrD;;IACF;AACF;GAjCgBD;;QACM,2MAAc;QACV,kJAAc;QAE/B,gMAAW;;;AA+Bb,SAAS4B;;IACd,MAAMxB,kBAAkB,IAAA,kJAAc;+DAAC,CAACC,QAAUA,MAAMD,eAAe;;IACvE,MAAMyB,aAAa,IAAA,kJAAc;0DAAC,CAACxB,QAAUA,MAAMwB,UAAU;;IAE7D,MAAMC,UAAU,IAAA,4KAAW;oDAAC;YAC1B,MAAMC,UAAU,MAAM,kIAAE,CAACf,MAAM,CAC5BG,KAAK,CAAC,UACNa,KAAK,CAAC;gBAAC;gBAAW;aAAS,EAC3BC,OAAO;YAEV,IAAIF,QAAQG,MAAM,KAAK,GAAG;YAE1BL,WAAW;YAEX,KAAK,MAAMM,QAAQJ,QAAS;gBAC1B,IAAI;oBACF,iDAAiD;oBACjD,sCAAsC;oBACtC,MAAM,kIAAE,CAACf,MAAM,CAACoB,MAAM,CAACD,KAAK1B,EAAE,EAAE;wBAAEG,QAAQ;oBAAY;gBACxD,EAAE,OAAOyB,OAAO;oBACd,MAAM,kIAAE,CAACrB,MAAM,CAACoB,MAAM,CAACD,KAAK1B,EAAE,EAAE;wBAC9BG,QAAQ;wBACRC,YAAYsB,KAAKtB,UAAU,GAAG;wBAC9ByB,WAAWD,iBAAiBE,QAAQF,MAAMG,OAAO,GAAG;oBACtD;gBACF;YACF;YAEA,MAAMtB,QAAQ,MAAM,kIAAE,CAACF,MAAM,CAACG,KAAK,CAAC,UAAUC,MAAM,CAAC,WAAWF,KAAK;YACrEd,gBAAgBc;YAChBW,WAAW;QACb;mDAAG;QAACzB;QAAiByB;KAAW;IAEhC,IAAA,0KAAS;yCAAC;YACR;;YAEAY,OAAOC,gBAAgB,CAAC,UAAUZ;YAClC;iDAAO,IAAMW,OAAOE,mBAAmB,CAAC,UAAUb;;QACpD;wCAAG;QAACA;KAAQ;IAEZ,OAAO;QAAEA;IAAQ;AACnB;IAzCgBF;;QACU,kJAAc;QACnB,kJAAc"}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/app/%28dashboard%29/offline/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { db } from '@/lib/db';\r\nimport { useSyncOrchestrator } from '@/hooks/use-offline-sync';\r\nimport { useOutboxStore } from '@/lib/store/outbox';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { formatDate } from '@/lib/utils';\r\nimport { ArrowsPointingInIcon, CloudArrowUpIcon, ExclamationTriangleIcon } from '@heroicons/react/24/outline';\r\nimport { useEffect, useState } from 'react';\r\n\r\nexport default function OfflineCenter() {\r\n  const { runSync } = useSyncOrchestrator();\r\n  const { isSyncing } = useOutboxStore();\r\n  const [isOnline, setIsOnline] = useState(false);\r\n\r\n  const { data: outbox } = useQuery({\r\n    queryKey: ['outbox'],\r\n    queryFn: () => db.outbox.orderBy('createdAt').reverse().toArray(),\r\n    refetchInterval: 5000,\r\n  });\r\n\r\n  const pendingCount = outbox?.filter((item) => item.status === 'PENDING').length ?? 0;\r\n  const failedCount = outbox?.filter((item) => item.status === 'FAILED').length ?? 0;\r\n\r\n  useEffect(() => {\r\n    const updateStatus = () => setIsOnline(navigator.onLine);\r\n    updateStatus();\r\n\r\n    window.addEventListener('online', updateStatus);\r\n    window.addEventListener('offline', updateStatus);\r\n\r\n    return () => {\r\n      window.removeEventListener('online', updateStatus);\r\n      window.removeEventListener('offline', updateStatus);\r\n    };\r\n  }, []);\r\n\r\n  const retryItem = async (id: string) => {\r\n    await db.outbox.update(id, {\r\n      status: 'PENDING',\r\n      retryCount: 0,\r\n      lastError: undefined,\r\n      nextAttemptAt: new Date(),\r\n    });\r\n    await runSync();\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-6 max-w-6xl mx-auto w-full space-y-6 pb-24 md:pb-8\">\r\n      <header className=\"flex justify-between items-center\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold\">Offline Sync</h1>\r\n          <p className=\"text-xs text-muted-foreground\">Manage pending actions</p>\r\n        </div>\r\n        <button\r\n          onClick={() => runSync()}\r\n          disabled={isSyncing}\r\n          className=\"bg-primary text-primary-foreground h-10 w-10 flex items-center justify-center rounded-full shadow-lg active:scale-95 disabled:opacity-50\"\r\n          title=\"Sync now\"\r\n        >\r\n          <CloudArrowUpIcon className={`h-6 w-6 ${isSyncing ? 'animate-bounce' : ''}`} />\r\n        </button>\r\n      </header>\r\n\r\n      <button\r\n        onClick={() => runSync()}\r\n        disabled={isSyncing}\r\n        className=\"w-full h-10 rounded-md bg-secondary text-secondary-foreground text-sm font-semibold disabled:opacity-50\"\r\n      >\r\n        {isSyncing ? 'Syncing...' : 'Sync now'}\r\n      </button>\r\n\r\n      <div className=\"grid grid-cols-2 gap-2\">\r\n        <div className=\"rounded-lg border bg-card p-3\">\r\n          <p className=\"text-[10px] uppercase font-bold text-muted-foreground\">Pending Outbox</p>\r\n          <p className=\"text-xl font-bold\">{pendingCount}</p>\r\n        </div>\r\n        <div className=\"rounded-lg border bg-card p-3\">\r\n          <p className=\"text-[10px] uppercase font-bold text-muted-foreground\">Failed Items</p>\r\n          <p className=\"text-xl font-bold text-destructive\">{failedCount}</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        {outbox?.length === 0 && (\r\n          <div className=\"flex flex-col items-center justify-center py-20 border-2 border-dashed rounded-xl border-accent\">\r\n            <ArrowsPointingInIcon className=\"h-10 w-10 text-muted-foreground/30\" />\r\n            <p className=\"text-sm font-medium mt-2\">All data synced</p>\r\n          </div>\r\n        )}\r\n\r\n        {outbox?.map((item) => (\r\n          <div key={item.id} className=\"p-3 border rounded-lg flex items-center gap-3 bg-card shadow-sm\">\r\n            <div className={`h-2 w-2 rounded-full ${item.status === 'FAILED' ? 'bg-destructive' : 'bg-amber-500 animate-pulse'}`} />\r\n            <div className=\"flex-1\">\r\n              <div className=\"flex justify-between\">\r\n                <p className=\"text-xs font-bold uppercase tracking-wider\">{item.action.replace('_', ' ')}</p>\r\n                <time className=\"text-[10px] text-muted-foreground\">{formatDate(item.createdAt)}</time>\r\n              </div>\r\n              <p className=\"text-[10px] font-mono opacity-50 truncate max-w-[200px]\">{item.id}</p>\r\n              {item.status === 'FAILED' && (\r\n                <div className=\"mt-1 space-y-1\">\r\n                  <div className=\"flex items-center gap-1 text-destructive font-medium text-[10px]\">\r\n                    <ExclamationTriangleIcon className=\"h-3 w-3\" />\r\n                    {item.lastError || 'Partial sync failure - check connectivity'}\r\n                  </div>\r\n                  <button\r\n                    onClick={() => void retryItem(item.id)}\r\n                    className=\"h-6 px-2 rounded bg-secondary text-secondary-foreground text-[10px] font-semibold\"\r\n                  >\r\n                    Retry\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <div className=\"bg-accent/30 p-4 rounded-lg\">\r\n        <h3 className=\"text-xs font-bold uppercase mb-2\">Technical Status</h3>\r\n        <dl className=\"grid grid-cols-2 gap-2 text-[10px]\">\r\n          <div>\r\n            <dt className=\"text-muted-foreground\">Network</dt>\r\n            <dd className=\"font-bold flex items-center gap-1\">\r\n              <span className={`h-1.5 w-1.5 rounded-full ${isOnline ? 'bg-green-500' : 'bg-destructive'}`} />\r\n              {isOnline ? 'ONLINE' : 'OFFLINE'}\r\n            </dd>\r\n          </div>\r\n          <div>\r\n            <dt className=\"text-muted-foreground\">Queue Size</dt>\r\n            <dd className=\"font-bold\">{outbox?.length || 0} items</dd>\r\n          </div>\r\n          <div>\r\n            <dt className=\"text-muted-foreground\">Pending</dt>\r\n            <dd className=\"font-bold\">{pendingCount}</dd>\r\n          </div>\r\n          <div>\r\n            <dt className=\"text-muted-foreground\">Failed</dt>\r\n            <dd className=\"font-bold text-destructive\">{failedCount}</dd>\r\n          </div>\r\n        </dl>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["OfflineCenter","runSync","isSyncing","isOnline","setIsOnline","data","outbox","queryKey","queryFn","orderBy","reverse","toArray","refetchInterval","pendingCount","filter","item","status","length","failedCount","updateStatus","navigator","onLine","window","addEventListener","removeEventListener","retryItem","id","update","retryCount","lastError","undefined","nextAttemptAt","Date","className","onClick","disabled","title","map","action","replace","createdAt"],"mappings":"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"}}]
}