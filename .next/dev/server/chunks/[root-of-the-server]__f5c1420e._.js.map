{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/errors.ts"],"sourcesContent":["export class AppError extends Error {\r\n  public code: string;\r\n  public status: number;\r\n  public details?: any;\r\n\r\n  constructor(code: string, message: string, status: number = 400, details?: any) {\r\n    super(message);\r\n    this.name = 'AppError';\r\n    this.code = code;\r\n    this.status = status;\r\n    this.details = details;\r\n  }\r\n}\r\n\r\nexport function createErrorResponse(error: any) {\r\n  if (error instanceof AppError || (error?.name === 'AppError' && error?.code && error?.message)) {\r\n    return Response.json(\r\n      { success: false, error: { code: error.code, message: error.message, details: error.details } },\r\n      { status: error.status || 400 }\r\n    );\r\n  }\r\n\r\n  if (error?.name === 'ZodError') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'VALIDATION_ERROR',\r\n          message: 'Invalid request payload',\r\n          details: error.issues ?? error.errors,\r\n        },\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  if (error?.code === 'P2002') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'CONFLICT',\r\n          message: 'A record with the same unique value already exists',\r\n          details: error.meta,\r\n        },\r\n      },\r\n      { status: 409 }\r\n    );\r\n  }\r\n\r\n  if (error?.code === 'P2003') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: 'RELATION_ERROR',\r\n          message: 'Related record is missing or invalid',\r\n          details: error.meta,\r\n        },\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  console.error('[Unhandled Error]:', error);\r\n\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          code: error?.code || 'INTERNAL_ERROR',\r\n          message: error?.message || 'Unknown server error',\r\n          details: error?.stack || error,\r\n        },\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n\r\n  return Response.json(\r\n    { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\r\n    { status: 500 }\r\n  );\r\n}\r\n"],"names":["AppError","Error","code","status","details","message","name","createErrorResponse","error","Response","json","success","issues","errors","meta","console","stack"],"mappings":";;;;;;AAAO,MAAMA,iBAAiBC;IACrBC,KAAa;IACbC,OAAe;IACfC,QAAc;IAErBJ,YAAYE,IAAY,EAAEG,OAAe,EAAEF,SAAiB,GAAG,EAAEC,OAAa,CAAE;QAC9E,KAAK,CAACC;QACN,IAAI,CAACC,IAAI,GAAG;QACZ,IAAI,CAACJ,IAAI,GAAGA;QACZ,IAAI,CAACC,MAAM,GAAGA;QACd,IAAI,CAACC,OAAO,GAAGA;IACjB;AACF;AAEO,SAASG,oBAAoBC,KAAU;IAC5C,IAAIA,iBAAiBR,YAAaQ,OAAOF,SAAS,cAAcE,OAAON,QAAQM,OAAOH,SAAU;QAC9F,OAAOI,SAASC,IAAI,CAClB;YAAEC,SAAS;YAAOH,OAAO;gBAAEN,MAAMM,MAAMN,IAAI;gBAAEG,SAASG,MAAMH,OAAO;gBAAED,SAASI,MAAMJ,OAAO;YAAC;QAAE,GAC9F;YAAED,QAAQK,MAAML,MAAM,IAAI;QAAI;IAElC;IAEA,IAAIK,OAAOF,SAAS,YAAY;QAC9B,OAAOG,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMI,MAAM,IAAIJ,MAAMK,MAAM;YACvC;QACF,GACA;YAAEV,QAAQ;QAAI;IAElB;IAEA,IAAIK,OAAON,SAAS,SAAS;QAC3B,OAAOO,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMM,IAAI;YACrB;QACF,GACA;YAAEX,QAAQ;QAAI;IAElB;IAEA,IAAIK,OAAON,SAAS,SAAS;QAC3B,OAAOO,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAM;gBACNG,SAAS;gBACTD,SAASI,MAAMM,IAAI;YACrB;QACF,GACA;YAAEX,QAAQ;QAAI;IAElB;IAEAY,QAAQP,KAAK,CAAC,sBAAsBA;IAEpC,wCAA2C;QACzC,OAAOC,SAASC,IAAI,CAClB;YACEC,SAAS;YACTH,OAAO;gBACLN,MAAMM,OAAON,QAAQ;gBACrBG,SAASG,OAAOH,WAAW;gBAC3BD,SAASI,OAAOQ,SAASR;YAC3B;QACF,GACA;YAAEL,QAAQ;QAAI;IAElB;;;AAMF"}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/lib/dev-invite-store.ts"],"sourcesContent":["type InviteRole = 'MANAGER' | 'WORKER';\r\ntype InviteStatus = 'PENDING' | 'ACCEPTED' | 'EXPIRED';\r\n\r\ntype DevInvite = {\r\n  id: string;\r\n  token: string;\r\n  farmId: string;\r\n  email: string;\r\n  role: InviteRole;\r\n  status: InviteStatus;\r\n  inviteUrl: string;\r\n  expiresAt: string;\r\n  createdAt: string;\r\n};\r\n\r\ntype DevUser = {\r\n  id: string;\r\n  email: string;\r\n  name?: string;\r\n  password: string;\r\n};\r\n\r\ntype DevMembership = {\r\n  farmId: string;\r\n  userId: string;\r\n  role: InviteRole;\r\n};\r\n\r\ntype DevSession = {\r\n  token: string;\r\n  userId: string;\r\n  expiresAt: string;\r\n};\r\n\r\ntype DevStore = {\r\n  invites: DevInvite[];\r\n  users: DevUser[];\r\n  memberships: DevMembership[];\r\n  sessions: DevSession[];\r\n};\r\n\r\nconst globalStore = globalThis as unknown as { __farmOpsDevInviteStore?: DevStore };\r\n\r\nconst store: DevStore = globalStore.__farmOpsDevInviteStore ?? {\r\n  invites: [],\r\n  users: [],\r\n  memberships: [],\r\n  sessions: [],\r\n};\r\n\r\nglobalStore.__farmOpsDevInviteStore = store;\r\n\r\nexport function listInvitesByFarm(farmId: string) {\r\n  return store.invites\r\n    .filter((invite) => invite.farmId === farmId)\r\n    .sort((a, b) => (a.createdAt < b.createdAt ? 1 : -1));\r\n}\r\n\r\nexport function createInvite(input: {\r\n  farmId: string;\r\n  email: string;\r\n  role: InviteRole;\r\n  origin: string;\r\n}) {\r\n  const token = crypto.randomUUID();\r\n  const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString();\r\n  const invite: DevInvite = {\r\n    id: crypto.randomUUID(),\r\n    token,\r\n    farmId: input.farmId,\r\n    email: input.email.toLowerCase(),\r\n    role: input.role,\r\n    status: 'PENDING',\r\n    inviteUrl: `${input.origin}/auth/invite/${token}`,\r\n    expiresAt,\r\n    createdAt: new Date().toISOString(),\r\n  };\r\n\r\n  store.invites.push(invite);\r\n  return invite;\r\n}\r\n\r\nexport function getInviteByToken(token: string) {\r\n  const invite = store.invites.find((entry) => entry.token === token);\r\n  if (!invite) return null;\r\n\r\n  if (invite.status === 'PENDING' && new Date(invite.expiresAt).getTime() < Date.now()) {\r\n    invite.status = 'EXPIRED';\r\n  }\r\n\r\n  return invite;\r\n}\r\n\r\nexport function acceptInvite(input: {\r\n  token: string;\r\n  mode: 'LOGIN' | 'SIGNUP';\r\n  email: string;\r\n  password: string;\r\n  name?: string;\r\n}) {\r\n  const invite = getInviteByToken(input.token);\r\n  if (!invite) {\r\n    return { ok: false as const, code: 'INVITE_NOT_FOUND', message: 'Invite link is invalid' };\r\n  }\r\n\r\n  if (invite.status !== 'PENDING') {\r\n    return { ok: false as const, code: 'INVITE_NOT_ACTIVE', message: 'Invite is not active' };\r\n  }\r\n\r\n  if (invite.email !== input.email.toLowerCase()) {\r\n    return { ok: false as const, code: 'INVITE_EMAIL_MISMATCH', message: 'Use the invited email address' };\r\n  }\r\n\r\n  let user = store.users.find((entry) => entry.email === input.email.toLowerCase());\r\n\r\n  if (input.mode === 'SIGNUP') {\r\n    if (user) {\r\n      return { ok: false as const, code: 'EMAIL_EXISTS', message: 'Account already exists, login instead' };\r\n    }\r\n\r\n    user = {\r\n      id: crypto.randomUUID(),\r\n      email: input.email.toLowerCase(),\r\n      name: input.name,\r\n      password: input.password,\r\n    };\r\n    store.users.push(user);\r\n  } else {\r\n    if (!user || user.password !== input.password) {\r\n      return { ok: false as const, code: 'INVALID_CREDENTIALS', message: 'Invalid email or password' };\r\n    }\r\n  }\r\n\r\n  const membershipExists = store.memberships.some(\r\n    (entry) => entry.farmId === invite.farmId && entry.userId === user.id\r\n  );\r\n\r\n  if (!membershipExists) {\r\n    store.memberships.push({\r\n      farmId: invite.farmId,\r\n      userId: user.id,\r\n      role: invite.role,\r\n    });\r\n  }\r\n\r\n  invite.status = 'ACCEPTED';\r\n\r\n  const sessionToken = crypto.randomUUID();\r\n  const sessionExpires = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString();\r\n  store.sessions.push({ token: sessionToken, userId: user.id, expiresAt: sessionExpires });\r\n\r\n  return {\r\n    ok: true as const,\r\n    user,\r\n    invite,\r\n    sessionToken,\r\n    sessionExpires,\r\n  };\r\n}\r\n"],"names":["globalStore","globalThis","store","__farmOpsDevInviteStore","invites","users","memberships","sessions","listInvitesByFarm","farmId","filter","invite","sort","a","b","createdAt","createInvite","input","token","crypto","randomUUID","expiresAt","Date","now","toISOString","id","email","toLowerCase","role","status","inviteUrl","origin","push","getInviteByToken","find","entry","getTime","acceptInvite","ok","code","message","user","mode","name","password","membershipExists","some","userId","sessionToken","sessionExpires"],"mappings":"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"}},
    {"offset": {"line": 249, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/farm_hands/src/app/api/auth/invites/%5Btoken%5D/route.ts"],"sourcesContent":["import { createErrorResponse, AppError } from '@/lib/errors';\r\nimport { getInviteByToken } from '@/lib/dev-invite-store';\r\n\r\nexport async function GET(\r\n  _request: Request,\r\n  context: { params: Promise<{ token: string }> }\r\n) {\r\n  try {\r\n    const { token } = await context.params;\r\n\r\n    const invite = getInviteByToken(token);\r\n    if (!invite) {\r\n      throw new AppError('INVITE_NOT_FOUND', 'Invite link is invalid', 404);\r\n    }\r\n\r\n    return Response.json({\r\n      success: true,\r\n      data: {\r\n        token,\r\n        farmId: invite.farmId,\r\n        email: invite.email,\r\n        role: invite.role,\r\n        status: invite.status,\r\n        expiresAt: invite.expiresAt,\r\n      },\r\n    });\r\n  } catch (error) {\r\n    return createErrorResponse(error);\r\n  }\r\n}\r\n"],"names":["GET","_request","context","token","params","invite","Response","json","success","data","farmId","email","role","status","expiresAt","error"],"mappings":";;;;AAAA;AACA;;;AAEO,eAAeA,IACpBC,QAAiB,EACjBC,OAA+C;IAE/C,IAAI;QACF,MAAM,EAAEC,KAAK,EAAE,GAAG,MAAMD,QAAQE,MAAM;QAEtC,MAAMC,SAAS,IAAA,0JAAgB,EAACF;QAChC,IAAI,CAACE,QAAQ;YACX,MAAM,IAAI,kIAAQ,CAAC,oBAAoB,0BAA0B;QACnE;QAEA,OAAOC,SAASC,IAAI,CAAC;YACnBC,SAAS;YACTC,MAAM;gBACJN;gBACAO,QAAQL,OAAOK,MAAM;gBACrBC,OAAON,OAAOM,KAAK;gBACnBC,MAAMP,OAAOO,IAAI;gBACjBC,QAAQR,OAAOQ,MAAM;gBACrBC,WAAWT,OAAOS,SAAS;YAC7B;QACF;IACF,EAAE,OAAOC,OAAO;QACd,OAAO,IAAA,6IAAmB,EAACA;IAC7B;AACF"}}]
}